

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="zhengcookie">
  <meta name="keywords" content="zhengcookie,blog,个人博客,技术分享">
  
    <meta name="description" content="类型Solidity 是一种静态类型语言，这意味着每个变量（状态变量和局部变量）都需要被指定类型。 Solidity 提供了几种基本类型，可以用来组合出复杂类型。 除此之外，各个类型之间可以在包含运算符号的表达式中进行交互。 关于各种运算符的快速参考，可以参考 运算符的优先顺序。 Solidity中不存在“未定义”或“空”值的概念， 但新声明的变量总是有一个取决于其类型的 默认值。 为了处理任何">
<meta property="og:type" content="article">
<meta property="og:title" content="类型">
<meta property="og:url" content="https://www.zhengcookie.site/2025/07/06/%E7%B1%BB%E5%9E%8B/index.html">
<meta property="og:site_name" content="zhengcookie">
<meta property="og:description" content="类型Solidity 是一种静态类型语言，这意味着每个变量（状态变量和局部变量）都需要被指定类型。 Solidity 提供了几种基本类型，可以用来组合出复杂类型。 除此之外，各个类型之间可以在包含运算符号的表达式中进行交互。 关于各种运算符的快速参考，可以参考 运算符的优先顺序。 Solidity中不存在“未定义”或“空”值的概念， 但新声明的变量总是有一个取决于其类型的 默认值。 为了处理任何">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-07-06T14:18:19.000Z">
<meta property="article:modified_time" content="2025-11-07T17:17:26.761Z">
<meta property="article:author" content="zhengcookie">
<meta property="article:tag" content="区块链智能合约语法">
<meta name="twitter:card" content="summary_large_image">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>类型 - zhengcookie</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"www.zhengcookie.site","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="zhengcookie" type="application/atom+xml">
</head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>zhengcookie</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>友链</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="类型"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-07-06 22:18" pubdate>
          2025年7月6日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          19k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          159 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">类型</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="类型"><a href="#类型" class="headerlink" title="类型"></a>类型<a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#types"></a></h1><p>Solidity 是一种静态类型语言，这意味着每个变量（状态变量和局部变量）都需要被指定类型。 Solidity 提供了几种基本类型，可以用来组合出复杂类型。</p>
<p>除此之外，各个类型之间可以在包含运算符号的表达式中进行交互。 关于各种运算符的快速参考，可以参考 <a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#order">运算符的优先顺序</a>。</p>
<p>Solidity中不存在“未定义”或“空”值的概念， 但新声明的变量总是有一个取决于其类型的 <a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/control-structures.html#default-value">默认值</a>。 为了处理任何意外的值，您应该使用 <a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/control-structures.html#assert-and-require">revert 函数</a> 来恢复整个事务， 或者返回一个带有第二个 <code>bool</code> 值的元组来表示成功。</p>
<h2 id="值类型"><a href="#值类型" class="headerlink" title="值类型"></a>值类型<a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#value-types"></a></h2><p>以下类型之所以被称为值类型，是因为它们的变量总是通过值传递， 即在用作函数参数或赋值时总是被复制。</p>
<h3 id="布尔类型"><a href="#布尔类型" class="headerlink" title="布尔类型"></a>布尔类型<a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#index-2"></a></h3><p><code>bool</code> ：可能的取值为常数值 <code>true</code> 和 <code>false</code>。</p>
<p>运算符：</p>
<ul>
<li><code>!</code> (逻辑非)</li>
<li><code>&amp;&amp;</code> (逻辑与, “and”)</li>
<li><code>||</code> (逻辑或, “or”)</li>
<li><code>==</code> (等于)</li>
<li><code>!=</code> (不等于)</li>
</ul>
<p>运算符 <code>||</code> 和 <code>&amp;&amp;</code> 都遵循同样的短路（ short-circuiting ）规则。 就是说在表达式 <code>f(x) || g(y)</code> 中， 如果 <code>f(x)</code> 的值为 <code>true</code> ， 那么 <code>g(y)</code> 就不会被执行，即使会出现一些副作用。</p>
<h3 id="整型"><a href="#整型" class="headerlink" title="整型"></a>整型<a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#integers"></a></h3><p><code>int</code> / <code>uint</code>: 分别表示有符号和无符号的不同位数的整型变量。 关键字 <code>uint8</code> 到 <code>uint256</code> （无符号整型，从 8 位到 256 位）以及 <code>int8</code> 到 <code>int256</code>， 以 8 位为步长递增。 <code>uint</code> 和 <code>int</code> 分别是 <code>uint256</code> 和 <code>int256</code> 的别名。</p>
<p>运算符：</p>
<ul>
<li>比较运算符： <code>&lt;=</code>， <code>&lt;</code>， <code>==</code>， <code>!=</code>， <code>&gt;=</code>， <code>&gt;</code> （返回布尔值）</li>
<li>位运算符： <code>&amp;</code>， <code>|</code>， <code>^</code> (异或)， <code>~</code> (位取反)</li>
<li>移位运算符： <code>&lt;&lt;</code> （左移）， <code>&gt;&gt;</code> （右移）</li>
<li>算数运算符： <code>+</code>， <code>-</code>， 一元运算 <code>-</code> （只适用于有符号的整数）， <code>*</code>， <code>/</code>， <code>%</code> (取余)， <code>**</code> (幂)</li>
</ul>
<p>对于一个整数类型 <code>X</code>，您可以使用 <code>type(X).min</code> 和 <code>type(X).max</code> 来访问该类型代表的最小值和最大值。</p>
<p>警告</p>
<p>Solidity 中的整数被限制在一个特定的范围内。例如，对于 <code>uint32</code>，这是 <code>0</code> 到 <code>2**32 - 1</code>。 有两种模式在这些类型上进行算术。“包装” 或 “不检查” 模式和 “检查” 模式。 默认情况下，算术总是 “检查” 模式的，这意味着如果一个操作的结果超出了该类型的值范围， 调用将通过一个 <a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/control-structures.html#assert-and-require">失败的断言</a> 而被恢复。 您可以用 <code>unchecked &#123; ... &#125;</code> 来转换到“未检查”模式。 更多的细节可以在关于 <a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/control-structures.html#unchecked">未检查</a> 的章节中找到。</p>
<h4 id="比较运算"><a href="#比较运算" class="headerlink" title="比较运算"></a>比较运算<a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#id5"></a></h4><p>比较的值是通过比较整数值得到的值。</p>
<h4 id="位运算"><a href="#位运算" class="headerlink" title="位运算"></a>位运算<a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#id6"></a></h4><p>位操作是在数字的二进制补码表示上进行的。 这意味着，例如 <code>~int256(0) == int256(-1)</code>。</p>
<h4 id="移位运算"><a href="#移位运算" class="headerlink" title="移位运算"></a>移位运算<a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#id7"></a></h4><p>移位操作的结果具有左操作数的类型，将结果截断以符合类型。 右操作数必须是无符号类型，试图对有符号类型进行移位会产生一个编译错误。</p>
<p>移位可以通过以下方式用2的幂的乘法来 “模拟”。 请注意，对左边操作数类型的截断总是在最后进行，但没有明确提及。</p>
<ul>
<li><code>x &lt;&lt; y</code> 等同于数学表达式 <code>x * 2**y</code>。</li>
<li><code>x &gt;&gt; y</code> 等同于数学表达式 <code>x / 2**y</code>，向负无穷远的方向取整。</li>
</ul>
<p>警告</p>
<p>在 <code>0.5.0</code> 版本之前，负数 <code>x</code> 的右移 <code>x &gt;&gt; y</code> 相当于数学表达式 <code>x / 2**y</code> 向零舍入， 即右移使用向上舍入（向零舍入）而不是向下舍入（向负无穷大）。</p>
<p>备注</p>
<p>就像对算术操作那样，对移位操作从不进行溢出检查。相反，结果总是被截断的。</p>
<h4 id="加法、减法和乘法"><a href="#加法、减法和乘法" class="headerlink" title="加法、减法和乘法"></a>加法、减法和乘法<a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#id8"></a></h4><p>加法、减法和乘法具有通常的语义，在上溢和下溢方面有两种不同的模式：</p>
<p>默认情况下，所有的算术都会被检查是否有下溢或上溢，但这可以用 <a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/control-structures.html#unchecked">不检查限制</a> 来禁用。 这会导致包装的算术。更多细节可以在那一节中找到。</p>
<p>表达式 <code>-x</code> 等同于 <code>(T(0) - x)</code>，其中 <code>T</code> 是 <code>x</code> 的类型。它只能用于有符号的类型。 如果 <code>x</code> 是负的， <code>-x</code> 的值就是正的。 还有一个注意事项也是由二进制补码表示产生的：</p>
<p>如果您有（这样的表达式） <code>int x = type(int).min;</code>，那么 <code>-x</code> 就不符合正数范围。 这意味着 <code>unchecked &#123; assert(-x == x); &#125;</code> 可以工作， 而表达式 <code>-x</code> 在检查模式下使用时将导致断言失败。</p>
<h4 id="除法"><a href="#除法" class="headerlink" title="除法"></a>除法<a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#id9"></a></h4><p>由于运算结果的类型总是操作数之一的类型，整数除法的结果总是一个整数。 在 Solidity 中，除法是向零进位的。这意味着 <code>int256(-5) / int256(2) == int256(-2)</code>。</p>
<p>请注意，与此相反，在 <a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#rational-literals">字面上</a> 的除法会产生任意精度的分数值。</p>
<p>备注</p>
<p>除以0会导致 <a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/control-structures.html#assert-and-require">异常</a>。这个检查 <strong>不能</strong> 通过 <code>unchecked &#123; ... &#125;</code> 禁用。</p>
<p>备注</p>
<p>表达式 <code>type(int).min / (-1)</code> 是除法导致溢出的唯一情况。 在检查算术模式下，这将导致一个失败的断言， 而在包装模式下，值将是 <code>type(int).min</code>。</p>
<h4 id="取余"><a href="#取余" class="headerlink" title="取余"></a>取余<a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#id10"></a></h4><p>模数运算 <code>a % n</code> 是操作数 <code>a</code> 除以操作数 <code>n</code> 后产生余数 <code>r</code>， 其中 <code>q = int(a / n)</code> 和 <code>r = a - (n * q)</code>。 这意味着模数运算结果与它的左边操作数（或零）拥有相同的符号， <code>a % n == -(-a % n)</code> 对负的 <code>a</code> 来说成立。</p>
<ul>
<li><code>int256(5) % int256(2) == int256(1)</code></li>
<li><code>int256(5) % int256(-2) == int256(1)</code></li>
<li><code>int256(-5) % int256(2) == int256(-1)</code></li>
<li><code>int256(-5) % int256(-2) == int256(-1)</code></li>
</ul>
<p>备注</p>
<p>对0取余会导致 <a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/control-structures.html#assert-and-require">异常</a>。这个检查 <strong>不能</strong> 通过 <code>unchecked &#123; ... &#125;</code> 禁用。</p>
<h4 id="幂运算"><a href="#幂运算" class="headerlink" title="幂运算"></a>幂运算<a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#id11"></a></h4><p>幂运算只适用于指数中的无符号类型。幂运算的结果类型总是等于基数的类型。 请注意，它足够大以容纳结果，并为潜在的断言失败或包装行为做好准备。</p>
<p>备注</p>
<p>在检查模式下，幂运算只对小基数使用相对便宜的 <code>exp</code> 操作码。 对于 <code>x**3</code> 的情况，表达式 <code>x*x*x</code> 可能更便宜。 在任何情况下，燃料成本测试和使用优化器都是可取的。</p>
<p>备注</p>
<p>请注意， <code>0**0</code> 被EVM定义为 <code>1</code>。</p>
<h3 id="定长浮点型"><a href="#定长浮点型" class="headerlink" title="定长浮点型"></a>定长浮点型<a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#index-4"></a></h3><p>警告</p>
<p>Solidity 还没有完全支持定长浮点型。可以声明定长浮点型的变量， 但不能给它们赋值或把它们赋值给其他变量。</p>
<p><code>fixed</code> / <code>ufixed</code>：表示各种大小的有符号和无符号的定长浮点型。 在关键字 <code>ufixedMxN</code> 和 <code>fixedMxN</code> 中， <code>M</code> 表示该类型占用的位数， <code>N</code> 表示可用的小数位数。 <code>M</code> 必须能整除 8，即 8 到 256 位。 <code>N</code> 则可以是从 0 到 80 之间的任意数。 <code>ufixed</code> 和 <code>fixed</code> 分别是 <code>ufixed128x18</code> 和 <code>fixed128x18</code> 的别名。</p>
<p>运算符：</p>
<ul>
<li>比较运算符： <code>&lt;=</code>， <code>&lt;</code>， <code>==</code>， <code>!=</code>， <code>&gt;=</code>， <code>&gt;</code> （返回值是布尔型）</li>
<li>算术运算符： <code>+</code>， <code>-</code>， 一元运算 <code>-</code>， <code>*</code>， <code>/</code>， <code>%</code> (取余数)</li>
</ul>
<p>备注</p>
<p>浮点型（在许多语言中的 <code>float</code> 和 <code>double</code> ，更准确地说是 IEEE 754 类型）和定长浮点型之间最大的不同点是， 在前者中整数部分和小数部分（小数点后的部分）需要的位数是灵活可变的，而后者中这两部分的长度受到严格的规定。 一般来说，在浮点型中，几乎整个空间都用来表示数字，但只有少数的位来表示小数点的位置。</p>
<h3 id="地址类型"><a href="#地址类型" class="headerlink" title="地址类型"></a>地址类型<a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#address"></a></h3><p>地址类型有两种大致相同的类型：</p>
<ul>
<li><code>address</code>: 保存一个20字节的值（一个以太坊地址的大小）。</li>
<li><code>address payable</code>: 与 <code>address</code> 类型相同，但有额外的方法 <code>transfer</code> 和 <code>send</code>。</li>
</ul>
<p>这种区别背后的想法是， <code>address payable</code> 是一个您可以发送以太币的地址， 而您不应该发送以太币给一个普通的 <code>address</code>，例如，因为它可能是一个智能合约， 而这个合约不是为接受以太币而建立的。</p>
<p>类型转换：</p>
<p>允许从 <code>address payable</code> 到 <code>address</code> 的隐式转换， 而从 <code>address</code> 到 <code>address payable</code> 的转换必须通过 <code>payable(&lt;address&gt;)</code> 来明确。</p>
<p>对于 <code>uint160</code>、整数、 <code>bytes20</code> 和合约类型，允许对 <code>address</code> 进行明确的转换和输出。</p>
<p>只有 <code>address</code> 类型和合约类型的表达式可以通过 <code>payable(...)</code> 显式转换为 <code>address payable</code> 类型。 对于合约类型，只有在合约可以接收以太的情况下才允许这种转换，也就是说， 合约要么有一个 <a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/contracts.html#receive-ether-function">receive</a> 函数，要么有一个 payable 类型的 fallback 的函数。 请注意， <code>payable(0)</code> 是有效的，是这个规则的例外。</p>
<p>备注</p>
<p>如果您需要一个 <code>address</code> 类型的变量，并计划向其发送以太，那么就将其类型声明为 <code>address payable</code>， 以使这一要求可行。另外，尽量尽早地进行这种区分或转换。</p>
<p><code>address</code> 和 <code>address payable</code> 之间的区别是从 0.5.0 版本开始的。 同样从该版本开始，合约不能隐式地转换为 <code>address</code> 类型，但仍然可以显式地转换为 <code>address</code> 或 <code>address payable</code>，如果它们有一个 receive 或 payable 类型的 fallback 函数的话。</p>
<p>运算符：</p>
<ul>
<li><code>&lt;=</code>, <code>&lt;</code>, <code>==</code>, <code>!=</code>, <code>&gt;=</code> 和 <code>&gt;</code></li>
</ul>
<p>警告</p>
<p>如果您使用较大字节的类型转换为 <code>address</code>，例如 <code>bytes32</code>，那么 <code>address</code> 就被截断了。 为了减少转换的模糊性，从 0.4.24 版本开始，编译器将强迫您在转换中明确地进行截断处理。以32字节的值 <code>0x111122333344556677888899AAAABBBBCCCCDDDDEEFFFFCCCC</code> 为例。</p>
<p>您可以使用 <code>address(uint160(bytes20(b)))</code>，结果是 <code>0x111122223333444455556666777788889999aAaa</code>， 或者您可以使用 <code>address(uint160(uint256(b)))</code>，结果是 <code>0x777788889999AaAAbBbbCcccddDdeeeEfFFfCcCc</code>。</p>
<p>备注</p>
<p>符合 <a target="_blank" rel="noopener" href="https://github.com/ethereum/EIPs/blob/master/EIPS/eip-55.md">EIP-55</a> 的混合大小写十六进制数字会自动被视为 <code>address</code> 类型的字面数字。参见 <a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#address-literals">地址字面类型</a>。</p>
<h4 id="地址类型成员变量"><a href="#地址类型成员变量" class="headerlink" title="地址类型成员变量"></a>地址类型成员变量<a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#members-of-addresses"></a></h4><p>快速参考，请见 <a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/units-and-global-variables.html#address-related">地址类型的成员</a>。</p>
<ul>
<li><code>balance</code> 和 <code>transfer</code></li>
</ul>
<p>可以使用 <code>balance</code> 属性来查询一个地址的以太币余额， 也可以使用 <code>transfer</code> 函数向一个地址发送以太币（以 wei 为单位）：</p>
<p><a target="_blank" rel="noopener" href="https://remix.ethereum.org/?#language=solidity&amp;version=0.8.24&amp;code=YWRkcmVzcyBwYXlhYmxlIHggPSBwYXlhYmxlKDB4MTIzKTsKYWRkcmVzcyBteUFkZHJlc3MgPSBhZGRyZXNzKHRoaXMpOwppZiAoeC5iYWxhbmNlIDwgMTAgJiYgbXlBZGRyZXNzLmJhbGFuY2UgPj0gMTApIHgudHJhbnNmZXIoMTApOw==">open in Remix</a></p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-keyword">address </span>payable x = payable(<span class="hljs-number">0x123</span>);<br><span class="hljs-keyword">address </span>myAddress = <span class="hljs-keyword">address(this);</span><br><span class="hljs-keyword"></span>if (x.<span class="hljs-keyword">balance </span>&lt; <span class="hljs-number">10</span> &amp;&amp; myAddress.<span class="hljs-keyword">balance </span>&gt;= <span class="hljs-number">10</span>) x.transfer(<span class="hljs-number">10</span>);<br></code></pre></td></tr></table></figure>
<p>如果当前合约的余额不足，或者以太币转账被接收账户拒收，那么 <code>transfer</code> 功能就会失败。 <code>transfer</code> 功能在失败后会被还原。</p>
<p>备注</p>
<p>如果 <code>x</code> 是一个合约地址，它的代码（更具体地说：它的 <a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/contracts.html#receive-ether-function">接收以太的函数</a>，如果有的话， 或者它的 <a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/contracts.html#fallback-function">Fallback 函数</a>，如果有的话）将与 <code>transfer</code> 调用一起执行（这是EVM的一个特性，无法阻止）。 如果执行过程中耗尽了燃料或出现了任何故障，以太币的转移将被还原，当前的合约将以异常的方式停止。</p>
<ul>
<li><code>send</code></li>
</ul>
<p><code>send</code> 是 <code>transfer</code> 的低级对应部分。如果执行失败，当前的合约不会因异常而停止，但 <code>send</code> 会返回 <code>false</code>。</p>
<p>警告</p>
<p>使用 <code>send</code> 有一些危险：如果调用堆栈深度为1024，传输就会失败（这可以由调用者强制执行）， 如果接收者的燃料耗尽，也会失败。因此，为了安全地进行以太币转账， 一定要检查 <code>send</code> 的返回值，或者使用 <code>transfer</code>，甚至使用更好的方式： 使用收款人提取以太币的模式。</p>
<ul>
<li><code>call</code>, <code>delegatecall</code> 和 <code>staticcall</code></li>
</ul>
<p>为了与不遵守ABI的合约对接，或者为了更直接地控制编码， 我们提供了 <code>call</code>, <code>delegatecall</code> 和 <code>staticcall</code> 函数。 它们都接受一个 <code>bytes memory</code> 参数，并返回成功条件（作为一个 <code>bool</code>） 和返回的数据（ <code>bytes memory</code>）。 函数 <code>abi.encode</code>, <code>abi.encodePacked</code>, <code>abi.encodeWithSelector</code> 和 <code>abi.encodeWithSignature</code> 可以用来编码结构化的数据。</p>
<p>示例：</p>
<p><a target="_blank" rel="noopener" href="https://remix.ethereum.org/?#language=solidity&amp;version=0.8.24&amp;code=Ynl0ZXMgbWVtb3J5IHBheWxvYWQgPSBhYmkuZW5jb2RlV2l0aFNpZ25hdHVyZSgicmVnaXN0ZXIoc3RyaW5nKSIsICJNeU5hbWUiKTsKKGJvb2wgc3VjY2VzcywgYnl0ZXMgbWVtb3J5IHJldHVybkRhdGEpID0gYWRkcmVzcyhuYW1lUmVnKS5jYWxsKHBheWxvYWQpOwpyZXF1aXJlKHN1Y2Nlc3MpOw==">open in Remix</a></p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-keyword">bytes </span>memory payload = abi.encodeWithSignature(<span class="hljs-string">&quot;register(string)&quot;</span>, <span class="hljs-string">&quot;MyName&quot;</span>);<br>(<span class="hljs-keyword">bool </span>success, <span class="hljs-keyword">bytes </span>memory returnData) = <span class="hljs-keyword">address(nameReg).call(payload);</span><br><span class="hljs-keyword"></span>require(success);<br></code></pre></td></tr></table></figure>
<p>警告</p>
<p>所有这些函数都是低级别的函数，应该谨慎使用。 具体来说，任何未知的合约都可能是恶意的，如果您调用它， 您就把控制权交给了该合约，而该合约又可能回调到您的合约中， 所以要准备好在调用返回时改变您合约的状态变量。 与其他合约互动的常规方法是在合约对象上调用一个函数（ <code>x.f()</code>）。</p>
<p>备注</p>
<p>以前的 Solidity 版本允许这些函数接收任意的参数， 并且也会以不同的方式处理 <code>bytes4</code> 类型的第一个参数。 这些边缘情况在0.5.0版本中被移除。</p>
<p>可以用 <code>gas</code> 修饰器来调整所提供的燃料：</p>
<p><a target="_blank" rel="noopener" href="https://remix.ethereum.org/?#language=solidity&amp;version=0.8.24&amp;code=YWRkcmVzcyhuYW1lUmVnKS5jYWxse2dhczogMTAwMDAwMH0oYWJpLmVuY29kZVdpdGhTaWduYXR1cmUoInJlZ2lzdGVyKHN0cmluZykiLCAiTXlOYW1lIikpOw==">open in Remix</a></p>
<figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs excel"><span class="hljs-built_in">address</span>(nameReg).<span class="hljs-built_in">call</span>&#123;g<span class="hljs-symbol">as:</span> <span class="hljs-number">1000000</span>&#125;(abi.encodeWithSignature(<span class="hljs-string">&quot;register(string)&quot;</span>, <span class="hljs-string">&quot;MyName&quot;</span>));<br></code></pre></td></tr></table></figure>
<p>同样，所提供的以太值也可以被控制：</p>
<p><a target="_blank" rel="noopener" href="https://remix.ethereum.org/?#language=solidity&amp;version=0.8.24&amp;code=YWRkcmVzcyhuYW1lUmVnKS5jYWxse3ZhbHVlOiAxIGV0aGVyfShhYmkuZW5jb2RlV2l0aFNpZ25hdHVyZSgicmVnaXN0ZXIoc3RyaW5nKSIsICJNeU5hbWUiKSk7">open in Remix</a></p>
<figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs excel"><span class="hljs-built_in">address</span>(nameReg).<span class="hljs-built_in">call</span>&#123;val<span class="hljs-symbol">ue:</span> <span class="hljs-number">1</span> ether&#125;(abi.encodeWithSignature(<span class="hljs-string">&quot;register(string)&quot;</span>, <span class="hljs-string">&quot;MyName&quot;</span>));<br></code></pre></td></tr></table></figure>
<p>最后，这些修饰器可以合并。它们的顺序并不重要：</p>
<p><a target="_blank" rel="noopener" href="https://remix.ethereum.org/?#language=solidity&amp;version=0.8.24&amp;code=YWRkcmVzcyhuYW1lUmVnKS5jYWxse2dhczogMTAwMDAwMCwgdmFsdWU6IDEgZXRoZXJ9KGFiaS5lbmNvZGVXaXRoU2lnbmF0dXJlKCJyZWdpc3RlcihzdHJpbmcpIiwgIk15TmFtZSIpKTs=">open in Remix</a></p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">address</span>(nameReg).call&#123;gas: <span class="hljs-number">1000000</span>, value: <span class="hljs-number">1</span> ether&#125;(abi.encodeWithSignature(<span class="hljs-string">&quot;register(string)&quot;</span>, <span class="hljs-string">&quot;MyName&quot;</span>));<br></code></pre></td></tr></table></figure>
<p>以类似的方式，可以使用函数 <code>delegatecall</code>：不同的是，它只使用给定地址的代码， 所有其他方面（存储，余额，…）都取自当前的合约。 <code>delegatecall</code> 的目的是为了使用存储在另一个合约中的库代码。 用户必须确保两个合约中的存储结构都适合使用delegatecall。</p>
<p>备注</p>
<p>在 homestead 版本之前，只有一个功能类似但作用有限的 <code>callcode</code> 的函数可用， 但它不能获取委托方的 <code>msg.sender</code> 和 <code>msg.value</code>。这个功能在 0.5.0 版本中被移除。</p>
<p>从 byzantium 开始，也可以使用 <code>staticcall</code>。这基本上与 <code>call</code> 相同， 但如果被调用的函数以任何方式修改了状态，则会恢复。</p>
<p>这三个函数 <code>call</code>， <code>delegatecall</code> 和 <code>staticcall</code> 都是非常低级的函数， 只应该作为 <em>最后的手段</em> 来使用，因为它们破坏了Solidity的类型安全。</p>
<p><code>gas</code> 选项在所有三种方法中都可用，而 <code>value</code> 选项只在 <code>call</code> 中可用。</p>
<p>备注</p>
<p>最好避免在您的智能合约代码中依赖硬编码的燃料值，无论状态是读出还是写入， 因为这可能有很多隐患。另外，对燃料的访问在未来可能会改变。</p>
<ul>
<li><code>code</code> 和 <code>codehash</code></li>
</ul>
<p>您可以查询任何智能合约的部署代码。使用 <code>.code</code> 获得作为 <code>bytes memory</code> 的EVM字节码， 这可能是空的。使用 <code>.codehash</code> 获得该代码的Keccak-256哈希值（作为 <code>bytes32</code>）。 注意，使用 <code>addr.codehash</code> 比 <code>keccak256(addr.code)</code> 更便宜。</p>
<p>备注</p>
<p>所有的合约都可以转换为 <code>address</code> 类型，所以可以用 <code>address(this).balance</code> 查询当前合约的余额。</p>
<h3 id="合约类型"><a href="#合约类型" class="headerlink" title="合约类型"></a>合约类型<a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#contract-types"></a></h3><p>每个 <a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/contracts.html#contracts">合约</a> 都定义了自己的类型。 您可以隐式地将一个合约转换为它们所继承的另一个合约。 合约可以显式地转换为 <code>address</code> 类型，也可以从 <code>address</code> 类型中转换。</p>
<p>只有在合约类型具有 receive 或 payable 类型的 fallback 函数的情况下， 才有可能明确转换为 <code>address payable</code> 类型和从该类型转换。 这种转换仍然使用 <code>address(x)</code> 进行转换。如果合约类型没有一个 receive 或 payable 类型的 fallback 函数， 可以使用 <code>payable(address(x))</code> 来转换为 <code>address payable</code> 。 您可以在 <a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#address">地址类型</a> 一节中找到更多信息。</p>
<p>备注</p>
<p>在 0.5.0 版本之前，合约直接从地址类型派生出来， 并且在 <code>address</code> 和 <code>address payable</code> 之间没有区别。</p>
<p>如果您声明了一个本地类型的变量（ <code>MyContract c</code> ），您可以调用该合约上的函数。 注意要从相同合约类型的地方将其赋值。</p>
<p>您也可以实例化合约（这意味着它们是新创建的）。 您可以在 <a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/control-structures.html#creating-contracts">‘通过关键字new创建合约’</a> 部分找到更多细节。</p>
<p>合约的数据表示与 <code>address</code> 类型相同，该类型也用于 <a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/abi-spec.html#abi">ABI</a>。</p>
<p>合约不支持任何运算符。</p>
<p>合约类型的成员是合约的外部函数，包括任何标记为 <code>public</code> 的状态变量。</p>
<p>对于一个合约 <code>C</code>，您可以使用 <code>type(C)</code> 来访问 关于该合约的 <a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/units-and-global-variables.html#meta-type">类型信息</a> 。</p>
<h3 id="定长字节数组"><a href="#定长字节数组" class="headerlink" title="定长字节数组"></a>定长字节数组<a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#index-7"></a></h3><p>值类型 <code>bytes1</code>, <code>bytes2</code>, <code>bytes3</code>, …, <code>bytes32</code> 代表从1到32的字节序列。</p>
<p>运算符：</p>
<p>比较运算符：&lt;=， &lt;， ==， !=， &gt;=， &gt; （返回布尔型）</p>
<ul>
<li>比较运算符： <code>&lt;=</code>， <code>&lt;</code>， <code>==</code>， <code>!=</code>， <code>&gt;=</code>， <code>&gt;</code> (返回 <code>bool</code>)</li>
<li>位运算符： <code>&amp;</code>， <code>|</code>， <code>^</code> （按位异或）， <code>~</code> （按位取反）</li>
<li>移位运算符： <code>&lt;&lt;</code> （左移位）， <code>&gt;&gt;</code> （右移位）</li>
<li>索引访问： 如果 <code>x</code> 是 <code>bytesI</code> 类型，那么当 <code>0 &lt;= k &lt; I</code> 时， <code>x[k]</code> 返回第 <code>k</code> 个字节（只读）。</li>
</ul>
<p>移位运算符以无符号的整数类型作为右操作数（但返回左操作数的类型）， 它表示要移位的位数。有符号类型的移位将产生一个编译错误。</p>
<p>成员变量：</p>
<ul>
<li><code>.length</code> 表示这个字节数组的长度（只读）.</li>
</ul>
<p>备注</p>
<p>类型 <code>bytes1[]</code> 是一个字节数组，但是由于填充规则，它为每个元素浪费了31个字节的空间（在存储中除外）。 因此最好使用 <code>bytes</code> 类型来代替。</p>
<p>备注</p>
<p>在 0.8.0 版本之前， <code>byte</code> 曾经是 <code>bytes1</code> 的别名。</p>
<h3 id="变长字节数组"><a href="#变长字节数组" class="headerlink" title="变长字节数组"></a>变长字节数组<a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#id17"></a></h3><ul>
<li><p><code>bytes</code>:</p>
<p>变长字节数组，参见 <a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#arrays">数组</a>。它并不是值类型！</p>
</li>
<li><p><code>string</code>:</p>
<p>变长 UTF-8 编码字符串类型，参见 <a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#arrays">数组</a>。并不是值类型！</p>
</li>
</ul>
<h3 id="地址字面量（Address-Literals）"><a href="#地址字面量（Address-Literals）" class="headerlink" title="地址字面量（Address Literals）"></a>地址字面量（Address Literals）<a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#address-literals"></a></h3><p>比如像 <code>0xdCad3a6d3569DF655070DEd06cb7A1b2Ccd1D3AF</code> 这样的 通过了地址校验测试的十六进制字属于 <code>address</code> 类型。 十六进制字数在39到41位之间，并且没有通过校验测试，会产生一个错误。 您可以预加（对于整数类型）或附加（对于bytesNN类型）零来消除该错误。</p>
<p>备注</p>
<p>混合大小写的地址校验和格式定义在 <a target="_blank" rel="noopener" href="https://github.com/ethereum/EIPs/blob/master/EIPS/eip-55.md">EIP-55</a>。</p>
<h3 id="有理数和整数字面量"><a href="#有理数和整数字面量" class="headerlink" title="有理数和整数字面量"></a>有理数和整数字面量<a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#rational-literals"></a></h3><p>整数字面量由范围在 0-9 的一串数字组成，表现成十进制。 例如， <code>69</code> 表示十进制数字 69。 Solidity 中是没有八进制的，因此前置 0 是无效的。</p>
<p>小数字面常数由 <code>.</code> 和小数点后的至少一个数字组成。例如， <code>.1</code> 和 <code>1.3</code> （但不是 <code>1.</code>）。</p>
<p>也支持 <code>2e10</code> 形式的科学符号，其中尾数可以是小数，但指数必须是一个整数。 字面的 <code>MeE</code> 相当于 <code>M * 10**E</code>。 例子包括 <code>2e10</code>, <code>-2e10</code>, <code>2e-10</code>, <code>2.5e1</code>。</p>
<p>下划线可以用来分隔数字字面的数字，以帮助阅读。 例如，十进制 <code>123_000</code>，十六进制 <code>0x2eff_abde</code>，科学十进制 <code>1_2e345_678</code> 都是有效的。 下划线只允许在两个数字之间，并且只允许一个连续的下划线。 含有下划线的数字字面没有额外的语义，下划线被忽略。</p>
<p>数值字面量表达式保留任意精度，直到它们被转换为非字面量类型 （即通过与数字字面量表达式以外的任何东西一起使用（如布尔字面量）或通过显式转换）。 这意味着在数值常量表达式中，计算不会溢出，除法不会截断。</p>
<p>例如， <code>(2**800 + 1) - 2**800</code> 的结果是常数 <code>1</code> （类型 <code>uint8</code>）， 尽管中间的结果甚至不符合机器字的大小。此外， <code>.5 * 8</code> 的结果是整数 <code>4</code> （尽管中间使用了非整数）。</p>
<p>警告</p>
<p>虽然大多数运算符在应用于字面量时都会产生一个字面量表达式，但有一些运算符并不遵循这种模式：</p>
<ul>
<li>三元运算符（ <code>...？ ...：...</code>）。</li>
<li>数组下标（ <code>&lt;array&gt;[&lt;index&gt;]</code>）。</li>
</ul>
<p>您可能期望像 <code>255 + (true ? 1 : 0)</code> 或 <code>255 + [1, 2, 3][0]</code> 这样的表达式等同于直接使用字面量256， 但实际上它们是在 <code>uint8</code> 类型中计算的，可能会溢出。</p>
<p>只要操作数是整数，任何可以应用于整数的操作数也可以应用于数值字面量表达式。 如果两者中的任何一个是小数，则不允许进行位操作， 如果指数是小数，则不允许进行幂运算（因为这可能导致无理数）。</p>
<p>以数值字面量表达式为左（或基数）操作数，以整数类型为右（指数）操作数的移位和幂运算， 总是在 <code>uint256</code> （非负数数值字面量）或 <code>int256</code> （负数数值字面量）类型中进行。 无论右（指数）操作数的类型如何。</p>
<p>警告</p>
<p>在 0.4.0 版本之前，Solidity 中整数字的除法会被截断，但现在它转换为一个有理数，即 <code>5 / 2</code> 不等于 <code>2</code>，而是 <code>2.5</code>。</p>
<p>备注</p>
<p>Solidity 对每个有理数都有对应的数值字面量类型。 整数字面量和有理数字面量都属于数值字面量类型。 除此之外，所有的数值字面量表达式（即只包含数值字面量和运算符的表达式）都属于数值字面量类型。 因此数值字面量表达式 <code>1 + 2</code> 和 <code>2 + 1</code> 的结果跟有理数3的数值字面量类型相同。</p>
<p>备注</p>
<p>数字字面表达式一旦与非字面表达式一起使用，就会被转换为非字面类型。 不考虑类型，下面分配给 <code>b</code> 的表达式的值被评估为一个整数。 因为 <code>a</code> 的类型是 <code>uint128</code>，所以表达式 <code>2.5 + a</code> 必须有一个合适的类型。 由于 <code>2.5</code> 和 <code>uint128</code> 的类型没有共同的类型，Solidity编译器不接受这段代码。</p>
<p><a target="_blank" rel="noopener" href="https://remix.ethereum.org/?#language=solidity&amp;version=0.8.24&amp;code=dWludDEyOCBhID0gMTsKdWludDEyOCBiID0gMi41ICsgYSArIDAuNTs=">open in Remix</a></p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">uint128</span> a = <span class="hljs-number">1</span>;<br><span class="hljs-attribute">uint128</span> b = <span class="hljs-number">2</span>.<span class="hljs-number">5</span> + a + <span class="hljs-number">0</span>.<span class="hljs-number">5</span>;<br></code></pre></td></tr></table></figure>
<h3 id="字符串字面量和类型"><a href="#字符串字面量和类型" class="headerlink" title="字符串字面量和类型"></a>字符串字面量和类型<a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#string-literals"></a></h3><p>字符串字面量是指由双引号或单引号引起来的字符串（ <code>&quot;foo&quot;</code> 或者 <code>&#39;bar&#39;</code>）。 它们也可以分成多个连续部分（ <code>&quot;foo&quot; &quot;bar&quot;</code> 相当于 <code>&quot;foobar&quot;</code> ），这在处理长字符串时很有帮助。 它们不像在 C 语言中那样带有结束符； <code>&quot;foo&quot;</code> 相当于3个字节而不是4个。 和整数字面量一样，字符串字面量的类型也可以发生改变， 但它们可以隐式地转换成 <code>bytes1</code>，……， <code>bytes32</code>，如果合适的话，还可以转换成 <code>bytes</code> 以及 <code>string</code>。</p>
<p>例如，使用 <code>bytes32 samevar = &quot;stringliteral&quot;</code>， 当分配给 <code>bytes32</code> 类型时，字符串字面量被解释成原始字节形式。</p>
<p>字符串字面量只能包含可打印的ASCII字符，也就是0x20 … 0x7E之间的字符。</p>
<p>此外，字符串字元还支持以下转义字符：</p>
<ul>
<li><code>\&lt;newline&gt;</code> （转义一个实际的换行）</li>
<li><code>\\</code> （反斜杠）</li>
<li><code>\&#39;</code> （单引号）</li>
<li><code>\&quot;</code> （双引号）</li>
<li><code>\n</code> （换行）</li>
<li><code>\r</code> （回车键）</li>
<li><code>\t</code> （制表）</li>
<li><code>\xNN</code> （十六进制转义，见下文）</li>
<li><code>\uNNNN</code> （unicode转义，见下文）</li>
</ul>
<p><code>\xNN</code> 接收一个十六进制值并插入相应的字节，而 <code>\uNNNN</code> 接收一个Unicode编码点并插入一个UTF-8序列。</p>
<p>备注</p>
<p>在 0.8.0 版本之前，有三个额外的转义序列。 <code>\b</code>， <code>\f</code> 和 <code>v</code>。 它们在其他语言中通常是可用的，但在实践中很少需要。 如果您确实需要它们，仍然可以通过十六进制转义插入， 即分别为 <code>\x08</code>， <code>x0c</code> 和 <code>\x0b</code>，就像其他ASCII字符一样。</p>
<p>下面例子中的字符串的长度为10个字节。 它以一个换行字节开始，接着是一个双引号，一个单引号，一个反斜杠字符， 然后（没有分隔符）是字符序列 <code>abcdef</code>。</p>
<p><a target="_blank" rel="noopener" href="https://remix.ethereum.org/?#language=solidity&amp;version=0.8.24&amp;code=IlxuXCJcJ1xcYWJjXApkZWYi">open in Remix</a></p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs nix"><span class="hljs-string">&quot;<span class="hljs-char escape_">\n</span><span class="hljs-char escape_">\&quot;</span><span class="hljs-char escape_">\&#x27;</span><span class="hljs-char escape_">\\</span>abc\</span><br><span class="hljs-string">def&quot;</span><br></code></pre></td></tr></table></figure>
<p>任何非换行的 Unicode 行结束符（即LF, VF, FF, CR, NEL, LS, PS）都被认为是字符串字面的结束。 换行只在字符串字面内容前面没有 <code>\</code> 的情况下终止。</p>
<h3 id="Unicode-字面量"><a href="#Unicode-字面量" class="headerlink" title="Unicode 字面量"></a>Unicode 字面量<a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#unicode"></a></h3><p>普通字符串字面量只能包含ASCII码，而 Unicode 字面量 - 以关键字 <code>unicode</code> 为前缀 - 可以包含任何有效的UTF-8序列。 它们也支持与普通字符串字面意义相同的转义序列。</p>
<p><a target="_blank" rel="noopener" href="https://remix.ethereum.org/?#language=solidity&amp;version=0.8.24&amp;code=c3RyaW5nIG1lbW9yeSBhID0gdW5pY29kZSJIZWxsbyDwn5iDIjs=">open in Remix</a></p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">string memory a <span class="hljs-operator">=</span> unicode<span class="hljs-string">&quot;Hello 😃&quot;</span><span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure>
<h3 id="十六进制字面量"><a href="#十六进制字面量" class="headerlink" title="十六进制字面量"></a>十六进制字面量<a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#index-12"></a></h3><p>十六进制字面量以关键字 <code>hex</code> 打头， 后面紧跟着用单引号或双引号引起来的字符串（ <code>hex&quot;001122FF&quot;</code>, <code>hex&#39;0011_22_FF&#39;</code>）。 它们的内容必须是十六进制的数字，可以选择使用一个下划线作为字节边界之间的分隔符。 字面的值将是十六进制序列的二进制表示。</p>
<p>由空格分隔的多个十六进制字面量被串联成一个字面量： <code>hex&quot;00112233&quot; hex&quot;44556677&quot;</code> 相当于 <code>hex&quot;0011223344556677&quot;</code>。</p>
<p>十六进制字面量在某些方面的行为类似 <a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#string-literals">字符串字面量</a> ，但不能隐式转换为 <code>string</code> 类型。</p>
<h3 id="枚举类型"><a href="#枚举类型" class="headerlink" title="枚举类型"></a>枚举类型<a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#enums"></a></h3><p>枚举是在 Solidity 中创建用户定义类型的一种方式。 它们可以显式地转换为所有整数类型，和从整数类型来转换，但不允许隐式转换。 从整数的显式转换在运行时检查该值是否在枚举的范围内，否则会导致 <a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/control-structures.html#assert-and-require">异常</a>。 枚举要求至少有一个成员，其声明时的默认值是第一个成员。 枚举不能有超过256个成员。</p>
<p>数据表示与 C 语言中的枚举相同。选项由后续的从 <code>0</code> 开始无符号整数值表示。</p>
<p>使用 <code>type(NameOfEnum).min</code> 和 <code>type(NameOfEnum).max</code> 您可以得到给定枚举的最小值和最大值。</p>
<p><a target="_blank" rel="noopener" href="https://remix.ethereum.org/?#language=solidity&amp;version=0.8.24&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5IF4wLjguODsKCmNvbnRyYWN0IHRlc3QgewogICAgZW51bSBBY3Rpb25DaG9pY2VzIHsgR29MZWZ0LCBHb1JpZ2h0LCBHb1N0cmFpZ2h0LCBTaXRTdGlsbCB9CiAgICBBY3Rpb25DaG9pY2VzIGNob2ljZTsKICAgIEFjdGlvbkNob2ljZXMgY29uc3RhbnQgZGVmYXVsdENob2ljZSA9IEFjdGlvbkNob2ljZXMuR29TdHJhaWdodDsKCiAgICBmdW5jdGlvbiBzZXRHb1N0cmFpZ2h0KCkgcHVibGljIHsKICAgICAgICBjaG9pY2UgPSBBY3Rpb25DaG9pY2VzLkdvU3RyYWlnaHQ7CiAgICB9CgogICAgLy8g55Sx5LqO5p6a5Li+57G75Z6L5LiN5bGe5LqOQUJJ55qE5LiA6YOo5YiG77yM5Zug5q2k5a+55LqO5omA5pyJ5p2l6IeqIFNvbGlkaXR5IOWklumDqOeahOiwg+eUqO+8jAogICAgLy8gImdldENob2ljZSIg55qE562+5ZCN5Lya6Ieq5Yqo6KKr5pS55oiQICJnZXRDaG9pY2UoKSByZXR1cm5zICh1aW50OCki44CCCiAgICBmdW5jdGlvbiBnZXRDaG9pY2UoKSBwdWJsaWMgdmlldyByZXR1cm5zIChBY3Rpb25DaG9pY2VzKSB7CiAgICAgICAgcmV0dXJuIGNob2ljZTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXREZWZhdWx0Q2hvaWNlKCkgcHVibGljIHB1cmUgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiB1aW50KGRlZmF1bHRDaG9pY2UpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldExhcmdlc3RWYWx1ZSgpIHB1YmxpYyBwdXJlIHJldHVybnMgKEFjdGlvbkNob2ljZXMpIHsKICAgICAgICByZXR1cm4gdHlwZShBY3Rpb25DaG9pY2VzKS5tYXg7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0U21hbGxlc3RWYWx1ZSgpIHB1YmxpYyBwdXJlIHJldHVybnMgKEFjdGlvbkNob2ljZXMpIHsKICAgICAgICByZXR1cm4gdHlwZShBY3Rpb25DaG9pY2VzKS5taW47CiAgICB9Cn0=">open in Remix</a></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-comment">// SPDX-License-Identifier: GPL-3.0</span><br>pragma solidity ^<span class="hljs-number">0.8</span><span class="hljs-number">.8</span>;<br><br>contract test &#123;<br>    <span class="hljs-built_in">enum</span> ActionChoices &#123; GoLeft, GoRight, GoStraight, SitStill &#125;<br>    ActionChoices choice;<br>    ActionChoices constant defaultChoice = ActionChoices.GoStraight;<br><br>    <span class="hljs-function">function <span class="hljs-title">setGoStraight</span>() <span class="hljs-keyword">public</span></span> &#123;<br>        choice = ActionChoices.GoStraight;<br>    &#125;<br><br>    <span class="hljs-comment">// 由于枚举类型不属于ABI的一部分，因此对于所有来自 Solidity 外部的调用，</span><br>    <span class="hljs-comment">// &quot;getChoice&quot; 的签名会自动被改成 &quot;getChoice() returns (uint8)&quot;。</span><br>    <span class="hljs-function">function <span class="hljs-title">getChoice</span>() <span class="hljs-keyword">public</span> view <span class="hljs-title">returns</span> (<span class="hljs-params">ActionChoices</span>)</span> &#123;<br>        <span class="hljs-keyword">return</span> choice;<br>    &#125;<br><br>    <span class="hljs-function">function <span class="hljs-title">getDefaultChoice</span>() <span class="hljs-keyword">public</span> pure <span class="hljs-title">returns</span> (<span class="hljs-params"><span class="hljs-built_in">uint</span></span>)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">uint</span>(defaultChoice);<br>    &#125;<br><br>    <span class="hljs-function">function <span class="hljs-title">getLargestValue</span>() <span class="hljs-keyword">public</span> pure <span class="hljs-title">returns</span> (<span class="hljs-params">ActionChoices</span>)</span> &#123;<br>        <span class="hljs-keyword">return</span> type(ActionChoices).max;<br>    &#125;<br><br>    <span class="hljs-function">function <span class="hljs-title">getSmallestValue</span>() <span class="hljs-keyword">public</span> pure <span class="hljs-title">returns</span> (<span class="hljs-params">ActionChoices</span>)</span> &#123;<br>        <span class="hljs-keyword">return</span> type(ActionChoices).min;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>备注</p>
<p>枚举也可以在文件级别上声明，在合约或库定义之外。</p>
<h3 id="用户定义的值类型"><a href="#用户定义的值类型" class="headerlink" title="用户定义的值类型"></a>用户定义的值类型<a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#user-defined-value-types"></a></h3><p>一个用户定义的值类型允许在一个基本的值类型上创建一个零成本的抽象。 这类似于一个别名，但有更严格的类型要求。</p>
<p>一个用户定义的值类型是用 <code>type C is V</code> 定义的，其中 <code>C</code> 是新引入的类型的名称， <code>V</code> 必须是一个内置的值类型（“底层类型”）。 函数 <code>C.wrap</code> 被用来从底层类型转换到自定义类型。同样地， 函数 <code>C.unwrap</code> 用于从自定义类型转换到底层类型。</p>
<p>类型 <code>C</code> 没有任何运算符或附加成员函数。特别是，甚至运算符 <code>==</code> 也没有定义。 不允许对其他类型进行显式和隐式转换。</p>
<p>这种类型的值的数据表示是从底层类型中继承的，底层类型也被用于ABI中。</p>
<p>下面的例子说明了一个自定义类型 <code>UFixed256x18</code>， 代表一个有18位小数的十进制定点类型和一个最小的库来对该类型做算术运算。</p>
<p><a target="_blank" rel="noopener" href="https://remix.ethereum.org/?#language=solidity&amp;version=0.8.24&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5IF4wLjguODsKCi8vIOS9v+eUqOeUqOaIt+WumuS5ieeahOWAvOexu+Wei+ihqOekuuWNgei/m+WItjE45L2N77yMMjU25L2N5a6955qE5a6a54K557G75Z6L44CCCnR5cGUgVUZpeGVkMjU2eDE4IGlzIHVpbnQyNTY7CgovLy8g5LiA5Liq5ZyoVUZpeGVkMjU2eDE45LiK6L+b6KGM5a6a54K55pON5L2c55qE5pyA5bCP5bqT44CCCmxpYnJhcnkgRml4ZWRNYXRoIHsKICAgIHVpbnQgY29uc3RhbnQgbXVsdGlwbGllciA9IDEwKioxODsKCiAgICAvLy8g5bCG5Lik5LiqVUZpeGVkMjU2eDE455qE5pWw5a2X55u45Yqg44CC5rqi5Ye65pe25bCG6L+U5Zue77yM5L6d6Z2gdWludDI1NueahOeul+acr+ajgOafpeOAggogICAgZnVuY3Rpb24gYWRkKFVGaXhlZDI1NngxOCBhLCBVRml4ZWQyNTZ4MTggYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChVRml4ZWQyNTZ4MTgpIHsKICAgICAgICByZXR1cm4gVUZpeGVkMjU2eDE4LndyYXAoVUZpeGVkMjU2eDE4LnVud3JhcChhKSArIFVGaXhlZDI1NngxOC51bndyYXAoYikpOwogICAgfQogICAgLy8vIOWwhlVGaXhlZDI1NngxOOWSjHVpbnQyNTbnm7jkuZjjgILmuqLlh7rml7blsIbov5Tlm57vvIzkvp3pnaB1aW50MjU255qE566X5pyv5qOA5p+l44CCCiAgICBmdW5jdGlvbiBtdWwoVUZpeGVkMjU2eDE4IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChVRml4ZWQyNTZ4MTgpIHsKICAgICAgICByZXR1cm4gVUZpeGVkMjU2eDE4LndyYXAoVUZpeGVkMjU2eDE4LnVud3JhcChhKSAqIGIpOwogICAgfQogICAgLy8vIOWvueS4gOS4qlVGaXhlZDI1NngxOOexu+Wei+eahOaVsOWtl+ebuOS4i+WPluaVtOOAggogICAgLy8vIEByZXR1cm4g5LiN6LaF6L+HIGBhYCDnmoTmnIDlpKfmlbTmlbDjgIIKICAgIGZ1bmN0aW9uIGZsb29yKFVGaXhlZDI1NngxOCBhKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gVUZpeGVkMjU2eDE4LnVud3JhcChhKSAvIG11bHRpcGxpZXI7CiAgICB9CiAgICAvLy8g5bCG5LiA5LiqdWludDI1Nui9rOWMluS4uuebuOWQjOWAvOeahFVGaXhlZDI1NngxOOOAggogICAgLy8vIOWmguaenOaVtOaVsOWkquWkp++8jOWImeaBouWkjeiuoeeul+OAggogICAgZnVuY3Rpb24gdG9VRml4ZWQyNTZ4MTgodWludDI1NiBhKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKFVGaXhlZDI1NngxOCkgewogICAgICAgIHJldHVybiBVRml4ZWQyNTZ4MTgud3JhcChhICogbXVsdGlwbGllcik7CiAgICB9Cn0=">open in Remix</a></p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs actionscript"><span class="hljs-comment">// SPDX-License-Identifier: GPL-3.0</span><br>pragma solidity ^<span class="hljs-number">0.8</span><span class="hljs-number">.8</span>;<br><br><span class="hljs-comment">// 使用用户定义的值类型表示十进制18位，256位宽的定点类型。</span><br>type UFixed256x18 <span class="hljs-keyword">is</span> uint256;<br><br><span class="hljs-comment">/// 一个在UFixed256x18上进行定点操作的最小库。</span><br>library FixedMath &#123;<br>    uint constant multiplier = <span class="hljs-number">10</span>**<span class="hljs-number">18</span>;<br><br>    <span class="hljs-comment">/// 将两个UFixed256x18的数字相加。溢出时将返回，依靠uint256的算术检查。</span><br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span><span class="hljs-params">(UFixed256x18 a, UFixed256x18 b)</span> <span class="hljs-title function_">internal</span> <span class="hljs-title function_">pure</span> <span class="hljs-title function_">returns</span> <span class="hljs-params">(UFixed256x18)</span> &#123;<br>        <span class="hljs-keyword">return</span> UFixed256x18.wrap(UFixed256x18.unwrap(a) + UFixed256x18.unwrap(b));<br>    &#125;<br>    <span class="hljs-comment">/// 将UFixed256x18和uint256相乘。溢出时将返回，依靠uint256的算术检查。</span><br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">mul</span><span class="hljs-params">(UFixed256x18 a, uint256 b)</span> <span class="hljs-title function_">internal</span> <span class="hljs-title function_">pure</span> <span class="hljs-title function_">returns</span> <span class="hljs-params">(UFixed256x18)</span> &#123;<br>        <span class="hljs-keyword">return</span> UFixed256x18.wrap(UFixed256x18.unwrap(a) * b);<br>    &#125;<br>    <span class="hljs-comment">/// 对一个UFixed256x18类型的数字相下取整。</span><br>    <span class="hljs-comment">/// @return 不超过 `a` 的最大整数。</span><br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">floor</span><span class="hljs-params">(UFixed256x18 a)</span> <span class="hljs-title function_">internal</span> <span class="hljs-title function_">pure</span> <span class="hljs-title function_">returns</span> <span class="hljs-params">(uint256)</span> &#123;<br>        <span class="hljs-keyword">return</span> UFixed256x18.unwrap(a) / multiplier;<br>    &#125;<br>    <span class="hljs-comment">/// 将一个uint256转化为相同值的UFixed256x18。</span><br>    <span class="hljs-comment">/// 如果整数太大，则恢复计算。</span><br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">toUFixed256x18</span><span class="hljs-params">(uint256 a)</span> <span class="hljs-title function_">internal</span> <span class="hljs-title function_">pure</span> <span class="hljs-title function_">returns</span> <span class="hljs-params">(UFixed256x18)</span> &#123;<br>        <span class="hljs-keyword">return</span> UFixed256x18.wrap(a * multiplier);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>注意 <code>UFixed256x18.wrap</code> 和 <code>FixedMath.toUFixed256x18</code> 有相同的签名， 但执行两个非常不同的操作。 <code>UFixed256x18.wrap</code> 函数返回一个与输入的数据表示相同的 <code>UFixed256x18</code>， 而 <code>toUFixed256x18</code> 则返回一个具有相同数值的 <code>UFixed256x18</code>。</p>
<h3 id="函数类型"><a href="#函数类型" class="headerlink" title="函数类型"></a>函数类型<a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#function-types"></a></h3><p>函数类型是一种表示函数的类型。可以将一个函数赋值给另一个函数类型的变量， 也可以将一个函数作为参数进行传递，还能在函数调用中返回函数类型变量。 函数类型有两类：- <em>内部（internal）</em> 函数和 <em>外部（external）</em> 函数：</p>
<p>内部函数只能在当前合约内被调用（更具体来说， 在当前代码块内，包括内部库函数和继承的函数中）， 因为它们不能在当前合约上下文的外部被执行。 调用一个内部函数是通过跳转到它的入口标签来实现的， 就像在当前合约的内部调用一个函数。</p>
<p>外部函数由一个地址和一个函数签名组成，可以通过外部函数调用传递或者返回。</p>
<p>函数类型表示成如下的形式：</p>
<p><a target="_blank" rel="noopener" href="https://remix.ethereum.org/?#language=solidity&amp;version=0.8.24&amp;code=ZnVuY3Rpb24gKDxwYXJhbWV0ZXIgdHlwZXM+KSB7aW50ZXJuYWx8ZXh0ZXJuYWx9IFtwdXJlfHZpZXd8cGF5YWJsZV0gW3JldHVybnMgKDxyZXR1cm4gdHlwZXM+KV0=">open in Remix</a></p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">function</span> (&lt;parameter <span class="hljs-keyword">types</span>&gt;) &#123;<span class="hljs-type">internal</span>|<span class="hljs-keyword">external</span>&#125; [pure|<span class="hljs-keyword">view</span>|payable] [<span class="hljs-keyword">returns</span> (&lt;<span class="hljs-keyword">return</span> <span class="hljs-keyword">types</span>&gt;)]<br></code></pre></td></tr></table></figure>
<p>与参数类型相反，返回类型不能为空 —— 如果函数类型不需要返回， 则需要删除整个 <code>returns (&lt;return types&gt;)</code> 部分。</p>
<p>默认情况下，函数类型是内部函数，所以可以省略 <code>internal</code> 关键字。 注意，这只适用于函数类型。对于合约中定义的函数， 必须明确指定其可见性，它们没有默认类型。</p>
<p>转换：</p>
<p>当且仅当它们的参数类型相同，它们的返回类型相同，它们的内部/外部属性相同， 并且 <code>A</code> 的状态可变性比 <code>B</code> 的状态可变性更具限制性时， 一个函数类型 <code>A</code> 就可以隐式转换为一个函数类型 <code>B</code>。特别是：</p>
<ul>
<li><code>pure</code> 函数可以转换为 <code>view</code> 和 <code>非 payable</code> 函数</li>
<li><code>view</code> 函数可以转换为 <code>非 payable</code> 函数</li>
<li><code>payable</code> 函数可以转换为 <code>非 payable</code> 函数</li>
</ul>
<p>其他函数类型之间的转换是不可能的。</p>
<p>关于 <code>payable</code> 和 <code>非 payable</code> 的规则可能有点混乱， 但实质上，如果一个函数是 <code>payable</code>，这意味着 它也接受零以太的支付，所以它也是 <code>非 payable</code>。 另一方面，一个 <code>非 payable</code> 的函数将拒收发送给它的以太， 所以 <code>非 payable</code> 的函数不能被转换为 <code>payable</code> 的函数。 声明一下，拒收以太比不拒收以太更有限制性。 这意味着您可以用一个不可支付的函数覆写一个可支付的函数，但不能反过来。</p>
<p>此外，当您定义一个 <code>非 payable</code> 的函数指针时， 编译器并不强制要求被指向的函数实际拒收以太。 相反，它强制要求该函数指针永远不会被用来发送以太。 这使得我们有可能将一个 <code>payable</code> 的函数指针分配给一个 <code>非 payable</code> 的函数指针， 以确保这两种类型的函数表现相同，即都不能用来发送以太。</p>
<p>如果一个函数类型的变量没有被初始化，调用它将导致 会出现 <a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/control-structures.html#assert-and-require">异常</a>。如果您在一个函数上使用了 <code>delete</code> 之后再调用它， 也会发生同样的情况。</p>
<p>如果外部函数类型在 Solidity 的上下文中被使用， 它们将被视为 <code>function</code> 类型，它将地址和函数标识符一起编码为一个 <code>bytes24</code> 类型。</p>
<p>请注意，当前合约的公共函数既可以被当作内部函数也可以被当作外部函数使用。 如果想将一个函数当作内部函数使用，就用 <code>f</code> 调用， 如果想将其当作外部函数，使用 <code>this.f</code> 。</p>
<p>一个内部类型的函数可以被分配给一个内部函数类型的变量，无论它在哪里被定义。 这包括合约和库的私有，内部和公共函数，以及自由函数。 另一方面，外部函数类型只与公共和外部合约函数兼容。</p>
<p>备注</p>
<p>带有 <code>calldata</code> 参数的外部函数与带有 <code>calldata</code> 参数的外部函数类型不兼容。 它们与相应的带有 <code>memory</code> 参数的类型兼容。 例如，没有一个函数可以被 <code>function (string calldata) external</code> 类型的值所指向， 而 <code>function (string memory) external</code> 可以同时指向 <code>function f(string memory) external &#123;&#125;</code> 和 <code>function g(string calldata) external &#123;&#125;</code>。 这是因为对于这两个位置，参数是以同样的方式传递给函数的。 调用者不能直接将其calldata传递给外部函数，总是ABI将参数编码到内存中。 将参数标记为 <code>calldata</code> 只影响到外部函数的实现，在调用者一方的函数指针中是没有意义的。</p>
<p>警告</p>
<p>在启用了优化器的旧版优化流程中，内部函数指针的比较可能会产生意想不到的结果， 因为优化器可能会将相同的函数合并为一个，这将导致这些函数指针在比较时显示为相等， 而不是不相等。不建议进行此类比较，这会导致编译器发出警告，直到下一个重大更新版本（0.9.0）时， 该警告将升级为错误，从而禁止此类比较。</p>
<p>库合约被排除在外，因为它们需要用到 <code>delegatecall</code>， 并且 <a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/contracts.html#library-selectors">对库合约的函数选择器使用不同的ABI约定</a>。 接口中声明的函数没有定义，所以指向它们也没有意义。</p>
<p>成员： 外部（或公共）函数有以下成员：</p>
<ul>
<li><code>.address</code> 返回该函数的合约地址。</li>
<li><code>.selector</code> 返回 <a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/abi-spec.html#abi-function-selector">ABI 函数选择器</a></li>
</ul>
<p>备注</p>
<p>外部（或公共）函数曾经有额外的成员 <code>.gas(uint)</code> 和 <code>.value(uint)</code>。 这些在 Solidity 0.6.2 中被废弃，并在 Solidity 0.7.0 中被移除。取而代之的是 使用 <code>&#123;gas: ...&#125;</code> 和 <code>&#123;value: ...&#125;</code> 来分别指定发送到函数的燃料量或以太（wei为单位）量。 参见 <a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/control-structures.html#external-function-calls">外部函数调用</a> 以获得更多信息。</p>
<p>以下例子展示如何使用这些成员：</p>
<p><a target="_blank" rel="noopener" href="https://remix.ethereum.org/?#language=solidity&amp;version=0.8.24&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC42LjQgPDAuOS4wOwoKY29udHJhY3QgRXhhbXBsZSB7CiAgICBmdW5jdGlvbiBmKCkgcHVibGljIHBheWFibGUgcmV0dXJucyAoYnl0ZXM0KSB7CiAgICAgICAgYXNzZXJ0KHRoaXMuZi5hZGRyZXNzID09IGFkZHJlc3ModGhpcykpOwogICAgICAgIHJldHVybiB0aGlzLmYuc2VsZWN0b3I7CiAgICB9CgogICAgZnVuY3Rpb24gZygpIHB1YmxpYyB7CiAgICAgICAgdGhpcy5me2dhczogMTAsIHZhbHVlOiA4MDB9KCk7CiAgICB9Cn0=">open in Remix</a></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">// SPDX-License-Identifier: GPL-3.0</span><br>pragma solidity &gt;=<span class="hljs-number">0.6</span><span class="hljs-number">.4</span> &lt;<span class="hljs-number">0.9</span><span class="hljs-number">.0</span>;<br><br>contract Example &#123;<br>    function f() <span class="hljs-keyword">public</span> payable returns (bytes4) &#123;<br>        assert(<span class="hljs-keyword">this</span>.f.address == address(<span class="hljs-keyword">this</span>));<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.f.selector;<br>    &#125;<br><br>    function g() <span class="hljs-keyword">public</span> &#123;<br>        <span class="hljs-keyword">this</span>.f&#123;gas: <span class="hljs-number">10</span>, value: <span class="hljs-number">800</span>&#125;();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>以下例子展示如何使用内部函数类型：</p>
<p><a target="_blank" rel="noopener" href="https://remix.ethereum.org/?#language=solidity&amp;version=0.8.24&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjE2IDwwLjkuMDsKCmxpYnJhcnkgQXJyYXlVdGlscyB7CiAgICAvLyDlhoXpg6jlh73mlbDlj6/ku6XlnKjlhoXpg6jlupPlh73mlbDkuK3kvb/nlKjvvIzlm6DkuLrlroPku6zlsIbmmK/lkIzkuIDku6PnoIHkuIrkuIvmlofnmoTkuIDpg6jliIYKICAgIGZ1bmN0aW9uIG1hcCh1aW50W10gbWVtb3J5IHNlbGYsIGZ1bmN0aW9uICh1aW50KSBwdXJlIHJldHVybnMgKHVpbnQpIGYpCiAgICAgICAgaW50ZXJuYWwKICAgICAgICBwdXJlCiAgICAgICAgcmV0dXJucyAodWludFtdIG1lbW9yeSByKQogICAgewogICAgICAgIHIgPSBuZXcgdWludFtdKHNlbGYubGVuZ3RoKTsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBzZWxmLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHJbaV0gPSBmKHNlbGZbaV0pOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiByZWR1Y2UoCiAgICAgICAgdWludFtdIG1lbW9yeSBzZWxmLAogICAgICAgIGZ1bmN0aW9uICh1aW50LCB1aW50KSBwdXJlIHJldHVybnMgKHVpbnQpIGYKICAgICkKICAgICAgICBpbnRlcm5hbAogICAgICAgIHB1cmUKICAgICAgICByZXR1cm5zICh1aW50IHIpCiAgICB7CiAgICAgICAgciA9IHNlbGZbMF07CiAgICAgICAgZm9yICh1aW50IGkgPSAxOyBpIDwgc2VsZi5sZW5ndGg7IGkrKykgewogICAgICAgICAgICByID0gZihyLCBzZWxmW2ldKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gcmFuZ2UodWludCBsZW5ndGgpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludFtdIG1lbW9yeSByKSB7CiAgICAgICAgciA9IG5ldyB1aW50W10obGVuZ3RoKTsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCByLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHJbaV0gPSBpOwogICAgICAgIH0KICAgIH0KfQoKCmNvbnRyYWN0IFB5cmFtaWQgewogICAgdXNpbmcgQXJyYXlVdGlscyBmb3IgKjsKCiAgICBmdW5jdGlvbiBweXJhbWlkKHVpbnQgbCkgcHVibGljIHB1cmUgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBBcnJheVV0aWxzLnJhbmdlKGwpLm1hcChzcXVhcmUpLnJlZHVjZShzdW0pOwogICAgfQoKICAgIGZ1bmN0aW9uIHNxdWFyZSh1aW50IHgpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiB4ICogeDsKICAgIH0KCiAgICBmdW5jdGlvbiBzdW0odWludCB4LCB1aW50IHkpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiB4ICsgeTsKICAgIH0KfQ==">open in Remix</a></p>
<figure class="highlight zephir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs zephir"><span class="hljs-comment">// SPDX-License-Identifier: GPL-3.0</span><br>pragma solidity &gt;=<span class="hljs-number">0.4</span><span class="hljs-number">.16</span> &lt;<span class="hljs-number">0.9</span><span class="hljs-number">.0</span>;<br><br>library ArrayUtils &#123;<br>    <span class="hljs-comment">// 内部函数可以在内部库函数中使用，因为它们将是同一代码上下文的一部分</span><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">map</span><span class="hljs-params">(<span class="hljs-keyword">uint</span>[] memory <span class="hljs-keyword">self</span>, <span class="hljs-keyword">function</span> <span class="hljs-params">(<span class="hljs-keyword">uint</span>)</span> pure returns <span class="hljs-params">(<span class="hljs-keyword">uint</span>)</span> f)</span></span><br><span class="hljs-function">        <span class="hljs-title">internal</span></span><br><span class="hljs-function">        <span class="hljs-title">pure</span></span><br><span class="hljs-function">        <span class="hljs-title">returns</span> <span class="hljs-params">(<span class="hljs-keyword">uint</span>[] memory r)</span></span><br><span class="hljs-function">    </span>&#123;<br>        r = <span class="hljs-keyword">new</span> <span class="hljs-keyword">uint</span>[](<span class="hljs-keyword">self</span>.length);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">uint</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-keyword">self</span>.length; i++) &#123;<br>            r[i] = f(<span class="hljs-keyword">self</span>[i]);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">reduce</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">        <span class="hljs-keyword">uint</span>[] memory <span class="hljs-keyword">self</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">        <span class="hljs-keyword">function</span> <span class="hljs-params">(<span class="hljs-keyword">uint</span>, <span class="hljs-keyword">uint</span>)</span> pure returns <span class="hljs-params">(<span class="hljs-keyword">uint</span>)</span> f</span></span><br><span class="hljs-params"><span class="hljs-function">    )</span></span><br><span class="hljs-function">        <span class="hljs-title">internal</span></span><br><span class="hljs-function">        <span class="hljs-title">pure</span></span><br><span class="hljs-function">        <span class="hljs-title">returns</span> <span class="hljs-params">(<span class="hljs-keyword">uint</span> r)</span></span><br><span class="hljs-function">    </span>&#123;<br>        r = <span class="hljs-keyword">self</span>[<span class="hljs-number">0</span>];<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">uint</span> i = <span class="hljs-number">1</span>; i &lt; <span class="hljs-keyword">self</span>.length; i++) &#123;<br>            r = f(r, <span class="hljs-keyword">self</span>[i]);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">range</span><span class="hljs-params">(<span class="hljs-keyword">uint</span> length)</span> <span class="hljs-title">internal</span> <span class="hljs-title">pure</span> <span class="hljs-title">returns</span> <span class="hljs-params">(<span class="hljs-keyword">uint</span>[] memory r)</span> </span>&#123;<br>        r = <span class="hljs-keyword">new</span> <span class="hljs-keyword">uint</span>[](length);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">uint</span> i = <span class="hljs-number">0</span>; i &lt; r.length; i++) &#123;<br>            r[i] = i;<br>        &#125;<br>    &#125;<br>&#125;<br><br><br>contract Pyramid &#123;<br>    using ArrayUtils <span class="hljs-keyword">for</span> *;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pyramid</span><span class="hljs-params">(<span class="hljs-keyword">uint</span> l)</span> <span class="hljs-title">public</span> <span class="hljs-title">pure</span> <span class="hljs-title">returns</span> <span class="hljs-params">(<span class="hljs-keyword">uint</span>)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> ArrayUtils.range(l).map(square).reduce(sum);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">square</span><span class="hljs-params">(<span class="hljs-keyword">uint</span> x)</span> <span class="hljs-title">internal</span> <span class="hljs-title">pure</span> <span class="hljs-title">returns</span> <span class="hljs-params">(<span class="hljs-keyword">uint</span>)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> x * x;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sum</span><span class="hljs-params">(<span class="hljs-keyword">uint</span> x, <span class="hljs-keyword">uint</span> y)</span> <span class="hljs-title">internal</span> <span class="hljs-title">pure</span> <span class="hljs-title">returns</span> <span class="hljs-params">(<span class="hljs-keyword">uint</span>)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> x + y;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>另一个使用外部函数类型的例子：</p>
<p><a target="_blank" rel="noopener" href="https://remix.ethereum.org/?#language=solidity&amp;version=0.8.24&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjIyIDwwLjkuMDsKCgpjb250cmFjdCBPcmFjbGUgewogICAgc3RydWN0IFJlcXVlc3QgewogICAgICAgIGJ5dGVzIGRhdGE7CiAgICAgICAgZnVuY3Rpb24odWludCkgZXh0ZXJuYWwgY2FsbGJhY2s7CiAgICB9CgogICAgUmVxdWVzdFtdIHByaXZhdGUgcmVxdWVzdHM7CiAgICBldmVudCBOZXdSZXF1ZXN0KHVpbnQpOwoKICAgIGZ1bmN0aW9uIHF1ZXJ5KGJ5dGVzIG1lbW9yeSBkYXRhLCBmdW5jdGlvbih1aW50KSBleHRlcm5hbCBjYWxsYmFjaykgcHVibGljIHsKICAgICAgICByZXF1ZXN0cy5wdXNoKFJlcXVlc3QoZGF0YSwgY2FsbGJhY2spKTsKICAgICAgICBlbWl0IE5ld1JlcXVlc3QocmVxdWVzdHMubGVuZ3RoIC0gMSk7CiAgICB9CgogICAgZnVuY3Rpb24gcmVwbHkodWludCByZXF1ZXN0SUQsIHVpbnQgcmVzcG9uc2UpIHB1YmxpYyB7CiAgICAgICAgLy8g6L+Z6YeM6KaB5qOA5p+l55qE5piv6LCD55So6L+U5Zue5piv5ZCm5p2l6Ieq5Y+v5L+h55qE5p2l5rqQCiAgICAgICAgcmVxdWVzdHNbcmVxdWVzdElEXS5jYWxsYmFjayhyZXNwb25zZSk7CiAgICB9Cn0KCgpjb250cmFjdCBPcmFjbGVVc2VyIHsKICAgIE9yYWNsZSBjb25zdGFudCBwcml2YXRlIE9SQUNMRV9DT05TVCA9IE9yYWNsZShhZGRyZXNzKDB4MDAwMDAwMDAyMTlhYjU0MDM1NmNCQjgzOUNiZTA1MzAzZDc3MDVGYSkpOyAvLyDlt7Lnn6XnmoTlkIjnuqYKICAgIHVpbnQgcHJpdmF0ZSBleGNoYW5nZVJhdGU7CgogICAgZnVuY3Rpb24gYnV5U29tZXRoaW5nKCkgcHVibGljIHsKICAgICAgICBPUkFDTEVfQ09OU1QucXVlcnkoIlVTRCIsIHRoaXMub3JhY2xlUmVzcG9uc2UpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsZVJlc3BvbnNlKHVpbnQgcmVzcG9uc2UpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZSgKICAgICAgICAgICAgbXNnLnNlbmRlciA9PSBhZGRyZXNzKE9SQUNMRV9DT05TVCksCiAgICAgICAgICAgICJPbmx5IG9yYWNsZSBjYW4gY2FsbCB0aGlzLiIKICAgICAgICApOwogICAgICAgIGV4Y2hhbmdlUmF0ZSA9IHJlc3BvbnNlOwogICAgfQp9">open in Remix</a></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-comment">// SPDX-License-Identifier: GPL-3.0</span><br>pragma solidity &gt;=<span class="hljs-number">0.4</span><span class="hljs-number">.22</span> &lt;<span class="hljs-number">0.9</span><span class="hljs-number">.0</span>;<br><br><br>contract Oracle &#123;<br>    <span class="hljs-keyword">struct</span> Request &#123;<br>        bytes data;<br>        function(<span class="hljs-built_in">uint</span>) external callback;<br>    &#125;<br><br>    Request[] <span class="hljs-keyword">private</span> requests;<br>    <span class="hljs-function"><span class="hljs-keyword">event</span> <span class="hljs-title">NewRequest</span>(<span class="hljs-params"><span class="hljs-built_in">uint</span></span>)</span>;<br><br>    <span class="hljs-function">function <span class="hljs-title">query</span>(<span class="hljs-params">bytes memory data, function(<span class="hljs-built_in">uint</span></span>) external callback) <span class="hljs-keyword">public</span></span> &#123;<br>        requests.push(Request(data, callback));<br>        <span class="hljs-function">emit <span class="hljs-title">NewRequest</span>(<span class="hljs-params">requests.length - <span class="hljs-number">1</span></span>)</span>;<br>    &#125;<br><br>    <span class="hljs-function">function <span class="hljs-title">reply</span>(<span class="hljs-params"><span class="hljs-built_in">uint</span> requestID, <span class="hljs-built_in">uint</span> response</span>) <span class="hljs-keyword">public</span></span> &#123;<br>        <span class="hljs-comment">// 这里要检查的是调用返回是否来自可信的来源</span><br>        requests[requestID].callback(response);<br>    &#125;<br>&#125;<br><br><br>contract OracleUser &#123;<br>    Oracle constant <span class="hljs-keyword">private</span> ORACLE_CONST = Oracle(address(<span class="hljs-number">0x00000000219ab540356cBB839Cbe05303d7705Fa</span>)); <span class="hljs-comment">// 已知的合约</span><br>    <span class="hljs-built_in">uint</span> <span class="hljs-keyword">private</span> exchangeRate;<br><br>    <span class="hljs-function">function <span class="hljs-title">buySomething</span>() <span class="hljs-keyword">public</span></span> &#123;<br>        ORACLE_CONST.query(<span class="hljs-string">&quot;USD&quot;</span>, <span class="hljs-keyword">this</span>.oracleResponse);<br>    &#125;<br><br>    <span class="hljs-function">function <span class="hljs-title">oracleResponse</span>(<span class="hljs-params"><span class="hljs-built_in">uint</span> response</span>) <span class="hljs-keyword">public</span></span> &#123;<br>        require(<br>            msg.sender == address(ORACLE_CONST),<br>            <span class="hljs-string">&quot;Only oracle can call this.&quot;</span><br>        );<br>        exchangeRate = response;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>备注</p>
<p>Lambda 或内联函数是计划中的，但还不支持。</p>
<h2 id="引用类型"><a href="#引用类型" class="headerlink" title="引用类型"></a>引用类型<a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#reference-types"></a></h2><p>引用类型的值可以通过多个不同的名称进行修改。 这与值类型形成鲜明对比，在值类型的变量被使用时，您会得到一个独立的副本。 正因为如此，对引用类型的处理要比对值类型的处理更加谨慎。目前， 引用类型包括结构、数组和映射。如果您使用一个引用类型， 您必须明确地提供存储该类型的数据区域。 <code>memory</code> （其寿命限于外部函数调用）， <code>storage</code> （存储状态变量的位置，其寿命限于合约的寿命） 或 <code>calldata</code> （包含函数参数的特殊数据位置）。</p>
<p>改变数据位置的赋值或类型转换将总是导致自动复制操作， 而同一数据位置内的赋值只在某些情况下对存储类型进行复制。</p>
<h3 id="数据位置"><a href="#数据位置" class="headerlink" title="数据位置"></a>数据位置<a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#data-location"></a></h3><p>每个引用类型都有一个额外的属性，即 “数据位置”， 关于它的存储位置。有三个数据位置。 <code>memory</code>, <code>storage</code> 和 <code>calldata</code>。 Calldata是一个不可修改的、非持久性的区域，用于存储函数参数，其行为主要类似于memory。</p>
<p>备注</p>
<p>如果可以的话，尽量使用 <code>calldata</code> 作为数据位置，因为这样可以避免复制， 也可以确保数据不能被修改。使用 <code>calldata</code> 数据位置的数组和结构也可以从函数中返回， 但不可能分配这种类型。</p>
<p>备注</p>
<p>在0.6.9版本之前，引用型参数的数据位置被限制在外部函数中的 <code>calldata</code>， 公开函数中的 <code>memory</code>，以及内部和私有函数中的 <code>memory</code> 或 <code>storage</code>。 现在 <code>memory</code> 和 <code>calldata</code> 在所有函数中都被允许使用，无论其可见性如何。</p>
<p>备注</p>
<p>在0.5.0版本之前，数据位置可以省略，并且会根据变量的种类、函数类型等默认为不同的位置， 但现在所有的复杂类型都必须给出一个明确的数据位置。</p>
<h4 id="数据位置和分配行为"><a href="#数据位置和分配行为" class="headerlink" title="数据位置和分配行为"></a>数据位置和分配行为<a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#data-location-assignment"></a></h4><p>数据位置不仅与数据的持久性有关，而且也与分配的语义有关：</p>
<ul>
<li>在 <code>storage</code> 和 <code>memory</code> 之间的分配（或从 <code>calldata</code> 中分配） 总是创建一个独立的拷贝。</li>
<li>从 <code>memory</code> 到 <code>memory</code> 的赋值只创建引用。 这意味着对一个内存变量的改变在所有其他引用相同数据的内存变量中也是可见的。</li>
<li>从 <code>storage</code> 到 <strong>local</strong> 存储变量的赋值也只赋值一个引用。</li>
<li>所有其他对 <code>storage</code> 的赋值总是拷贝的。 这种情况的例子是对状态变量或存储结构类型的局部变量成员的赋值， 即使局部变量本身只是一个引用。</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://remix.ethereum.org/?#language=solidity&amp;version=0.8.24&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC41LjAgPDAuOS4wOwoKY29udHJhY3QgQyB7CiAgICAvLyB4IOeahOaVsOaNruWtmOWCqOS9jee9ruaYryBzdG9yYWdl44CCCiAgICAvLyDov5nmmK/llK/kuIDlj6/ku6XnnIHnlaXmlbDmja7kvY3nva7nmoTlnLDmlrnjgIIKICAgIHVpbnRbXSB4OwoKICAgIC8vIG1lbW9yeUFycmF5IOeahOaVsOaNruWtmOWCqOS9jee9ruaYryBtZW1vcnnjgIIKICAgIGZ1bmN0aW9uIGYodWludFtdIG1lbW9yeSBtZW1vcnlBcnJheSkgcHVibGljIHsKICAgICAgICB4ID0gbWVtb3J5QXJyYXk7IC8vIOWwhuaVtOS4quaVsOe7hOaLt+i0neWIsCBzdG9yYWdlIOS4re+8jOWPr+ihjAogICAgICAgIHVpbnRbXSBzdG9yYWdlIHkgPSB4OyAvLyDliIbphY3kuIDkuKrmjIfpkojvvIzlhbbkuK0geSDnmoTmlbDmja7lrZjlgqjkvY3nva7mmK8gc3RvcmFnZe+8jOWPr+ihjAogICAgICAgIHlbN107IC8vIOi/lOWbnuesrCA4IOS4quWFg+e0oO+8jOWPr+ihjAogICAgICAgIHkucG9wKCk7IC8vIOmAmui/h3nkv67mlLl477yM5Y+v6KGMCiAgICAgICAgZGVsZXRlIHg7IC8vIOa4hemZpOaVsOe7hO+8jOWQjOaXtuS/ruaUuSB577yM5Y+v6KGMCiAgICAgICAgLy8g5LiL6Z2i55qE5bCx5LiN5Y+v6KGM5LqG77yb6ZyA6KaB5ZyoIHN0b3JhZ2Ug5Lit5Yib5bu65paw55qE5pyq5ZG95ZCN55qE5Li05pe25pWw57uE77yMLwogICAgICAgIC8vIOS9hiBzdG9yYWdlIOaYr+KAnOmdmeaAgeKAneWIhumFjeeahO+8mgogICAgICAgIC8vIHkgPSBtZW1vcnlBcnJheTsKICAgICAgICAvLyDlkIzmoLfvvIwgImRlbGV0ZSB5IiDkuZ/mmK/ml6DmlYjnmoTvvIwKICAgICAgICAvLyDlm6DkuLrlr7nlvJXnlKjlrZjlgqjlr7nosaHnmoTlsYDpg6jlj5jph4/nmoTotYvlgLzlj6rog73ku47njrDmnInnmoTlrZjlgqjlr7nosaHkuK3ov5vooYzjgIIKICAgICAgICAvLyDlroPlsIYg4oCc6YeN572u4oCdIOaMh+mSiO+8jOS9huayoeacieS7u+S9leWQiOeQhueahOS9jee9ruWPr+S7peaMh+WQkeWug+OAggogICAgICAgIC8vIOabtOWkmue7huiKguingSAiZGVsZXRlIiDmk43kvZznrKbnmoTmlofmoaPjgIIKICAgICAgICAvLyBkZWxldGUgeTsKICAgICAgICBnKHgpOyAvLyDosIPnlKggZyDlh73mlbDvvIzlkIzml7bnp7vkuqTlr7kgeCDnmoTlvJXnlKgKICAgICAgICBoKHgpOyAvLyDosIPnlKggaCDlh73mlbDvvIzlkIzml7blnKggbWVtb3J5IOS4reWIm+W7uuS4gOS4queLrOeri+eahOS4tOaXtuaLt+i0nQogICAgfQoKICAgIGZ1bmN0aW9uIGcodWludFtdIHN0b3JhZ2UpIGludGVybmFsIHB1cmUge30KICAgIGZ1bmN0aW9uIGgodWludFtdIG1lbW9yeSkgcHVibGljIHB1cmUge30KfQ==">open in Remix</a></p>
<figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs d"><span class="hljs-comment">// SPDX-License-Identifier: GPL-3.0</span><br><span class="hljs-keyword">pragma</span> solidity &gt;=<span class="hljs-number">0.5</span><span class="hljs-number">.0</span> &lt;<span class="hljs-number">0.9</span><span class="hljs-number">.0</span>;<br><br>contract C &#123;<br>    <span class="hljs-comment">// x 的数据存储位置是 storage。</span><br>    <span class="hljs-comment">// 这是唯一可以省略数据位置的地方。</span><br>    <span class="hljs-built_in">uint</span>[] x;<br><br>    <span class="hljs-comment">// memoryArray 的数据存储位置是 memory。</span><br>    <span class="hljs-built_in">function</span> f(<span class="hljs-built_in">uint</span>[] memory memoryArray) <span class="hljs-keyword">public</span> &#123;<br>        x = memoryArray; <span class="hljs-comment">// 将整个数组拷贝到 storage 中，可行</span><br>        <span class="hljs-built_in">uint</span>[] storage y = x; <span class="hljs-comment">// 分配一个指针，其中 y 的数据存储位置是 storage，可行</span><br>        y[<span class="hljs-number">7</span>]; <span class="hljs-comment">// 返回第 8 个元素，可行</span><br>        y.pop(); <span class="hljs-comment">// 通过y修改x，可行</span><br>        <span class="hljs-keyword">delete</span> x; <span class="hljs-comment">// 清除数组，同时修改 y，可行</span><br>        <span class="hljs-comment">// 下面的就不可行了；需要在 storage 中创建新的未命名的临时数组，/</span><br>        <span class="hljs-comment">// 但 storage 是“静态”分配的：</span><br>        <span class="hljs-comment">// y = memoryArray;</span><br>        <span class="hljs-comment">// 同样， &quot;delete y&quot; 也是无效的，</span><br>        <span class="hljs-comment">// 因为对引用存储对象的局部变量的赋值只能从现有的存储对象中进行。</span><br>        <span class="hljs-comment">// 它将 “重置” 指针，但没有任何合理的位置可以指向它。</span><br>        <span class="hljs-comment">// 更多细节见 &quot;delete&quot; 操作符的文档。</span><br>        <span class="hljs-comment">// delete y;</span><br>        g(x); <span class="hljs-comment">// 调用 g 函数，同时移交对 x 的引用</span><br>        h(x); <span class="hljs-comment">// 调用 h 函数，同时在 memory 中创建一个独立的临时拷贝</span><br>    &#125;<br><br>    <span class="hljs-built_in">function</span> g(<span class="hljs-built_in">uint</span>[] storage) internal <span class="hljs-keyword">pure</span> &#123;&#125;<br>    <span class="hljs-built_in">function</span> h(<span class="hljs-built_in">uint</span>[] memory) <span class="hljs-keyword">public</span> <span class="hljs-keyword">pure</span> &#123;&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组<a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#arrays"></a></h3><p>数组可以在声明时指定长度，也可以动态调整大小。</p>
<p>一个元素类型为 <code>T</code>，固定长度为 <code>k</code> 的数组可以声明为 <code>T[k]</code>， 而动态数组声明为 <code>T[]</code>。</p>
<p>例如，一个由5个 <code>uint</code> 的动态数组组成的数组被写成 <code>uint[][5]</code>。 与其他一些语言相比, 这种记法是相反的。 在Solidity中, <code>X[3]</code> 总是一个包含三个 <code>X</code> 类型元素的数组， 即使 <code>X</code> 本身是一个数组。 这在其他语言中是不存在的，如C语言。</p>
<p>索引是基于零的，访问方向与声明相反。</p>
<p>例如，如果您有一个变量 <code>uint[][5] memory x</code>，您用 <code>x[2][6]</code> 访问第三个动态数组中的第七个 <code>uint</code>， 要访问第三个动态数组，用 <code>x[2]</code>。同样，如果您有一个数组 <code>T[5] a</code> 的类型 <code>T</code>， 也可以是一个数组，那么 <code>a[2]</code> 总是有类型 <code>T</code>。</p>
<p>数组元素可以是任何类型，包括映射或结构体。 并适用于类型的一般限制，映射只能存储在 <code>storage</code> 数据位置， 公开可见的函数需要参数是 <a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/abi-spec.html#abi">ABI类型</a>。</p>
<p>可以将状态变量数组标记为 <code>public</code>， 并让Solidity创建一个 <a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/contracts.html#visibility-and-getters">getter</a> 函数。数字索引成为该函数的一个必要参数。</p>
<p>访问一个超过它的末端的数组会导致一个失败的断言。 方法 <code>.push()</code> 和 <code>.push(value)</code> 可以用来在动态大小的数组末端追加一个新的元素， 其中 <code>.push()</code> 追加一个零初始化的元素并返回它的引用。</p>
<p>备注</p>
<p>动态大小的数组只能在存储中调整大小。 在内存中，这样的数组可以是任意大小的，但是一旦分配了数组，就不能改变数组的大小。</p>
<h4 id="bytes-和-string-类型的数组"><a href="#bytes-和-string-类型的数组" class="headerlink" title="bytes 和 string 类型的数组"></a><code>bytes</code> 和 <code>string</code> 类型的数组<a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#bytes-string"></a></h4><p><code>bytes</code> 和 <code>string</code> 类型的变量是特殊的数组。 <code>bytes</code> 类似于 <code>bytes1[]</code>， 但它在 calldata 中会被“紧打包”（译者注：将元素连续地存在一起，不会按每 32 字节一单元的方式来存放）。 <code>string</code> 与 <code>bytes</code> 相同，但不允许用长度或索引来访问。</p>
<p>Solidity没有字符串操作函数，但有第三方的字符串库。 您也可以用 <code>keccak256(abi.encodePacked(s1)) == keccak256(abi.encodePacked(s2))</code> 来比较两个字符串的keccak256-hash，用 <code>string.concat(s1, s2)</code> 来连接两个字符串。</p>
<p>您应该使用 <code>bytes</code> 而不是 <code>bytes1[]</code>，因为它更便宜， 因为在 <code>memory</code> 中使用 <code>bytes1[]</code> 会在元素之间增加31个填充字节。 请注意，在 <code>storage</code> 中，由于紧打包，没有填充，参见 <a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/internals/layout_in_storage.html#bytes-and-string">字节和字符串</a>。 一般来说，对于任意长度的原始字节数据使用 <code>bytes</code>，对于任意长度的字符串（UTF-8）数据使用 <code>string</code>。 如果您能将长度限制在一定的字节数，总是使用 <code>bytes1</code> 到 <code>bytes32</code> 中的一种值类型，因为它们更便宜。</p>
<p>备注</p>
<p>如果想要访问以字节表示的字符串 <code>s</code>， 请使用 <code>bytes(s).length</code> / <code>bytes(s)[7] = &#39;x&#39;;</code>。 注意这时您访问的是 UTF-8 形式的低级 bytes 类型，而不是单个的字符。</p>
<h4 id="函数-bytes-concat-和-string-concat"><a href="#函数-bytes-concat-和-string-concat" class="headerlink" title="函数 bytes.concat 和 string.concat"></a>函数 <code>bytes.concat</code> 和 <code>string.concat</code><a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#bytes-concat-string-concat"></a></h4><p>您可以使用 <code>string.concat</code> 连接任意数量的 <code>string</code> 值。 该函数返回一个单一的 <code>string memory</code> 数组，其中包含没有填充的参数内容。 如果您想使用不能隐式转换为 <code>string</code> 的其他类型的参数，您需要先将它们转换为 <code>string</code>。</p>
<p>同样， <code>bytes.concat</code> 函数可以连接任意数量的 <code>bytes</code> 或 <code>bytes1 ... bytes32</code> 值。 该函数返回一个单一的 <code>bytes memory</code> 数组，其中包含没有填充的参数内容。 如果您想使用字符串参数或其他不能隐式转换为 <code>bytes</code> 的类型， 您需要先将它们转换为 <code>bytes</code> 或 <code>bytes1</code> /…/ <code>bytes32</code>。</p>
<p><a target="_blank" rel="noopener" href="https://remix.ethereum.org/?#language=solidity&amp;version=0.8.24&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5IF4wLjguMTI7Cgpjb250cmFjdCBDIHsKICAgIHN0cmluZyBzID0gIlN0b3JhZ2UiOwogICAgZnVuY3Rpb24gZihieXRlcyBjYWxsZGF0YSBiYywgc3RyaW5nIG1lbW9yeSBzbSwgYnl0ZXMxNiBiKSBwdWJsaWMgdmlldyB7CiAgICAgICAgc3RyaW5nIG1lbW9yeSBjb25jYXRTdHJpbmcgPSBzdHJpbmcuY29uY2F0KHMsIHN0cmluZyhiYyksICJMaXRlcmFsIiwgc20pOwogICAgICAgIGFzc2VydCgoYnl0ZXMocykubGVuZ3RoICsgYmMubGVuZ3RoICsgNyArIGJ5dGVzKHNtKS5sZW5ndGgpID09IGJ5dGVzKGNvbmNhdFN0cmluZykubGVuZ3RoKTsKCiAgICAgICAgYnl0ZXMgbWVtb3J5IGNvbmNhdEJ5dGVzID0gYnl0ZXMuY29uY2F0KGJ5dGVzKHMpLCBiYywgYmNbOjJdLCAiTGl0ZXJhbCIsIGJ5dGVzKHNtKSwgYik7CiAgICAgICAgYXNzZXJ0KChieXRlcyhzKS5sZW5ndGggKyBiYy5sZW5ndGggKyAyICsgNyArIGJ5dGVzKHNtKS5sZW5ndGggKyBiLmxlbmd0aCkgPT0gY29uY2F0Qnl0ZXMubGVuZ3RoKTsKICAgIH0KfQ==">open in Remix</a></p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs maxima">// SPDX-License-Identifier: GPL-<span class="hljs-number">3.0</span><br>pragma solidity ^<span class="hljs-number">0.8</span><span class="hljs-number">.12</span>;<br><br><span class="hljs-built_in">contract</span> C &#123;<br>    <span class="hljs-built_in">string</span> s = <span class="hljs-string">&quot;Storage&quot;</span>;<br>    function f(bytes calldata bc, <span class="hljs-built_in">string</span> memory sm, bytes16 b) public <span class="hljs-built_in">view</span> &#123;<br>        <span class="hljs-built_in">string</span> memory concatString = <span class="hljs-built_in">string</span>.<span class="hljs-built_in">concat</span>(s, <span class="hljs-built_in">string</span>(bc), <span class="hljs-string">&quot;Literal&quot;</span>, sm);<br>        assert((bytes(s).<span class="hljs-built_in">length</span> + bc.<span class="hljs-built_in">length</span> + <span class="hljs-number">7</span> + bytes(sm).<span class="hljs-built_in">length</span>) == bytes(concatString).<span class="hljs-built_in">length</span>);<br><br>        bytes memory concatBytes = bytes.<span class="hljs-built_in">concat</span>(bytes(s), bc, bc[:<span class="hljs-number">2</span>], <span class="hljs-string">&quot;Literal&quot;</span>, bytes(sm), b);<br>        assert((bytes(s).<span class="hljs-built_in">length</span> + bc.<span class="hljs-built_in">length</span> + <span class="hljs-number">2</span> + <span class="hljs-number">7</span> + bytes(sm).<span class="hljs-built_in">length</span> + b.<span class="hljs-built_in">length</span>) == concatBytes.<span class="hljs-built_in">length</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>如果您不带参数调用 <code>string.concat</code> 或 <code>bytes.concat</code>，它们会返回一个空数组。</p>
<h4 id="创建内存数组"><a href="#创建内存数组" class="headerlink" title="创建内存数组"></a>创建内存数组<a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#index-20"></a></h4><p>具有动态长度的内存数组可以使用 <code>new</code> 操作符创建。 与存储数组不同的是，<strong>不可能</strong> 调整内存数组的大小（例如， <code>.push</code> 成员函数不可用）。 您必须事先计算出所需的大小，或者创建一个新的内存数组并复制每个元素。</p>
<p>正如Solidity中的所有变量一样，新分配的数组元素总是以 <a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/control-structures.html#default-value">默认值</a> 进行初始化。</p>
<p><a target="_blank" rel="noopener" href="https://remix.ethereum.org/?#language=solidity&amp;version=0.8.24&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjE2IDwwLjkuMDsKCmNvbnRyYWN0IEMgewogICAgZnVuY3Rpb24gZih1aW50IGxlbikgcHVibGljIHB1cmUgewogICAgICAgIHVpbnRbXSBtZW1vcnkgYSA9IG5ldyB1aW50W10oNyk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGIgPSBuZXcgYnl0ZXMobGVuKTsKICAgICAgICBhc3NlcnQoYS5sZW5ndGggPT0gNyk7CiAgICAgICAgYXNzZXJ0KGIubGVuZ3RoID09IGxlbik7CiAgICAgICAgYVs2XSA9IDg7CiAgICB9Cn0=">open in Remix</a></p>
<figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs d"><span class="hljs-comment">// SPDX-License-Identifier: GPL-3.0</span><br><span class="hljs-keyword">pragma</span> solidity &gt;=<span class="hljs-number">0.4</span><span class="hljs-number">.16</span> &lt;<span class="hljs-number">0.9</span><span class="hljs-number">.0</span>;<br><br>contract C &#123;<br>    <span class="hljs-built_in">function</span> f(<span class="hljs-built_in">uint</span> len) <span class="hljs-keyword">public</span> <span class="hljs-keyword">pure</span> &#123;<br>        <span class="hljs-built_in">uint</span>[] memory a = <span class="hljs-keyword">new</span> <span class="hljs-built_in">uint</span>[](<span class="hljs-number">7</span>);<br>        bytes memory b = <span class="hljs-keyword">new</span> bytes(len);<br>        <span class="hljs-keyword">assert</span>(a.length == <span class="hljs-number">7</span>);<br>        <span class="hljs-keyword">assert</span>(b.length == len);<br>        a[<span class="hljs-number">6</span>] = <span class="hljs-number">8</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="数组字面常数"><a href="#数组字面常数" class="headerlink" title="数组字面常数"></a>数组字面常数<a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#index-21"></a></h4><p>数组字面常数表达式是一个逗号分隔的一个或多个表达式的列表，用方括号（ <code>[...]</code> ）括起来。 例如， <code>[1, a, f(3)]</code>。数组字面常数的类型确定如下：</p>
<p>它总是一个静态大小的内存数组，其长度是表达式的数量。</p>
<p>数组的基本类型是列表上第一个表达式的类型，这样所有其他表达式都可以隐含地转换为它。 如果不能做到这一点，则会有一个类型错误。</p>
<p>仅仅存在一个所有元素都可以转换的类型是不够的。其中一个元素必须是该类型的。</p>
<p>在下面的例子中， <code>[1, 2, 3]</code> 的类型是 <code>uint8[3] memory</code>， 因为这些常量的类型都是 <code>uint8</code>。如果您想让结果是 <code>uint[3] memory</code> 类型， 您需要把第一个元素转换为 <code>uint</code>。</p>
<p><a target="_blank" rel="noopener" href="https://remix.ethereum.org/?#language=solidity&amp;version=0.8.24&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjE2IDwwLjkuMDsKCmNvbnRyYWN0IEMgewogICAgZnVuY3Rpb24gZigpIHB1YmxpYyBwdXJlIHsKICAgICAgICBnKFt1aW50KDEpLCAyLCAzXSk7CiAgICB9CiAgICBmdW5jdGlvbiBnKHVpbnRbM10gbWVtb3J5KSBwdWJsaWMgcHVyZSB7CiAgICAgICAgLy8gLi4uCiAgICB9Cn0=">open in Remix</a></p>
<figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs d"><span class="hljs-comment">// SPDX-License-Identifier: GPL-3.0</span><br><span class="hljs-keyword">pragma</span> solidity &gt;=<span class="hljs-number">0.4</span><span class="hljs-number">.16</span> &lt;<span class="hljs-number">0.9</span><span class="hljs-number">.0</span>;<br><br>contract C &#123;<br>    <span class="hljs-built_in">function</span> f() <span class="hljs-keyword">public</span> <span class="hljs-keyword">pure</span> &#123;<br>        g([<span class="hljs-built_in">uint</span>(<span class="hljs-number">1</span>), <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]);<br>    &#125;<br>    <span class="hljs-built_in">function</span> g(<span class="hljs-built_in">uint</span>[<span class="hljs-number">3</span>] memory) <span class="hljs-keyword">public</span> <span class="hljs-keyword">pure</span> &#123;<br>        <span class="hljs-comment">// ...</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>数组表达式 <code>[1, -1]</code> 是无效的，因为第一个表达式的类型是 <code>uint8</code>， 而第二个表达式的类型是 <code>int8</code>，它们不能相互隐式转换。为了使其有效， 例如，您可以使用 <code>[int8(1), -1]</code>。</p>
<p>由于不同类型的固定大小的内存数组不能相互转换（即使基类可以）， 如果您想使用二维数组字面常数，您必须总是明确指定一个共同的基类：</p>
<p><a target="_blank" rel="noopener" href="https://remix.ethereum.org/?#language=solidity&amp;version=0.8.24&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjE2IDwwLjkuMDsKCmNvbnRyYWN0IEMgewogICAgZnVuY3Rpb24gZigpIHB1YmxpYyBwdXJlIHJldHVybnMgKHVpbnQyNFsyXVs0XSBtZW1vcnkpIHsKICAgICAgICB1aW50MjRbMl1bNF0gbWVtb3J5IHggPSBbW3VpbnQyNCgweDEpLCAxXSwgWzB4ZmZmZmZmLCAyXSwgW3VpbnQyNCgweGZmKSwgM10sIFt1aW50MjQoMHhmZmZmKSwgNF1dOwogICAgICAgIC8vIOS4i+mdoueahOaWueazleS4jeS8mui1t+S9nOeUqO+8jOWboOS4uuS4gOS6m+WGhemDqOaVsOe7hOeahOexu+Wei+S4jeWvueOAggogICAgICAgIC8vIHVpbnRbMl1bNF0gbWVtb3J5IHggPSBbWzB4MSwgMV0sIFsweGZmZmZmZiwgMl0sIFsweGZmLCAzXSwgWzB4ZmZmZiwgNF1dOwogICAgICAgIHJldHVybiB4OwogICAgfQp9">open in Remix</a></p>
<figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs inform7">// SPDX-License-Identifier: GPL-3.0<br>pragma solidity &gt;=0.4.16 &lt;0.9.0;<br><br>contract C &#123;<br>    function f() public pure returns (uint24<span class="hljs-comment">[2]</span><span class="hljs-comment">[4]</span> memory) &#123;<br>        uint24<span class="hljs-comment">[2]</span><span class="hljs-comment">[4]</span> memory x = <span class="hljs-comment">[<span class="hljs-comment">[uint24(0x1), 1]</span>, <span class="hljs-comment">[0xffffff, 2]</span>, <span class="hljs-comment">[uint24(0xff), 3]</span>, <span class="hljs-comment">[uint24(0xffff), 4]</span>]</span>;<br>        // 下面的方法不会起作用，因为一些内部数组的类型不对。<br>        // uint<span class="hljs-comment">[2]</span><span class="hljs-comment">[4]</span> memory x = <span class="hljs-comment">[<span class="hljs-comment">[0x1, 1]</span>, <span class="hljs-comment">[0xffffff, 2]</span>, <span class="hljs-comment">[0xff, 3]</span>, <span class="hljs-comment">[0xffff, 4]</span>]</span>;<br>        return x;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>固定大小的内存数组不能分配给动态大小的内存数组，也就是说，以下情况是不可能的：</p>
<p><a target="_blank" rel="noopener" href="https://remix.ethereum.org/?#language=solidity&amp;version=0.8.24&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjAgPDAuOS4wOwoKLy8g6L+Z5LiN5Lya6KKr57yW6K+R44CCCmNvbnRyYWN0IEMgewogICAgZnVuY3Rpb24gZigpIHB1YmxpYyB7CiAgICAgICAgLy8g5LiL5LiA6KGM5Lya5Lqn55Sf5LiA5Liq57G75Z6L6ZSZ6K+v77yM5Zug5Li6dWludFszXeWGheWtmOS4jeiDveiiq+i9rOaNouS4unVpbnRbXeWGheWtmOOAggogICAgICAgIHVpbnRbXSBtZW1vcnkgeCA9IFt1aW50KDEpLCAzLCA0XTsKICAgIH0KfQ==">open in Remix</a></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-comment">// SPDX-License-Identifier: GPL-3.0</span><br>pragma solidity &gt;=<span class="hljs-number">0.4</span><span class="hljs-number">.0</span> &lt;<span class="hljs-number">0.9</span><span class="hljs-number">.0</span>;<br><br><span class="hljs-comment">// 这不会被编译。</span><br>contract C &#123;<br>    <span class="hljs-function">function <span class="hljs-title">f</span>() <span class="hljs-keyword">public</span></span> &#123;<br>        <span class="hljs-comment">// 下一行会产生一个类型错误，因为uint[3]内存不能被转换为uint[]内存。</span><br>        <span class="hljs-built_in">uint</span>[] memory x = [<span class="hljs-built_in">uint</span>(<span class="hljs-number">1</span>), <span class="hljs-number">3</span>, <span class="hljs-number">4</span>];<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>计划在将来取消这一限制，但由于ABI中数组的传递方式，它产生了一些复杂的问题。</p>
<p>如果您想初始化动态大小的数组，您必须分配各个元素：</p>
<p><a target="_blank" rel="noopener" href="https://remix.ethereum.org/?#language=solidity&amp;version=0.8.24&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjE2IDwwLjkuMDsKCmNvbnRyYWN0IEMgewogICAgZnVuY3Rpb24gZigpIHB1YmxpYyBwdXJlIHsKICAgICAgICB1aW50W10gbWVtb3J5IHggPSBuZXcgdWludFtdKDMpOwogICAgICAgIHhbMF0gPSAxOwogICAgICAgIHhbMV0gPSAzOwogICAgICAgIHhbMl0gPSA0OwogICAgfQp9">open in Remix</a></p>
<figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs d"><span class="hljs-comment">// SPDX-License-Identifier: GPL-3.0</span><br><span class="hljs-keyword">pragma</span> solidity &gt;=<span class="hljs-number">0.4</span><span class="hljs-number">.16</span> &lt;<span class="hljs-number">0.9</span><span class="hljs-number">.0</span>;<br><br>contract C &#123;<br>    <span class="hljs-built_in">function</span> f() <span class="hljs-keyword">public</span> <span class="hljs-keyword">pure</span> &#123;<br>        <span class="hljs-built_in">uint</span>[] memory x = <span class="hljs-keyword">new</span> <span class="hljs-built_in">uint</span>[](<span class="hljs-number">3</span>);<br>        x[<span class="hljs-number">0</span>] = <span class="hljs-number">1</span>;<br>        x[<span class="hljs-number">1</span>] = <span class="hljs-number">3</span>;<br>        x[<span class="hljs-number">2</span>] = <span class="hljs-number">4</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="数组成员"><a href="#数组成员" class="headerlink" title="数组成员"></a>数组成员<a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#array-members"></a></h4><ul>
<li><p><strong>length</strong>:</p>
<p>数组有 <code>length</code> 成员变量表示当前数组的长度。一经创建， 内存memory数组的大小就是固定的（但却是动态的，也就是说，它依赖于运行时的参数）。</p>
</li>
<li><p><strong>push()</strong>:</p>
<p>动态存储数组和 <code>bytes</code> （不是 <code>string</code> ）有一个叫 <code>push()</code> 的成员函数， 您可以用它在数组的末尾追加一个零初始化的元素。它返回一个元素的引用， 因此可以像 <code>x.push().t = 2</code> 或 <code>x.push() = b</code> 那样使用。</p>
</li>
<li><p><strong>push(x)</strong>:</p>
<p>动态存储数组和 <code>bytes</code> （不是 <code>string</code> ）有一个叫 <code>push(x)</code> 的成员函数， 您可以用它在数组的末端追加一个指定的元素。该函数不返回任何东西。</p>
</li>
<li><p><strong>pop()</strong>:</p>
<p>动态存储数组和 <code>bytes</code> （不是 <code>string</code> ）有一个叫 <code>pop()</code> 的成员函数， 您可以用它来从数组的末端移除一个元素。 这也隐含地在被删除的元素上调用 <a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#delete">delete</a>。该函数不返回任何东西。</p>
</li>
</ul>
<p>备注</p>
<p>通过调用 <code>push()</code> 增加存储数组的长度有恒定的燃料成本，因为存储是零初始化的， 而通过调用 <code>pop()</code> 减少长度的成本取决于被移除元素的 “大小”。 如果该元素是一个数组，它的成本可能非常高， 因为它包括明确地清除被移除的元素，类似于对它们调用 <a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#delete">delete</a>。</p>
<p>备注</p>
<p>要在外部（而不是公开）函数中使用数组的数组， 您需要激活ABI coder v2。</p>
<p>备注</p>
<p>在Byzantium之前的EVM版本中，不能访问从函数调用返回的动态数组。 如果您调用返回动态数组的函数，请确保使用设置为Byzantium模式的EVM。</p>
<p><a target="_blank" rel="noopener" href="https://remix.ethereum.org/?#language=solidity&amp;version=0.8.24&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC42LjAgPDAuOS4wOwoKY29udHJhY3QgQXJyYXlDb250cmFjdCB7CiAgICB1aW50WzIqKjIwXSBhTG90T2ZJbnRlZ2VyczsKICAgIC8vIOivt+azqOaEj++8jOS4i+mdouS4jeaYr+S4gOWvueWKqOaAgeaVsOe7hO+8jAogICAgLy8g6ICM5piv5LiA5Liq5Yqo5oCB5pWw57uE5a+577yI5Y2z6ZW/5bqm5Li6MueahOWbuuWumuWkp+Wwj+aVsOe7hO+8ieOAggogICAgLy8g5ZyoIFNvbGlkaXR5IOS4re+8jFRba13lkoxUW13mgLvmmK/lhbfmnIlU57G75Z6L5YWD57Sg55qE5pWw57uE77yMCiAgICAvLyDljbPkvb9U5pys6Lqr5piv5LiA5Liq5pWw57uE44CCCiAgICAvLyDmraPlm6DkuLrlpoLmraTvvIxib29sWzJdW13mmK/kuIDkuKrliqjmgIHmlbDnu4Tlr7nvvIzlhbblhYPntKDmmK9ib29sWzJd44CCCiAgICAvLyDov5nkuI7lhbbku5bor63oqIDkuI3lkIzvvIzmr5TlpoJD77yMCiAgICAvLyDmiYDmnInnirbmgIHlj5jph4/nmoTmlbDmja7kvY3nva7pg73mmK/lrZjlgqjjgIIKICAgIGJvb2xbMl1bXSBwYWlyc09mRmxhZ3M7CgogICAgLy8gbmV3UGFpcnPooqvlrZjlgqjlnKhtZW1vcnnkuK0tLei/meaYr+WFrOW8gOWQiOe6puWHveaVsOWPguaVsOeahOWUr+S4gOWPr+iDveaAp+OAggogICAgZnVuY3Rpb24gc2V0QWxsRmxhZ1BhaXJzKGJvb2xbMl1bXSBtZW1vcnkgbmV3UGFpcnMpIHB1YmxpYyB7CiAgICAgICAgLy8g6LWL5YC85Yiw5LiA5Liq5a2Y5YKo5pWw57uE5Lya5omn6KGMIGBgbmV3UGFpcnNgYCDnmoTmi7fotJ3vvIwKICAgICAgICAvLyDlubbmm7/mjaLlrozmlbTnmoTmlbDnu4QgYGBwYWlyc09mRmxhZ3NgYOOAggogICAgICAgIHBhaXJzT2ZGbGFncyA9IG5ld1BhaXJzOwogICAgfQoKICAgIHN0cnVjdCBTdHJ1Y3RUeXBlIHsKICAgICAgICB1aW50W10gY29udGVudHM7CiAgICAgICAgdWludCBtb3JlSW5mbzsKICAgIH0KICAgIFN0cnVjdFR5cGUgczsKCiAgICBmdW5jdGlvbiBmKHVpbnRbXSBtZW1vcnkgYykgcHVibGljIHsKICAgICAgICAvLyDlnKggYGBnYGAg5Lit5a2Y5YKo5LiA5Liq5a+5IGBgc2BgIOeahOW8leeUqOOAggogICAgICAgIFN0cnVjdFR5cGUgc3RvcmFnZSBnID0gczsKICAgICAgICAvLyDkuZ/mlLnlj5jkuoYgYGBzLm1vcmVJbmZvYGAuCiAgICAgICAgZy5tb3JlSW5mbyA9IDI7CiAgICAgICAgLy8g5oyH5a6a5LiA5Liq5ou36LSd77yM5Zug5Li6IGBgZy5jb250ZW50c2BgIOS4jeaYr+S4gOS4quWxgOmDqOWPmOmHj++8jAogICAgICAgIC8vIOiAjOaYr+S4gOS4quWxgOmDqOWPmOmHj+eahOaIkOWRmOOAggogICAgICAgIGcuY29udGVudHMgPSBjOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldEZsYWdQYWlyKHVpbnQgaW5kZXgsIGJvb2wgZmxhZ0EsIGJvb2wgZmxhZ0IpIHB1YmxpYyB7CiAgICAgICAgLy8g6K6/6Zeu5LiA5Liq5LiN5a2Y5Zyo55qE5pWw57uE57Si5byV5Lya5byV5Y+R5LiA5Liq5byC5bi4CiAgICAgICAgcGFpcnNPZkZsYWdzW2luZGV4XVswXSA9IGZsYWdBOwogICAgICAgIHBhaXJzT2ZGbGFnc1tpbmRleF1bMV0gPSBmbGFnQjsKICAgIH0KCiAgICBmdW5jdGlvbiBjaGFuZ2VGbGFnQXJyYXlTaXplKHVpbnQgbmV3U2l6ZSkgcHVibGljIHsKICAgICAgICAvLyDkvb/nlKhwdXNo5ZKMcG9w5piv5pS55Y+Y5pWw57uE6ZW/5bqm55qE5ZSv5LiA5pa55rOV44CCCiAgICAgICAgaWYgKG5ld1NpemUgPCBwYWlyc09mRmxhZ3MubGVuZ3RoKSB7CiAgICAgICAgICAgIHdoaWxlIChwYWlyc09mRmxhZ3MubGVuZ3RoID4gbmV3U2l6ZSkKICAgICAgICAgICAgICAgIHBhaXJzT2ZGbGFncy5wb3AoKTsKICAgICAgICB9IGVsc2UgaWYgKG5ld1NpemUgPiBwYWlyc09mRmxhZ3MubGVuZ3RoKSB7CiAgICAgICAgICAgIHdoaWxlIChwYWlyc09mRmxhZ3MubGVuZ3RoIDwgbmV3U2l6ZSkKICAgICAgICAgICAgICAgIHBhaXJzT2ZGbGFncy5wdXNoKCk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGNsZWFyKCkgcHVibGljIHsKICAgICAgICAvLyDov5nkupvlrozlhajmuIXpmaTkuobmlbDnu4QKICAgICAgICBkZWxldGUgcGFpcnNPZkZsYWdzOwogICAgICAgIGRlbGV0ZSBhTG90T2ZJbnRlZ2VyczsKICAgICAgICAvLyDov5nph4zmnInnm7jlkIznmoTmlYjmnpwKICAgICAgICBwYWlyc09mRmxhZ3MgPSBuZXcgYm9vbFsyXVtdKDApOwogICAgfQoKICAgIGJ5dGVzIGJ5dGVEYXRhOwoKICAgIGZ1bmN0aW9uIGJ5dGVBcnJheXMoYnl0ZXMgbWVtb3J5IGRhdGEpIHB1YmxpYyB7CiAgICAgICAgLy8g5a2X6IqC5pWw57uE77yIImJ5dGUi77yJ5piv5LiN5ZCM55qE77yM5Zug5Li65a6D5Lus55qE5a2Y5YKo5rKh5pyJ5aGr5YWF77yMCiAgICAgICAgLy8g5L2G5Y+v5Lul5LiOICJ1aW50OFtdIuebuOWQjOOAggogICAgICAgIGJ5dGVEYXRhID0gZGF0YTsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCA3OyBpKyspCiAgICAgICAgICAgIGJ5dGVEYXRhLnB1c2goKTsKICAgICAgICBieXRlRGF0YVszXSA9IDB4MDg7CiAgICAgICAgZGVsZXRlIGJ5dGVEYXRhWzJdOwogICAgfQoKICAgIGZ1bmN0aW9uIGFkZEZsYWcoYm9vbFsyXSBtZW1vcnkgZmxhZykgcHVibGljIHJldHVybnMgKHVpbnQpIHsKICAgICAgICBwYWlyc09mRmxhZ3MucHVzaChmbGFnKTsKICAgICAgICByZXR1cm4gcGFpcnNPZkZsYWdzLmxlbmd0aDsKICAgIH0KCiAgICBmdW5jdGlvbiBjcmVhdGVNZW1vcnlBcnJheSh1aW50IHNpemUpIHB1YmxpYyBwdXJlIHJldHVybnMgKGJ5dGVzIG1lbW9yeSkgewogICAgICAgIC8vIOS9v+eUqCBgbmV3YCDliJvlu7rliqjmgIEgbWVtb3J5IOaVsOe7hO+8mgogICAgICAgIHVpbnRbMl1bXSBtZW1vcnkgYXJyYXlPZlBhaXJzID0gbmV3IHVpbnRbMl1bXShzaXplKTsKCiAgICAgICAgLy8g5YaF6IGU5pWw57uE5oC75piv6Z2Z5oCB5aSn5bCP55qE77yM5aaC5p6c5oKo5Y+q5L2/55So5a2X6Z2i5bi45pWw6KGo6L6+5byP77yM5oKo5b+F6aG76Iez5bCR5o+Q5L6b5LiA56eN57G75Z6L44CCCiAgICAgICAgYXJyYXlPZlBhaXJzWzBdID0gW3VpbnQoMSksIDJdOwoKICAgICAgICAvLyDliJvlu7rkuIDkuKrliqjmgIHlrZfoioLmlbDnu4TvvJoKICAgICAgICBieXRlcyBtZW1vcnkgYiA9IG5ldyBieXRlcygyMDApOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGIubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGJbaV0gPSBieXRlczEodWludDgoaSkpOwogICAgICAgIHJldHVybiBiOwogICAgfQp9">open in Remix</a></p>
<figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><code class="hljs d"><span class="hljs-comment">// SPDX-License-Identifier: GPL-3.0</span><br><span class="hljs-keyword">pragma</span> solidity &gt;=<span class="hljs-number">0.6</span><span class="hljs-number">.0</span> &lt;<span class="hljs-number">0.9</span><span class="hljs-number">.0</span>;<br><br>contract ArrayContract &#123;<br>    <span class="hljs-built_in">uint</span>[<span class="hljs-number">2</span>**<span class="hljs-number">20</span>] aLotOfIntegers;<br>    <span class="hljs-comment">// 请注意，下面不是一对动态数组，</span><br>    <span class="hljs-comment">// 而是一个动态数组对（即长度为2的固定大小数组）。</span><br>    <span class="hljs-comment">// 在 Solidity 中，T[k]和T[]总是具有T类型元素的数组，</span><br>    <span class="hljs-comment">// 即使T本身是一个数组。</span><br>    <span class="hljs-comment">// 正因为如此，bool[2][]是一个动态数组对，其元素是bool[2]。</span><br>    <span class="hljs-comment">// 这与其他语言不同，比如C，</span><br>    <span class="hljs-comment">// 所有状态变量的数据位置都是存储。</span><br>    <span class="hljs-built_in">bool</span>[<span class="hljs-number">2</span>][] pairsOfFlags;<br><br>    <span class="hljs-comment">// newPairs被存储在memory中--这是公开合约函数参数的唯一可能性。</span><br>    <span class="hljs-built_in">function</span> setAllFlagPairs(<span class="hljs-built_in">bool</span>[<span class="hljs-number">2</span>][] memory newPairs) <span class="hljs-keyword">public</span> &#123;<br>        <span class="hljs-comment">// 赋值到一个存储数组会执行 ``newPairs`` 的拷贝，</span><br>        <span class="hljs-comment">// 并替换完整的数组 ``pairsOfFlags``。</span><br>        pairsOfFlags = newPairs;<br>    &#125;<br><br>    <span class="hljs-keyword">struct</span> StructType &#123;<br>        <span class="hljs-built_in">uint</span>[] contents;<br>        <span class="hljs-built_in">uint</span> moreInfo;<br>    &#125;<br>    StructType s;<br><br>    <span class="hljs-built_in">function</span> f(<span class="hljs-built_in">uint</span>[] memory c) <span class="hljs-keyword">public</span> &#123;<br>        <span class="hljs-comment">// 在 ``g`` 中存储一个对 ``s`` 的引用。</span><br>        StructType storage g = s;<br>        <span class="hljs-comment">// 也改变了 ``s.moreInfo``.</span><br>        g.moreInfo = <span class="hljs-number">2</span>;<br>        <span class="hljs-comment">// 指定一个拷贝，因为 ``g.contents`` 不是一个局部变量，</span><br>        <span class="hljs-comment">// 而是一个局部变量的成员。</span><br>        g.contents = c;<br>    &#125;<br><br>    <span class="hljs-built_in">function</span> setFlagPair(<span class="hljs-built_in">uint</span> index, <span class="hljs-built_in">bool</span> flagA, <span class="hljs-built_in">bool</span> flagB) <span class="hljs-keyword">public</span> &#123;<br>        <span class="hljs-comment">// 访问一个不存在的数组索引会引发一个异常</span><br>        pairsOfFlags[index][<span class="hljs-number">0</span>] = flagA;<br>        pairsOfFlags[index][<span class="hljs-number">1</span>] = flagB;<br>    &#125;<br><br>    <span class="hljs-built_in">function</span> changeFlagArraySize(<span class="hljs-built_in">uint</span> newSize) <span class="hljs-keyword">public</span> &#123;<br>        <span class="hljs-comment">// 使用push和pop是改变数组长度的唯一方法。</span><br>        <span class="hljs-keyword">if</span> (newSize &lt; pairsOfFlags.length) &#123;<br>            <span class="hljs-keyword">while</span> (pairsOfFlags.length &gt; newSize)<br>                pairsOfFlags.pop();<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (newSize &gt; pairsOfFlags.length) &#123;<br>            <span class="hljs-keyword">while</span> (pairsOfFlags.length &lt; newSize)<br>                pairsOfFlags.push();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-built_in">function</span> clear() <span class="hljs-keyword">public</span> &#123;<br>        <span class="hljs-comment">// 这些完全清除了数组</span><br>        <span class="hljs-keyword">delete</span> pairsOfFlags;<br>        <span class="hljs-keyword">delete</span> aLotOfIntegers;<br>        <span class="hljs-comment">// 这里有相同的效果</span><br>        pairsOfFlags = <span class="hljs-keyword">new</span> <span class="hljs-built_in">bool</span>[<span class="hljs-number">2</span>][](<span class="hljs-number">0</span>);<br>    &#125;<br><br>    bytes byteData;<br><br>    <span class="hljs-built_in">function</span> byteArrays(bytes memory data) <span class="hljs-keyword">public</span> &#123;<br>        <span class="hljs-comment">// 字节数组（&quot;byte&quot;）是不同的，因为它们的存储没有填充，</span><br>        <span class="hljs-comment">// 但可以与 &quot;uint8[]&quot;相同。</span><br>        byteData = data;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">uint</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">7</span>; i++)<br>            byteData.push();<br>        byteData[<span class="hljs-number">3</span>] = <span class="hljs-number">0</span>x08;<br>        <span class="hljs-keyword">delete</span> byteData[<span class="hljs-number">2</span>];<br>    &#125;<br><br>    <span class="hljs-built_in">function</span> addFlag(<span class="hljs-built_in">bool</span>[<span class="hljs-number">2</span>] memory flag) <span class="hljs-keyword">public</span> returns (<span class="hljs-built_in">uint</span>) &#123;<br>        pairsOfFlags.push(flag);<br>        <span class="hljs-keyword">return</span> pairsOfFlags.length;<br>    &#125;<br><br>    <span class="hljs-built_in">function</span> createMemoryArray(<span class="hljs-built_in">uint</span> size) <span class="hljs-keyword">public</span> <span class="hljs-keyword">pure</span> returns (bytes memory) &#123;<br>        <span class="hljs-comment">// 使用 `new` 创建动态 memory 数组：</span><br>        <span class="hljs-built_in">uint</span>[<span class="hljs-number">2</span>][] memory arrayOfPairs = <span class="hljs-keyword">new</span> <span class="hljs-built_in">uint</span>[<span class="hljs-number">2</span>][](size);<br><br>        <span class="hljs-comment">// 内联数组总是静态大小的，如果您只使用字面常数表达式，您必须至少提供一种类型。</span><br>        arrayOfPairs[<span class="hljs-number">0</span>] = [<span class="hljs-built_in">uint</span>(<span class="hljs-number">1</span>), <span class="hljs-number">2</span>];<br><br>        <span class="hljs-comment">// 创建一个动态字节数组：</span><br>        bytes memory b = <span class="hljs-keyword">new</span> bytes(<span class="hljs-number">200</span>);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">uint</span> i = <span class="hljs-number">0</span>; i &lt; b.length; i++)<br>            b[i] = bytes1(uint8(i));<br>        <span class="hljs-keyword">return</span> b;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="对存储数组元素的悬空引用（Dangling-References）"><a href="#对存储数组元素的悬空引用（Dangling-References）" class="headerlink" title="对存储数组元素的悬空引用（Dangling References）"></a>对存储数组元素的悬空引用（Dangling References）<a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#dangling-references"></a></h4><p>当使用存储数组时，您需要注意避免悬空引用。 悬空引用是指一个指向不再存在的或已经被移动而未更新引用的内容的引用。 例如，如果您将一个数组元素的引用存储在一个局部变量中， 然后从包含数组中使用 <code>.pop()</code>，就可能发生悬空引用：</p>
<p><a target="_blank" rel="noopener" href="https://remix.ethereum.org/?#language=solidity&amp;version=0.8.24&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC44LjAgPDAuOS4wOwoKY29udHJhY3QgQyB7CiAgICB1aW50W11bXSBzOwoKICAgIGZ1bmN0aW9uIGYoKSBwdWJsaWMgewogICAgICAgIC8vIOWtmOWCqOS4gOS4quaMh+WQkXPnmoTmnIDlkI7kuIDkuKrmlbDnu4TlhYPntKDnmoTmjIfpkojjgIIKICAgICAgICB1aW50W10gc3RvcmFnZSBwdHIgPSBzW3MubGVuZ3RoIC0gMV07CiAgICAgICAgLy8g5Yig6Zmkc+eahOacgOWQjuS4gOS4quaVsOe7hOWFg+e0oOOAggogICAgICAgIHMucG9wKCk7CiAgICAgICAgLy8g5YaZ5YWl5bey5LiN5Zyo5pWw57uE5YaF55qE5pWw57uE5YWD57Sg44CCCiAgICAgICAgcHRyLnB1c2goMHg0Mik7CiAgICAgICAgLy8g546w5Zyo5ZCRIGBgc2BgIOa3u+WKoOS4gOS4quaWsOWFg+e0oOS4jeS8mua3u+WKoOS4gOS4quepuuaVsOe7hO+8jAogICAgICAgIC8vIOiAjOaYr+S8muS6p+eUn+S4gOS4qumVv+W6puS4ujHnmoTmlbDnu4TvvIzlhYPntKDkuLogYGAweDQyYGDjgIIKICAgICAgICBzLnB1c2goKTsKICAgICAgICBhc3NlcnQoc1tzLmxlbmd0aCAtIDFdWzBdID09IDB4NDIpOwogICAgfQp9">open in Remix</a></p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-comment">// SPDX-License-Identifier: GPL-3.0</span><br>pragma solidity &gt;=<span class="hljs-number">0.8</span><span class="hljs-number">.0</span> &lt;<span class="hljs-number">0.9</span><span class="hljs-number">.0</span>;<br><br>contract C &#123;<br>    uint[][] s;<br><br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">f</span>(<span class="hljs-params"></span>) <span class="hljs-title function_">public</span> &#123;<br>        <span class="hljs-comment">// 存储一个指向s的最后一个数组元素的指针。</span><br>        uint[] storage ptr = s[s.<span class="hljs-built_in">length</span> - <span class="hljs-number">1</span>];<br>        <span class="hljs-comment">// 删除s的最后一个数组元素。</span><br>        s.<span class="hljs-built_in">pop</span>();<br>        <span class="hljs-comment">// 写入已不在数组内的数组元素。</span><br>        ptr.<span class="hljs-built_in">push</span>(<span class="hljs-number">0x42</span>);<br>        <span class="hljs-comment">// 现在向 ``s`` 添加一个新元素不会添加一个空数组，</span><br>        <span class="hljs-comment">// 而是会产生一个长度为1的数组，元素为 ``0x42``。</span><br>        s.<span class="hljs-built_in">push</span>();<br>        assert(s[s.<span class="hljs-built_in">length</span> - <span class="hljs-number">1</span>][<span class="hljs-number">0</span>] == <span class="hljs-number">0x42</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>ptr.push(0x42)</code> 中的写法 <strong>不会</strong> 恢复操作，尽管 <code>ptr</code> 不再指向 <code>s</code> 的一个有效元素。 由于编译器假定未使用的存储空间总是被清零， 随后的 <code>s.push()</code> 不会明确地将零写入存储空间， 所以在 <code>push()</code> 之后， <code>s</code> 的最后一个元素的长度是 <code>1</code>， 并且包含 <code>0x42</code> 作为其第一个元素。</p>
<p>注意，Solidity 不允许在存储中声明对值类型的引用。 这类显式的悬空引用被限制在嵌套引用类型中。然而， 当在数组赋值中使用复杂表达式时，悬空引用也会短暂发生：</p>
<p><a target="_blank" rel="noopener" href="https://remix.ethereum.org/?#language=solidity&amp;version=0.8.24&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC44LjAgPDAuOS4wOwoKY29udHJhY3QgQyB7CiAgICB1aW50W10gczsKICAgIHVpbnRbXSB0OwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgICAgLy8g5ZCR5a2Y5YKo5pWw57uE5o6o6YCB5LiA5Lqb5Yid5aeL5YC844CCCiAgICAgICAgcy5wdXNoKDB4MDcpOwogICAgICAgIHQucHVzaCgweDAzKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnKCkgaW50ZXJuYWwgcmV0dXJucyAodWludFtdIHN0b3JhZ2UpIHsKICAgICAgICBzLnBvcCgpOwogICAgICAgIHJldHVybiB0OwogICAgfQoKICAgIGZ1bmN0aW9uIGYoKSBwdWJsaWMgcmV0dXJucyAodWludFtdIG1lbW9yeSkgewogICAgICAgIC8vIOS4i+mdouWwhummluWFiOivhOS8sCBgYHMucHVzaCgpYCDliLDkuIDkuKrntKLlvJXkuLox55qE5paw5YWD57Sg55qE5byV55So44CCCiAgICAgICAgLy8g5LmL5ZCO77yM6LCD55SoIGBgZ2BgIOW8ueWHuui/meS4quaWsOWFg+e0oO+8jAogICAgICAgIC8vIOWvvOiHtOacgOW3pui+ueeahOWFg+e7hOWFg+e0oOaIkOS4uuS4gOS4quaCrOepuueahOW8leeUqOOAggogICAgICAgIC8vIOi1i+WAvOS7jeeEtuWPkeeUn++8jOW5tuWwhuWGmeWFpSBgYHNgYCDnmoTmlbDmja7ljLrln5/kuYvlpJbjgIIKICAgICAgICAocy5wdXNoKCksIGcoKVswXSkgPSAoMHg0MiwgMHgxNyk7CiAgICAgICAgLy8g6ZqP5ZCO5a+5IGBgc2BgIOeahOaOqOmAgeWwhuaYvuekuuWJjeS4gOS4quivreWPpeWGmeWFpeeahOWAvO+8jAogICAgICAgIC8vIOWNs+WcqOi/meS4quWHveaVsOe7k+adn+aXtiBgYHNgYCDnmoTmnIDlkI7kuIDkuKrlhYPntKDlsIbmnIkgYGAweDQyYGAg55qE5YC844CCCiAgICAgICAgcy5wdXNoKCk7CiAgICAgICAgcmV0dXJuIHM7CiAgICB9Cn0=">open in Remix</a></p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-comment">// SPDX-License-Identifier: GPL-3.0</span><br>pragma solidity &gt;=<span class="hljs-number">0.8</span><span class="hljs-number">.0</span> &lt;<span class="hljs-number">0.9</span><span class="hljs-number">.0</span>;<br><br>contract C &#123;<br>    uint[] s;<br>    uint[] t;<br>    constructor() &#123;<br>        <span class="hljs-comment">// 向存储数组推送一些初始值。</span><br>        s.<span class="hljs-built_in">push</span>(<span class="hljs-number">0x07</span>);<br>        t.<span class="hljs-built_in">push</span>(<span class="hljs-number">0x03</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">g</span>(<span class="hljs-params"></span>) <span class="hljs-title function_">internal</span> <span class="hljs-title function_">returns</span> (<span class="hljs-params">uint[] storage</span>) &#123;<br>        s.<span class="hljs-built_in">pop</span>();<br>        <span class="hljs-keyword">return</span> t;<br>    &#125;<br><br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">f</span>(<span class="hljs-params"></span>) <span class="hljs-title function_">public</span> <span class="hljs-title function_">returns</span> (<span class="hljs-params">uint[] memory</span>) &#123;<br>        <span class="hljs-comment">// 下面将首先评估 ``s.push()` 到一个索引为1的新元素的引用。</span><br>        <span class="hljs-comment">// 之后，调用 ``g`` 弹出这个新元素，</span><br>        <span class="hljs-comment">// 导致最左边的元组元素成为一个悬空的引用。</span><br>        <span class="hljs-comment">// 赋值仍然发生，并将写入 ``s`` 的数据区域之外。</span><br>        (s.<span class="hljs-built_in">push</span>(), g()[<span class="hljs-number">0</span>]) = (<span class="hljs-number">0x42</span>, <span class="hljs-number">0x17</span>);<br>        <span class="hljs-comment">// 随后对 ``s`` 的推送将显示前一个语句写入的值，</span><br>        <span class="hljs-comment">// 即在这个函数结束时 ``s`` 的最后一个元素将有 ``0x42`` 的值。</span><br>        s.<span class="hljs-built_in">push</span>();<br>        <span class="hljs-keyword">return</span> s;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>每条语句只对存储进行一次赋值，并避免在赋值的左侧使用复杂的表达式，这样做总是比较安全的。</p>
<p>您需要特别小心处理对 <code>bytes</code> 数组元素的引用， 因为 bytes 数组的 <code>.push()</code> 操作可能会 <a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/internals/layout_in_storage.html#bytes-and-string">在存储中从短布局切换到长布局</a>。</p>
<p><a target="_blank" rel="noopener" href="https://remix.ethereum.org/?#language=solidity&amp;version=0.8.24&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC44LjAgPDAuOS4wOwoKLy8g6L+Z5bCG5oql5ZGK5LiA5Liq6K2m5ZGKCmNvbnRyYWN0IEMgewogICAgYnl0ZXMgeCA9ICIwMTIzNDU2Nzg5MDEyMzQ1Njc4OTAxMjM0NTY3ODkiOwoKICAgIGZ1bmN0aW9uIHRlc3QoKSBleHRlcm5hbCByZXR1cm5zKHVpbnQpIHsKICAgICAgICAoeC5wdXNoKCksIHgucHVzaCgpKSA9ICgweDAxLCAweDAyKTsKICAgICAgICByZXR1cm4geC5sZW5ndGg7CiAgICB9Cn0=">open in Remix</a></p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-comment">// SPDX-License-Identifier: GPL-3.0</span><br>pragma solidity &gt;=<span class="hljs-number">0.8</span><span class="hljs-number">.0</span> &lt;<span class="hljs-number">0.9</span><span class="hljs-number">.0</span>;<br><br><span class="hljs-comment">// 这将报告一个警告</span><br>contract C &#123;<br>    bytes x = <span class="hljs-string">&quot;012345678901234567890123456789&quot;</span>;<br><br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">test</span>(<span class="hljs-params"></span>) <span class="hljs-title function_">external</span> <span class="hljs-title function_">returns</span>(<span class="hljs-params">uint</span>) &#123;<br>        (x.<span class="hljs-built_in">push</span>(), x.<span class="hljs-built_in">push</span>()) = (<span class="hljs-number">0x01</span>, <span class="hljs-number">0x02</span>);<br>        <span class="hljs-keyword">return</span> x.<span class="hljs-built_in">length</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>这里，当第一个 <code>x.push()</code> 被运算时， <code>x</code> 仍然被存储在短布局中， 因此 <code>x.push()</code> 返回对 <code>x</code> 的第一个存储槽中元素的引用。 然而，第二个 <code>x.push()</code> 将字节数组切换为长布局。 现在 <code>x.push()</code> 所指的元素在数组的数据区， 而引用仍然指向它原来的位置，现在它是长度字段的一部分， 赋值将有效地扰乱 <code>x</code> 的长度。 为了安全起见，在一次赋值中最多只放大字节数组中的一个元素， 不要在同一语句中同时对数组进行索引存取。</p>
<p>虽然上面描述了当前版本的编译器中悬空存储引用的行为， 但任何带有悬空引用的代码都应被视为具有 <em>未定义行为</em>。 特别的是，这意味着任何未来版本的编译器都可能改变涉及悬空引用的代码的行为。</p>
<p>请确保避免在您的代码中出现悬空引用。</p>
<h3 id="数组切片"><a href="#数组切片" class="headerlink" title="数组切片"></a>数组切片<a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#array-slices"></a></h3><p>数组切片是对一个数组的连续部分的预览。 它们被写成 <code>x[start:end]</code>，其中 <code>start</code> 和 <code>end</code> 是表达式， 结果是uint256类型（或隐含的可转换类型）。分片的第一个元素是 <code>x[start]</code>， 最后一个元素是 <code>x[end - 1]</code>。</p>
<p>如果 <code>start</code> 大于 <code>end</code>，或者 <code>end</code> 大于数组的长度， 就会出现异常。</p>
<p><code>start</code> 和 <code>end</code> 都是可选的： <code>start</code> 默认为 <code>0</code>， <code>end</code> 默认为数组的长度。</p>
<p>数组切片没有任何成员。它们可以隐含地转换为其底层类型的数组并支持索引访问。 索引访问在底层数组中不是绝对的，而是相对于分片的开始。</p>
<p>数组切片没有类型名，这意味着任何变量都不能以数组切片为类型， 它们只存在于中间表达式中。</p>
<p>备注</p>
<p>到现在为止，数组切片只有calldata数组可以实现。</p>
<p>数组切片对于ABI解码在函数参数中传递的二级数据很有用：</p>
<p><a target="_blank" rel="noopener" href="https://remix.ethereum.org/?#language=solidity&amp;version=0.8.24&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC44LjUgPDAuOS4wOwpjb250cmFjdCBQcm94eSB7CiAgICAvLy8gQGRldiDnlLHku6PnkIbnrqHnkIbnmoTlrqLmiLflkIjnuqbnmoTlnLDlnYDvvIzljbPmnKzlkIjnuqbnmoTlnLDlnYAKICAgIGFkZHJlc3MgY2xpZW50OwoKICAgIGNvbnN0cnVjdG9yKGFkZHJlc3MgY2xpZW50XykgewogICAgICAgIGNsaWVudCA9IGNsaWVudF87CiAgICB9CgogICAgLy8vIOi9rOWPkeWvuSAic2V0T3duZXIoYWRkcmVzcykiIOeahOiwg+eUqO+8jAogICAgLy8vIOivpeiwg+eUqOWcqOWvueWcsOWdgOWPguaVsOi/m+ihjOWfuuacrOmqjOivgeWQjueUseWuouaIt+err+aJp+ihjOOAggogICAgZnVuY3Rpb24gZm9yd2FyZChieXRlcyBjYWxsZGF0YSBwYXlsb2FkKSBleHRlcm5hbCB7CiAgICAgICAgYnl0ZXM0IHNpZyA9IGJ5dGVzNChwYXlsb2FkWzo0XSk7CiAgICAgICAgLy8g55Sx5LqO5oiq5pat6KGM5Li677yMYnl0ZXM0KHBheWxvYWQp55qE6KGo546w5piv55u45ZCM55qE44CCCiAgICAgICAgLy8gYnl0ZXM0IHNpZyA9IGJ5dGVzNChwYXlsb2FkKTsKICAgICAgICBpZiAoc2lnID09IGJ5dGVzNChrZWNjYWsyNTYoInNldE93bmVyKGFkZHJlc3MpIikpKSB7CiAgICAgICAgICAgIGFkZHJlc3Mgb3duZXIgPSBhYmkuZGVjb2RlKHBheWxvYWRbNDpdLCAoYWRkcmVzcykpOwogICAgICAgICAgICByZXF1aXJlKG93bmVyICE9IGFkZHJlc3MoMCksICJBZGRyZXNzIG9mIG93bmVyIGNhbm5vdCBiZSB6ZXJvLiIpOwogICAgICAgIH0KICAgICAgICAoYm9vbCBzdGF0dXMsKSA9IGNsaWVudC5kZWxlZ2F0ZWNhbGwocGF5bG9hZCk7CiAgICAgICAgcmVxdWlyZShzdGF0dXMsICJGb3J3YXJkZWQgY2FsbCBmYWlsZWQuIik7CiAgICB9Cn0=">open in Remix</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// SPDX-License-Identifier: GPL-3.0</span><br>pragma solidity &gt;=<span class="hljs-number">0.8</span><span class="hljs-number">.5</span> &lt;<span class="hljs-number">0.9</span><span class="hljs-number">.0</span>;<br>contract <span class="hljs-title class_">Proxy</span> &#123;<br>    <span class="hljs-comment">/// @dev 由代理管理的客户合约的地址，即本合约的地址</span><br>    address client;<br><br>    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">address client_</span>) &#123;<br>        client = client_;<br>    &#125;<br><br>    <span class="hljs-comment">/// 转发对 &quot;setOwner(address)&quot; 的调用，</span><br>    <span class="hljs-comment">/// 该调用在对地址参数进行基本验证后由客户端执行。</span><br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">bytes calldata payload</span>) external &#123;<br>        bytes4 sig = <span class="hljs-title function_">bytes4</span>(payload[:<span class="hljs-number">4</span>]);<br>        <span class="hljs-comment">// 由于截断行为，bytes4(payload)的表现是相同的。</span><br>        <span class="hljs-comment">// bytes4 sig = bytes4(payload);</span><br>        <span class="hljs-keyword">if</span> (sig == <span class="hljs-title function_">bytes4</span>(<span class="hljs-title function_">keccak256</span>(<span class="hljs-string">&quot;setOwner(address)&quot;</span>))) &#123;<br>            address owner = abi.<span class="hljs-title function_">decode</span>(payload[<span class="hljs-number">4</span>:], (address));<br>            <span class="hljs-built_in">require</span>(owner != <span class="hljs-title function_">address</span>(<span class="hljs-number">0</span>), <span class="hljs-string">&quot;Address of owner cannot be zero.&quot;</span>);<br>        &#125;<br>        (bool status,) = client.<span class="hljs-title function_">delegatecall</span>(payload);<br>        <span class="hljs-built_in">require</span>(status, <span class="hljs-string">&quot;Forwarded call failed.&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="结构体"><a href="#结构体" class="headerlink" title="结构体"></a>结构体<a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#structs"></a></h3><p>Solidity 提供了一种以结构形式定义新类型的方法，以下是一个结构体使用的示例：</p>
<p><a target="_blank" rel="noopener" href="https://remix.ethereum.org/?#language=solidity&amp;version=0.8.24&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC42LjAgPDAuOS4wOwoKLy8g5a6a5LmJ5LiA5Liq5YyF5ZCr5Lik5Liq5bGe5oCn55qE5paw57G75Z6L44CCCi8vIOWcqOWQiOe6puS5i+WkluWjsOaYjuS4gOS4que7k+aehO+8jAovLyDlj6/ku6XorqnlroPooqvlpJrkuKrlkIjnuqbmiYDlhbHkuqvjgIIKLy8g5Zyo6L+Z6YeM77yM6L+Z5bm25LiN5piv55yf55qE6ZyA6KaB44CCCnN0cnVjdCBGdW5kZXIgewogICAgYWRkcmVzcyBhZGRyOwogICAgdWludCBhbW91bnQ7Cn0KCmNvbnRyYWN0IENyb3dkRnVuZGluZyB7CiAgICAvLyDnu5PmnoTkvZPkuZ/lj6/ku6XooqvlrprkuYnlnKjlkIjnuqblhoXpg6jvvIzov5nkvb/lvpflroPku6zlj6rlnKjmnKzlkIjnuqblkozmtL7nlJ/lkIjnuqbkuK3lj6/op4HjgIIKICAgIHN0cnVjdCBDYW1wYWlnbiB7CiAgICAgICAgYWRkcmVzcyBwYXlhYmxlIGJlbmVmaWNpYXJ5OwogICAgICAgIHVpbnQgZnVuZGluZ0dvYWw7CiAgICAgICAgdWludCBudW1GdW5kZXJzOwogICAgICAgIHVpbnQgYW1vdW50OwogICAgICAgIG1hcHBpbmcodWludCA9PiBGdW5kZXIpIGZ1bmRlcnM7CiAgICB9CgogICAgdWludCBudW1DYW1wYWlnbnM7CiAgICBtYXBwaW5nKHVpbnQgPT4gQ2FtcGFpZ24pIGNhbXBhaWduczsKCiAgICBmdW5jdGlvbiBuZXdDYW1wYWlnbihhZGRyZXNzIHBheWFibGUgYmVuZWZpY2lhcnksIHVpbnQgZ29hbCkgcHVibGljIHJldHVybnMgKHVpbnQgY2FtcGFpZ25JRCkgewogICAgICAgIGNhbXBhaWduSUQgPSBudW1DYW1wYWlnbnMrKzsgLy8gY2FtcGFpZ25JRCDkvZzkuLrkuIDkuKrlj5jph4/ov5Tlm54KICAgICAgICAvLyDmiJHku6zkuI3og73kvb/nlKggImNhbXBhaWduc1tjYW1wYWlnbklEXSA9IENhbXBhaWduKGJlbmVmaWNpYXJ5LCBnb2FsLCAwLCAwKSIKICAgICAgICAvLyDlm6DkuLrlj7PkvqfliJvlu7rkuobkuIDkuKrlhoXlrZjnu5PmnoQgIkNhbXBhaWduIu+8jOWFtuS4reWMheWQq+S4gOS4quaYoOWwhOOAggogICAgICAgIENhbXBhaWduIHN0b3JhZ2UgYyA9IGNhbXBhaWduc1tjYW1wYWlnbklEXTsKICAgICAgICBjLmJlbmVmaWNpYXJ5ID0gYmVuZWZpY2lhcnk7CiAgICAgICAgYy5mdW5kaW5nR29hbCA9IGdvYWw7CiAgICB9CgogICAgZnVuY3Rpb24gY29udHJpYnV0ZSh1aW50IGNhbXBhaWduSUQpIHB1YmxpYyBwYXlhYmxlIHsKICAgICAgICBDYW1wYWlnbiBzdG9yYWdlIGMgPSBjYW1wYWlnbnNbY2FtcGFpZ25JRF07CiAgICAgICAgLy8g5Lul57uZ5a6a55qE5YC85Yid5aeL5YyW77yM5Yib5bu65LiA5Liq5paw55qE5Li05pe2IG1lbW9yeSDnu5PmnoTkvZPvvIwKICAgICAgICAvLyDlubblsIblhbbmi7fotJ3liLAgc3RvcmFnZSDkuK3jgIIKICAgICAgICAvLyDms6jmhI/mgqjkuZ/lj6/ku6Xkvb/nlKggRnVuZGVyKG1zZy5zZW5kZXIsIG1zZy52YWx1ZSkg5p2l5Yid5aeL5YyW44CCCiAgICAgICAgYy5mdW5kZXJzW2MubnVtRnVuZGVycysrXSA9IEZ1bmRlcih7YWRkcjogbXNnLnNlbmRlciwgYW1vdW50OiBtc2cudmFsdWV9KTsKICAgICAgICBjLmFtb3VudCArPSBtc2cudmFsdWU7CiAgICB9CgogICAgZnVuY3Rpb24gY2hlY2tHb2FsUmVhY2hlZCh1aW50IGNhbXBhaWduSUQpIHB1YmxpYyByZXR1cm5zIChib29sIHJlYWNoZWQpIHsKICAgICAgICBDYW1wYWlnbiBzdG9yYWdlIGMgPSBjYW1wYWlnbnNbY2FtcGFpZ25JRF07CiAgICAgICAgaWYgKGMuYW1vdW50IDwgYy5mdW5kaW5nR29hbCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIHVpbnQgYW1vdW50ID0gYy5hbW91bnQ7CiAgICAgICAgYy5hbW91bnQgPSAwOwogICAgICAgIGMuYmVuZWZpY2lhcnkudHJhbnNmZXIoYW1vdW50KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KfQ==">open in Remix</a></p>
<figure class="highlight zephir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs zephir"><span class="hljs-comment">// SPDX-License-Identifier: GPL-3.0</span><br>pragma solidity &gt;=<span class="hljs-number">0.6</span><span class="hljs-number">.0</span> &lt;<span class="hljs-number">0.9</span><span class="hljs-number">.0</span>;<br><br><span class="hljs-comment">// 定义一个包含两个属性的新类型。</span><br><span class="hljs-comment">// 在合约之外声明一个结构，</span><br><span class="hljs-comment">// 可以让它被多个合约所共享。</span><br><span class="hljs-comment">// 在这里，这并不是真的需要。</span><br>struct Funder &#123;<br>    address addr;<br>    <span class="hljs-keyword">uint</span> amount;<br>&#125;<br><br>contract CrowdFunding &#123;<br>    <span class="hljs-comment">// 结构体也可以被定义在合约内部，这使得它们只在本合约和派生合约中可见。</span><br>    struct Campaign &#123;<br>        address payable beneficiary;<br>        <span class="hljs-keyword">uint</span> fundingGoal;<br>        <span class="hljs-keyword">uint</span> numFunders;<br>        <span class="hljs-keyword">uint</span> amount;<br>        mapping(<span class="hljs-keyword">uint</span> =&gt; Funder) funders;<br>    &#125;<br><br>    <span class="hljs-keyword">uint</span> numCampaigns;<br>    mapping(<span class="hljs-keyword">uint</span> =&gt; Campaign) campaigns;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">newCampaign</span><span class="hljs-params">(address payable beneficiary, <span class="hljs-keyword">uint</span> goal)</span> <span class="hljs-title">public</span> <span class="hljs-title">returns</span> <span class="hljs-params">(<span class="hljs-keyword">uint</span> campaignID)</span> </span>&#123;<br>        campaignID = numCampaigns++; <span class="hljs-comment">// campaignID 作为一个变量返回</span><br>        <span class="hljs-comment">// 我们不能使用 &quot;campaigns[campaignID] = Campaign(beneficiary, goal, 0, 0)&quot;</span><br>        <span class="hljs-comment">// 因为右侧创建了一个内存结构 &quot;Campaign&quot;，其中包含一个映射。</span><br>        Campaign storage c = campaigns[campaignID];<br>        c.beneficiary = beneficiary;<br>        c.fundingGoal = goal;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">contribute</span><span class="hljs-params">(<span class="hljs-keyword">uint</span> campaignID)</span> <span class="hljs-title">public</span> <span class="hljs-title">payable</span> </span>&#123;<br>        Campaign storage c = campaigns[campaignID];<br>        <span class="hljs-comment">// 以给定的值初始化，创建一个新的临时 memory 结构体，</span><br>        <span class="hljs-comment">// 并将其拷贝到 storage 中。</span><br>        <span class="hljs-comment">// 注意您也可以使用 Funder(msg.sender, msg.value) 来初始化。</span><br>        c.funders[c.numFunders++] = Funder(&#123;addr: msg.sender, amount: msg.value&#125;);<br>        c.amount += msg.value;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkGoalReached</span><span class="hljs-params">(<span class="hljs-keyword">uint</span> campaignID)</span> <span class="hljs-title">public</span> <span class="hljs-title">returns</span> <span class="hljs-params">(<span class="hljs-keyword">bool</span> reached)</span> </span>&#123;<br>        Campaign storage c = campaigns[campaignID];<br>        <span class="hljs-keyword">if</span> (c.amount &lt; c.fundingGoal)<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>        <span class="hljs-keyword">uint</span> amount = c.amount;<br>        c.amount = <span class="hljs-number">0</span>;<br>        c.beneficiary.transfer(amount);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>上面的合约并没有提供众筹合约的全部功能， 但它包含了理解结构体所需的基本概念。 结构类型可以在映射和数组内使用， 它们本身可以包含映射和数组。</p>
<p>结构体不可能包含其自身类型的成员，尽管结构本身可以是映射成员的值类型， 或者它可以包含其类型的动态大小的数组。 这一限制是必要的，因为结构的大小必须是有限的。</p>
<p>注意在所有的函数中，结构类型被分配到数据位置为 <code>storage</code> 的局部变量。 这并不是拷贝结构体，而只是存储一个引用， 因此对本地变量成员的赋值实际上是写入状态。</p>
<p>当然，您也可以直接访问该结构的成员， 而不把它分配给本地变量，如 <code>campaigns[campaignID].amount = 0</code>。</p>
<p>备注</p>
<p>在 Solidity 0.7.0 之前，包含仅有存储类型（例如映射）的成员的内存结构是允许的， 像上面例子中的 <code>campaigns[campaignID] = Campaign(beneficiary, goal, 0, 0)</code> 这样的赋值是可以的， 只是会默默地跳过这些成员。</p>
<h2 id="映射类型"><a href="#映射类型" class="headerlink" title="映射类型"></a>映射类型<a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#mapping-types"></a></h2><p>映射类型使用语法 <code>mapping(KeyType KeyName? =&gt; ValueType ValueName?)</code>， 映射类型的变量使用语法 <code>mapping(KeyType KeyName? =&gt; ValueType ValueName?) VariableName</code> 声明。 <code>KeyType</code> 可以是任何内置的值类型， <code>bytes</code>， <code>string</code>，或任何合约或枚举类型。 其他用户定义的或复杂的类型，如映射，结构体或数组类型是不允许的。 <code>ValueType</code> 可以是任何类型，包括映射，数组和结构体。 <code>KeyName</code> 和 <code>ValueName</code> 是可选的（所以 <code>mapping(KeyType =&gt; ValueType)</code> 也可以使用）， 可以是任何有效的标识符，而不是一个类型。</p>
<p>您可以把映射想象成 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Hash_table">哈希表</a>， 它实际上被初始化了，使每一个可能的键都存在， 并将其映射到字节形式全是零的值，一个类型的 <a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/control-structures.html#default-value">默认值</a>。 相似性到此为止，键数据不存储在映射中，而是它的 <code>keccak256</code> 哈希值被用来查询。</p>
<p>正因为如此，映射没有长度，也没有被设置的键或值的概念， 因此，如果没有关于分配的键的额外信息，就不能被删除（见 <a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/security-considerations.html#clearing-mappings">清除映射</a>）。</p>
<p>映射只能有一个 <code>storage</code> 的数据位置，因此允许用于状态变量， 可作为函数中的存储引用类型，或作为库函数的参数。 但它们不能被用作公开可见的合约函数的参数或返回参数。 这些限制对于包含映射的数组和结构也是如此。</p>
<p>您可以把映射类型的状态变量标记为 <code>public</code>， Solidity 会为您创建一个 <a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/contracts.html#visibility-and-getters">getter</a> 函数。 <code>KeyType</code> 成为 getter 函数的参数，名称为 <code>KeyName</code> （如果指定）。 如果 <code>ValueType</code> 是一个值类型或一个结构，getter 返回 <code>ValueType</code>， 名称为 <code>ValueName</code> （如果指定）。 如果 <code>ValueType</code> 是一个数组或映射，getter 对每个 <code>KeyType</code> 递归出一个参数。</p>
<p>在下面的例子中， <code>MappingExample</code> 合约定义了一个公共的 <code>balances</code> 映射， 键类型是 <code>address</code>，值类型是 <code>uint</code>，将一个Ethereum地址映射到一个无符号整数值。 由于 <code>uint</code> 是一个值类型，getter 返回一个与该类型相匹配的值， 您可以在 <code>MappingUser</code> 合约中看到它返回指定地址对应的值。</p>
<p><a target="_blank" rel="noopener" href="https://remix.ethereum.org/?#language=solidity&amp;version=0.8.24&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjAgPDAuOS4wOwoKY29udHJhY3QgTWFwcGluZ0V4YW1wbGUgewogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpIHB1YmxpYyBiYWxhbmNlczsKCiAgICBmdW5jdGlvbiB1cGRhdGUodWludCBuZXdCYWxhbmNlKSBwdWJsaWMgewogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gbmV3QmFsYW5jZTsKICAgIH0KfQoKY29udHJhY3QgTWFwcGluZ1VzZXIgewogICAgZnVuY3Rpb24gZigpIHB1YmxpYyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgTWFwcGluZ0V4YW1wbGUgbSA9IG5ldyBNYXBwaW5nRXhhbXBsZSgpOwogICAgICAgIG0udXBkYXRlKDEwMCk7CiAgICAgICAgcmV0dXJuIG0uYmFsYW5jZXMoYWRkcmVzcyh0aGlzKSk7CiAgICB9Cn0=">open in Remix</a></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-comment">// SPDX-License-Identifier: GPL-3.0</span><br>pragma solidity &gt;=<span class="hljs-number">0.4</span><span class="hljs-number">.0</span> &lt;<span class="hljs-number">0.9</span><span class="hljs-number">.0</span>;<br><br>contract MappingExample &#123;<br>    mapping(address =&gt; <span class="hljs-built_in">uint</span>) <span class="hljs-keyword">public</span> balances;<br><br>    <span class="hljs-function">function <span class="hljs-title">update</span>(<span class="hljs-params"><span class="hljs-built_in">uint</span> newBalance</span>) <span class="hljs-keyword">public</span></span> &#123;<br>        balances[msg.sender] = newBalance;<br>    &#125;<br>&#125;<br><br>contract MappingUser &#123;<br>    <span class="hljs-function">function <span class="hljs-title">f</span>() <span class="hljs-keyword">public</span> <span class="hljs-title">returns</span> (<span class="hljs-params"><span class="hljs-built_in">uint</span></span>)</span> &#123;<br>        MappingExample m = <span class="hljs-keyword">new</span> MappingExample();<br>        m.update(<span class="hljs-number">100</span>);<br>        <span class="hljs-keyword">return</span> m.balances(address(<span class="hljs-keyword">this</span>));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>下面的例子是一个简化版本的 <a target="_blank" rel="noopener" href="https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/token/ERC20/ERC20.sol">ERC20 代币</a>。 <code>_allowances</code> 是一个映射类型在另一个映射类型中的例子。</p>
<p>在下面的例子中，为映射提供了可选的 <code>KeyName</code> 和 <code>ValueName</code>。 它不影响任何合约的功能或字节码， 它只是为映射的 getter 在 ABI 中设置输入和输出的 <code>name</code> 字段。</p>
<p><a target="_blank" rel="noopener" href="https://remix.ethereum.org/?#language=solidity&amp;version=0.8.24&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5IF4wLjguMTg7Cgpjb250cmFjdCBNYXBwaW5nRXhhbXBsZVdpdGhOYW1lcyB7CiAgICBtYXBwaW5nKGFkZHJlc3MgdXNlciA9PiB1aW50IGJhbGFuY2UpIHB1YmxpYyBiYWxhbmNlczsKCiAgICBmdW5jdGlvbiB1cGRhdGUodWludCBuZXdCYWxhbmNlKSBwdWJsaWMgewogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gbmV3QmFsYW5jZTsKICAgIH0KfQ==">open in Remix</a></p>
<figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs d"><span class="hljs-comment">// SPDX-License-Identifier: GPL-3.0</span><br><span class="hljs-keyword">pragma</span> solidity ^<span class="hljs-number">0.8</span><span class="hljs-number">.18</span>;<br><br>contract MappingExampleWithNames &#123;<br>    mapping(address user =&gt; <span class="hljs-built_in">uint</span> balance) <span class="hljs-keyword">public</span> balances;<br><br>    <span class="hljs-built_in">function</span> update(<span class="hljs-built_in">uint</span> newBalance) <span class="hljs-keyword">public</span> &#123;<br>        balances[msg.sender] = newBalance;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>下面的例子使用 <code>_allowances</code> 来记录其他人可以从你的账户中提取的金额。</p>
<p><a target="_blank" rel="noopener" href="https://remix.ethereum.org/?#language=solidity&amp;version=0.8.24&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjIyIDwwLjkuMDsKCmNvbnRyYWN0IE1hcHBpbmdFeGFtcGxlIHsKCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgcHJpdmF0ZSBfYmFsYW5jZXM7CiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpKSBwcml2YXRlIF9hbGxvd2FuY2VzOwoKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUpOwogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludDI1NiB2YWx1ZSk7CgogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBfYWxsb3dhbmNlc1tvd25lcl1bc3BlbmRlcl07CiAgICB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3Mgc2VuZGVyLCBhZGRyZXNzIHJlY2lwaWVudCwgdWludDI1NiBhbW91bnQpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZShfYWxsb3dhbmNlc1tzZW5kZXJdW21zZy5zZW5kZXJdID49IGFtb3VudCwgIkVSQzIwOiBBbGxvd2FuY2Ugbm90IGhpZ2ggZW5vdWdoLiIpOwogICAgICAgIF9hbGxvd2FuY2VzW3NlbmRlcl1bbXNnLnNlbmRlcl0gLT0gYW1vdW50OwogICAgICAgIF90cmFuc2ZlcihzZW5kZXIsIHJlY2lwaWVudCwgYW1vdW50KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiBhbW91bnQpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZShzcGVuZGVyICE9IGFkZHJlc3MoMCksICJFUkMyMDogYXBwcm92ZSB0byB0aGUgemVybyBhZGRyZXNzIik7CgogICAgICAgIF9hbGxvd2FuY2VzW21zZy5zZW5kZXJdW3NwZW5kZXJdID0gYW1vdW50OwogICAgICAgIGVtaXQgQXBwcm92YWwobXNnLnNlbmRlciwgc3BlbmRlciwgYW1vdW50KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBfdHJhbnNmZXIoYWRkcmVzcyBzZW5kZXIsIGFkZHJlc3MgcmVjaXBpZW50LCB1aW50MjU2IGFtb3VudCkgaW50ZXJuYWwgewogICAgICAgIHJlcXVpcmUoc2VuZGVyICE9IGFkZHJlc3MoMCksICJFUkMyMDogdHJhbnNmZXIgZnJvbSB0aGUgemVybyBhZGRyZXNzIik7CiAgICAgICAgcmVxdWlyZShyZWNpcGllbnQgIT0gYWRkcmVzcygwKSwgIkVSQzIwOiB0cmFuc2ZlciB0byB0aGUgemVybyBhZGRyZXNzIik7CiAgICAgICAgcmVxdWlyZShfYmFsYW5jZXNbc2VuZGVyXSA+PSBhbW91bnQsICJFUkMyMDogTm90IGVub3VnaCBmdW5kcy4iKTsKCiAgICAgICAgX2JhbGFuY2VzW3NlbmRlcl0gLT0gYW1vdW50OwogICAgICAgIF9iYWxhbmNlc1tyZWNpcGllbnRdICs9IGFtb3VudDsKICAgICAgICBlbWl0IFRyYW5zZmVyKHNlbmRlciwgcmVjaXBpZW50LCBhbW91bnQpOwogICAgfQp9">open in Remix</a></p>
<figure class="highlight zephir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs zephir"><span class="hljs-comment">// SPDX-License-Identifier: GPL-3.0</span><br>pragma solidity &gt;=<span class="hljs-number">0.4</span><span class="hljs-number">.22</span> &lt;<span class="hljs-number">0.9</span><span class="hljs-number">.0</span>;<br><br>contract MappingExample &#123;<br><br>    mapping(address =&gt; uint256) <span class="hljs-keyword">private</span> _balances;<br>    mapping(address =&gt; mapping(address =&gt; uint256)) <span class="hljs-keyword">private</span> _allowances;<br><br>    event Transfer(address indexed from, address indexed to, uint256 value);<br>    event Approval(address indexed owner, address indexed spender, uint256 value);<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">allowance</span><span class="hljs-params">(address owner, address spender)</span> <span class="hljs-title">public</span> <span class="hljs-title">view</span> <span class="hljs-title">returns</span> <span class="hljs-params">(uint256)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> _allowances[owner][spender];<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">transferFrom</span><span class="hljs-params">(address sender, address recipient, uint256 amount)</span> <span class="hljs-title">public</span> <span class="hljs-title">returns</span> <span class="hljs-params">(<span class="hljs-keyword">bool</span>)</span> </span>&#123;<br>        <span class="hljs-keyword">require</span>(_allowances[sender][msg.sender] &gt;= amount, <span class="hljs-string">&quot;ERC20: Allowance not high enough.&quot;</span>);<br>        _allowances[sender][msg.sender] -= amount;<br>        _transfer(sender, recipient, amount);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">approve</span><span class="hljs-params">(address spender, uint256 amount)</span> <span class="hljs-title">public</span> <span class="hljs-title">returns</span> <span class="hljs-params">(<span class="hljs-keyword">bool</span>)</span> </span>&#123;<br>        <span class="hljs-keyword">require</span>(spender != address(<span class="hljs-number">0</span>), <span class="hljs-string">&quot;ERC20: approve to the zero address&quot;</span>);<br><br>        _allowances[msg.sender][spender] = amount;<br>        emit Approval(msg.sender, spender, amount);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_transfer</span><span class="hljs-params">(address sender, address recipient, uint256 amount)</span> <span class="hljs-title">internal</span> </span>&#123;<br>        <span class="hljs-keyword">require</span>(sender != address(<span class="hljs-number">0</span>), <span class="hljs-string">&quot;ERC20: transfer from the zero address&quot;</span>);<br>        <span class="hljs-keyword">require</span>(recipient != address(<span class="hljs-number">0</span>), <span class="hljs-string">&quot;ERC20: transfer to the zero address&quot;</span>);<br>        <span class="hljs-keyword">require</span>(_balances[sender] &gt;= amount, <span class="hljs-string">&quot;ERC20: Not enough funds.&quot;</span>);<br><br>        _balances[sender] -= amount;<br>        _balances[recipient] += amount;<br>        emit Transfer(sender, recipient, amount);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="递归映射"><a href="#递归映射" class="headerlink" title="递归映射"></a>递归映射<a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#iterable-mappings"></a></h3><p>您不能对映射进行递归调用，也就是说，您不能列举它们的键。 不过，可以在它们上层实现一个数据结构，并对其进行递归。例如， 下面的代码实现了一个 <code>IterableMapping</code> 库， 然后 <code>User</code> 合约将数据添加到该库中， <code>sum</code> 函数对所有的值进行递归调用去累加这些值。</p>
<p><a target="_blank" rel="noopener" href="https://remix.ethereum.org/?#language=solidity&amp;version=0.8.24&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5IF4wLjguODsKCnN0cnVjdCBJbmRleFZhbHVlIHsgdWludCBrZXlJbmRleDsgdWludCB2YWx1ZTsgfQpzdHJ1Y3QgS2V5RmxhZyB7IHVpbnQga2V5OyBib29sIGRlbGV0ZWQ7IH0KCnN0cnVjdCBpdG1hcCB7CiAgICBtYXBwaW5nKHVpbnQgPT4gSW5kZXhWYWx1ZSkgZGF0YTsKICAgIEtleUZsYWdbXSBrZXlzOwogICAgdWludCBzaXplOwp9Cgp0eXBlIEl0ZXJhdG9yIGlzIHVpbnQ7CgpsaWJyYXJ5IEl0ZXJhYmxlTWFwcGluZyB7CiAgICBmdW5jdGlvbiBpbnNlcnQoaXRtYXAgc3RvcmFnZSBzZWxmLCB1aW50IGtleSwgdWludCB2YWx1ZSkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCByZXBsYWNlZCkgewogICAgICAgIHVpbnQga2V5SW5kZXggPSBzZWxmLmRhdGFba2V5XS5rZXlJbmRleDsKICAgICAgICBzZWxmLmRhdGFba2V5XS52YWx1ZSA9IHZhbHVlOwogICAgICAgIGlmIChrZXlJbmRleCA+IDApCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBrZXlJbmRleCA9IHNlbGYua2V5cy5sZW5ndGg7CiAgICAgICAgICAgIHNlbGYua2V5cy5wdXNoKCk7CiAgICAgICAgICAgIHNlbGYuZGF0YVtrZXldLmtleUluZGV4ID0ga2V5SW5kZXggKyAxOwogICAgICAgICAgICBzZWxmLmtleXNba2V5SW5kZXhdLmtleSA9IGtleTsKICAgICAgICAgICAgc2VsZi5zaXplKys7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gcmVtb3ZlKGl0bWFwIHN0b3JhZ2Ugc2VsZiwgdWludCBrZXkpIGludGVybmFsIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHVpbnQga2V5SW5kZXggPSBzZWxmLmRhdGFba2V5XS5rZXlJbmRleDsKICAgICAgICBpZiAoa2V5SW5kZXggPT0gMCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGRlbGV0ZSBzZWxmLmRhdGFba2V5XTsKICAgICAgICBzZWxmLmtleXNba2V5SW5kZXggLSAxXS5kZWxldGVkID0gdHJ1ZTsKICAgICAgICBzZWxmLnNpemUgLS07CiAgICB9CgogICAgZnVuY3Rpb24gY29udGFpbnMoaXRtYXAgc3RvcmFnZSBzZWxmLCB1aW50IGtleSkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHNlbGYuZGF0YVtrZXldLmtleUluZGV4ID4gMDsKICAgIH0KCiAgICBmdW5jdGlvbiBpdGVyYXRlU3RhcnQoaXRtYXAgc3RvcmFnZSBzZWxmKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKEl0ZXJhdG9yKSB7CiAgICAgICAgcmV0dXJuIGl0ZXJhdG9yU2tpcERlbGV0ZWQoc2VsZiwgMCk7CiAgICB9CgogICAgZnVuY3Rpb24gaXRlcmF0ZVZhbGlkKGl0bWFwIHN0b3JhZ2Ugc2VsZiwgSXRlcmF0b3IgaXRlcmF0b3IpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBJdGVyYXRvci51bndyYXAoaXRlcmF0b3IpIDwgc2VsZi5rZXlzLmxlbmd0aDsKICAgIH0KCiAgICBmdW5jdGlvbiBpdGVyYXRlTmV4dChpdG1hcCBzdG9yYWdlIHNlbGYsIEl0ZXJhdG9yIGl0ZXJhdG9yKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKEl0ZXJhdG9yKSB7CiAgICAgICAgcmV0dXJuIGl0ZXJhdG9yU2tpcERlbGV0ZWQoc2VsZiwgSXRlcmF0b3IudW53cmFwKGl0ZXJhdG9yKSArIDEpOwogICAgfQoKICAgIGZ1bmN0aW9uIGl0ZXJhdGVHZXQoaXRtYXAgc3RvcmFnZSBzZWxmLCBJdGVyYXRvciBpdGVyYXRvcikgaW50ZXJuYWwgdmlldyByZXR1cm5zICh1aW50IGtleSwgdWludCB2YWx1ZSkgewogICAgICAgIHVpbnQga2V5SW5kZXggPSBJdGVyYXRvci51bndyYXAoaXRlcmF0b3IpOwogICAgICAgIGtleSA9IHNlbGYua2V5c1trZXlJbmRleF0ua2V5OwogICAgICAgIHZhbHVlID0gc2VsZi5kYXRhW2tleV0udmFsdWU7CiAgICB9CgogICAgZnVuY3Rpb24gaXRlcmF0b3JTa2lwRGVsZXRlZChpdG1hcCBzdG9yYWdlIHNlbGYsIHVpbnQga2V5SW5kZXgpIHByaXZhdGUgdmlldyByZXR1cm5zIChJdGVyYXRvcikgewogICAgICAgIHdoaWxlIChrZXlJbmRleCA8IHNlbGYua2V5cy5sZW5ndGggJiYgc2VsZi5rZXlzW2tleUluZGV4XS5kZWxldGVkKQogICAgICAgICAgICBrZXlJbmRleCsrOwogICAgICAgIHJldHVybiBJdGVyYXRvci53cmFwKGtleUluZGV4KTsKICAgIH0KfQoKLy8g5aaC5L2V5L2/55SoCmNvbnRyYWN0IFVzZXIgewogICAgLy8g5Y+q5piv5LiA5Liq5L+d5a2Y5oiR5Lus5pWw5o2u55qE57uT5p6E5L2T44CCCiAgICBpdG1hcCBkYXRhOwogICAgLy8g5a+55pWw5o2u57G75Z6L5bqU55So5bqT5Ye95pWw44CCCiAgICB1c2luZyBJdGVyYWJsZU1hcHBpbmcgZm9yIGl0bWFwOwoKICAgIC8vIOaPkuWFpeS4gOS6m+aVsOaNrgogICAgZnVuY3Rpb24gaW5zZXJ0KHVpbnQgaywgdWludCB2KSBwdWJsaWMgcmV0dXJucyAodWludCBzaXplKSB7CiAgICAgICAgLy8g6L+Z5bCG6LCD55SoIEl0ZXJhYmxlTWFwcGluZy5pbnNlcnQoZGF0YSwgaywgdikKICAgICAgICBkYXRhLmluc2VydChrLCB2KTsKICAgICAgICAvLyDmiJHku6zku43nhLblj6/ku6Xorr/pl67nu5PmnoTkuK3nmoTmiJDlkZjvvIwKICAgICAgICAvLyDkvYbmiJHku6zlupTor6Xms6jmhI/kuI3opoHkubHliqjku5bku6zjgIIKICAgICAgICByZXR1cm4gZGF0YS5zaXplOwogICAgfQoKICAgIC8vIOiuoeeul+aJgOacieWtmOWCqOaVsOaNrueahOaAu+WSjOOAggogICAgZnVuY3Rpb24gc3VtKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCBzKSB7CiAgICAgICAgZm9yICgKICAgICAgICAgICAgSXRlcmF0b3IgaSA9IGRhdGEuaXRlcmF0ZVN0YXJ0KCk7CiAgICAgICAgICAgIGRhdGEuaXRlcmF0ZVZhbGlkKGkpOwogICAgICAgICAgICBpID0gZGF0YS5pdGVyYXRlTmV4dChpKQogICAgICAgICkgewogICAgICAgICAgICAoLCB1aW50IHZhbHVlKSA9IGRhdGEuaXRlcmF0ZUdldChpKTsKICAgICAgICAgICAgcyArPSB2YWx1ZTsKICAgICAgICB9CiAgICB9Cn0=">open in Remix</a></p>
<figure class="highlight zephir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><code class="hljs zephir"><span class="hljs-comment">// SPDX-License-Identifier: GPL-3.0</span><br>pragma solidity ^<span class="hljs-number">0.8</span><span class="hljs-number">.8</span>;<br><br>struct IndexValue &#123; <span class="hljs-keyword">uint</span> keyIndex; <span class="hljs-keyword">uint</span> value; &#125;<br>struct KeyFlag &#123; <span class="hljs-keyword">uint</span> key; <span class="hljs-keyword">bool</span> deleted; &#125;<br><br>struct itmap &#123;<br>    mapping(<span class="hljs-keyword">uint</span> =&gt; IndexValue) data;<br>    KeyFlag[] keys;<br>    <span class="hljs-keyword">uint</span> size;<br>&#125;<br><br>type Iterator is <span class="hljs-keyword">uint</span>;<br><br>library IterableMapping &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">insert</span><span class="hljs-params">(itmap storage <span class="hljs-keyword">self</span>, <span class="hljs-keyword">uint</span> key, <span class="hljs-keyword">uint</span> value)</span> <span class="hljs-title">internal</span> <span class="hljs-title">returns</span> <span class="hljs-params">(<span class="hljs-keyword">bool</span> replaced)</span> </span>&#123;<br>        <span class="hljs-keyword">uint</span> keyIndex = <span class="hljs-keyword">self</span>.data[key].keyIndex;<br>        <span class="hljs-keyword">self</span>.data[key].value = value;<br>        <span class="hljs-keyword">if</span> (keyIndex &gt; <span class="hljs-number">0</span>)<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>        <span class="hljs-keyword">else</span> &#123;<br>            keyIndex = <span class="hljs-keyword">self</span>.keys.length;<br>            <span class="hljs-keyword">self</span>.keys.push();<br>            <span class="hljs-keyword">self</span>.data[key].keyIndex = keyIndex + <span class="hljs-number">1</span>;<br>            <span class="hljs-keyword">self</span>.keys[keyIndex].key = key;<br>            <span class="hljs-keyword">self</span>.size++;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">remove</span><span class="hljs-params">(itmap storage <span class="hljs-keyword">self</span>, <span class="hljs-keyword">uint</span> key)</span> <span class="hljs-title">internal</span> <span class="hljs-title">returns</span> <span class="hljs-params">(<span class="hljs-keyword">bool</span> success)</span> </span>&#123;<br>        <span class="hljs-keyword">uint</span> keyIndex = <span class="hljs-keyword">self</span>.data[key].keyIndex;<br>        <span class="hljs-keyword">if</span> (keyIndex == <span class="hljs-number">0</span>)<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>        delete <span class="hljs-keyword">self</span>.data[key];<br>        <span class="hljs-keyword">self</span>.keys[keyIndex - <span class="hljs-number">1</span>].deleted = <span class="hljs-keyword">true</span>;<br>        <span class="hljs-keyword">self</span>.size --;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">contains</span><span class="hljs-params">(itmap storage <span class="hljs-keyword">self</span>, <span class="hljs-keyword">uint</span> key)</span> <span class="hljs-title">internal</span> <span class="hljs-title">view</span> <span class="hljs-title">returns</span> <span class="hljs-params">(<span class="hljs-keyword">bool</span>)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>.data[key].keyIndex &gt; <span class="hljs-number">0</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">iterateStart</span><span class="hljs-params">(itmap storage <span class="hljs-keyword">self</span>)</span> <span class="hljs-title">internal</span> <span class="hljs-title">view</span> <span class="hljs-title">returns</span> <span class="hljs-params">(Iterator)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> iteratorSkipDeleted(<span class="hljs-keyword">self</span>, <span class="hljs-number">0</span>);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">iterateValid</span><span class="hljs-params">(itmap storage <span class="hljs-keyword">self</span>, Iterator iterator)</span> <span class="hljs-title">internal</span> <span class="hljs-title">view</span> <span class="hljs-title">returns</span> <span class="hljs-params">(<span class="hljs-keyword">bool</span>)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> Iterator.unwrap(iterator) &lt; <span class="hljs-keyword">self</span>.keys.length;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">iterateNext</span><span class="hljs-params">(itmap storage <span class="hljs-keyword">self</span>, Iterator iterator)</span> <span class="hljs-title">internal</span> <span class="hljs-title">view</span> <span class="hljs-title">returns</span> <span class="hljs-params">(Iterator)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> iteratorSkipDeleted(<span class="hljs-keyword">self</span>, Iterator.unwrap(iterator) + <span class="hljs-number">1</span>);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">iterateGet</span><span class="hljs-params">(itmap storage <span class="hljs-keyword">self</span>, Iterator iterator)</span> <span class="hljs-title">internal</span> <span class="hljs-title">view</span> <span class="hljs-title">returns</span> <span class="hljs-params">(<span class="hljs-keyword">uint</span> key, <span class="hljs-keyword">uint</span> value)</span> </span>&#123;<br>        <span class="hljs-keyword">uint</span> keyIndex = Iterator.unwrap(iterator);<br>        key = <span class="hljs-keyword">self</span>.keys[keyIndex].key;<br>        value = <span class="hljs-keyword">self</span>.data[key].value;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">iteratorSkipDeleted</span><span class="hljs-params">(itmap storage <span class="hljs-keyword">self</span>, <span class="hljs-keyword">uint</span> keyIndex)</span> <span class="hljs-title">private</span> <span class="hljs-title">view</span> <span class="hljs-title">returns</span> <span class="hljs-params">(Iterator)</span> </span>&#123;<br>        <span class="hljs-keyword">while</span> (keyIndex &lt; <span class="hljs-keyword">self</span>.keys.length &amp;&amp; <span class="hljs-keyword">self</span>.keys[keyIndex].deleted)<br>            keyIndex++;<br>        <span class="hljs-keyword">return</span> Iterator.wrap(keyIndex);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// 如何使用</span><br>contract User &#123;<br>    <span class="hljs-comment">// 只是一个保存我们数据的结构体。</span><br>    itmap data;<br>    <span class="hljs-comment">// 对数据类型应用库函数。</span><br>    using IterableMapping <span class="hljs-keyword">for</span> itmap;<br><br>    <span class="hljs-comment">// 插入一些数据</span><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">insert</span><span class="hljs-params">(<span class="hljs-keyword">uint</span> k, <span class="hljs-keyword">uint</span> v)</span> <span class="hljs-title">public</span> <span class="hljs-title">returns</span> <span class="hljs-params">(<span class="hljs-keyword">uint</span> size)</span> </span>&#123;<br>        <span class="hljs-comment">// 这将调用 IterableMapping.insert(data, k, v)</span><br>        data.insert(k, v);<br>        <span class="hljs-comment">// 我们仍然可以访问结构中的成员，</span><br>        <span class="hljs-comment">// 但我们应该注意不要乱动他们。</span><br>        <span class="hljs-keyword">return</span> data.size;<br>    &#125;<br><br>    <span class="hljs-comment">// 计算所有存储数据的总和。</span><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sum</span><span class="hljs-params">()</span> <span class="hljs-title">public</span> <span class="hljs-title">view</span> <span class="hljs-title">returns</span> <span class="hljs-params">(<span class="hljs-keyword">uint</span> s)</span> </span>&#123;<br>        <span class="hljs-keyword">for</span> (<br>            Iterator i = data.iterateStart();<br>            data.iterateValid(i);<br>            i = data.iterateNext(i)<br>        ) &#123;<br>            (, <span class="hljs-keyword">uint</span> value) = data.iterateGet(i);<br>            s += value;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符<a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#index-28"></a></h2><p>即使两个操作数的类型不一样，也可以应用算术和位操作数。 例如，您可以计算 <code>y = x + z</code>，其中 <code>x</code> 是 <code>uint8</code>， <code>z</code> 的类型为 <code>int32</code>。 在这种情况下，下面的机制将被用来确定计算操作的类型（这在溢出的情况下很重要）和操作结果的类型：</p>
<ol>
<li>如果右操作数的类型可以隐式转换为左操作数的类型，则使用左操作数的类型，</li>
<li>如果左操作数的类型可以隐式转换为右操作数的类型，则使用右操作数的类型，</li>
<li>否则的话，该操作不被允许。</li>
</ol>
<p>如果其中一个操作数是 <a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#rational-literals">字面常数</a>， 它首先被转换为其 “移动类型（mobile type）”，也就是能容纳该值的最小类型 （相同位宽的无符号类型被认为比有符号类型 “小”）。 如果两者都是字面常数，那么运算的精度实际上是无限的， 因为表达式被转换到任何必要的精度，所以当结果被用于非字面类型时，没有任何损失。</p>
<p>操作符的结果类型与操作的类型相同，除了比较操作符，其结果总是 <code>bool</code>。</p>
<p>运算符 <code>**</code> （幂运算）， <code>&lt;&lt;</code> 和 <code>&gt;&gt;</code> 使用左边操作数的类型进行运算和以其作为结果。</p>
<h3 id="三元运算符"><a href="#三元运算符" class="headerlink" title="三元运算符"></a>三元运算符<a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#id39"></a></h3><p>三元运算符用于形式为 <code>&lt;条件表达式&gt; ? &lt;true条件表达式&gt; : &lt;false条件表达式&gt;</code>。 它根据主要的 <code>&lt;条件表达式&gt;</code> 的评估结果，计算后两个给定表达式中的一个。 如果 <code>&lt;条件表达式&gt;</code> 评估为 <code>true</code>，那么 <code>&lt;true条件表达式&gt;</code> 将被计算，否则 <code>&lt;false条件表达式&gt;</code> 被被计算。</p>
<p>三元运算符的结果没有有理数类型，即使它的操作数都是有理数字。 结果类型是由两个操作数的类型决定的，方法同上，如果需要的话，首先转换为它们的可移动计算的类型。</p>
<p>因此， <code>255 + (true ? 1 : 0)</code> 将由于算术溢出而恢复计算。 原因是 <code>(true ? 1 : 0)</code> 是 <code>uint8</code> 类型，这迫使加法也在 <code>uint8</code> 中进行， 而256超出了这个类型允许的范围。</p>
<p>另一个结果是，像 <code>1.5 + 1.5</code> 这样的表达式是有效的，但 <code>1.5 + (true ? 1.5 : 2.5)</code> 却无效。 这是因为前者是一个以无限精度计算的有理表达式，只有它的最终值才是重要的。 后者涉及到将小数有理数转换为整数，这在目前是不允许的。</p>
<h3 id="复数和增量-减量运算符"><a href="#复数和增量-减量运算符" class="headerlink" title="复数和增量/减量运算符"></a>复数和增量/减量运算符<a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#index-29"></a></h3><p>如果 <code>a</code> 是一个LValue（即是一个变量或者是可以被分配的东西）， 下列运算符可以作为速记：</p>
<p><code>a += e</code> 相当于 <code>a = a + e</code>，运算符 <code>-=</code>， <code>*=</code>， <code>/=</code>， <code>%=</code>， <code>|=</code>， <code>&amp;=</code>， <code>^=</code>， <code>&lt;&lt;=</code> 和 <code>&gt;&gt;=</code> 都有相应的定义。 <code>a++</code> 和 <code>a--</code> 相当于 <code>a += 1</code> / <code>a -= 1</code> 但是表达式本身仍然是以前的值 <code>a</code>。 相比之下， <code>--a</code> 和 <code>++a</code> 对 <code>a</code> 有同样的作用，但返回改变后的值。</p>
<h3 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除<a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#delete"></a></h3><p><code>delete a</code> 为该类型分配初始值 <code>a</code>。例如，对于整数来说，它相当于 <code>a = 0</code>， 但是它也可以用于数组，它指定一个长度为0的动态数组或者一个相同长度的静态数组， 所有元素都设置为初始值。 <code>delete a[x]</code> 删除数组中索引为 <code>x</code> 的元素， 并保留所有其他元素和数组的长度不动。这特别意味着它在数组中留下一个缺口。 如果您打算删除项目，一个 <a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#mapping-types">映射类型</a> 可能是一个更好的选择。</p>
<p>对于结构体，则将结构体中的所有属性重置。换句话说，在 <code>delete a</code> 之后， <code>a</code> 的值与 <code>a</code> 在没有赋值的情况下被声明是一样的，但有以下注意事项：</p>
<p><code>delete</code> 对映射类型没有影响（因为映射的键可能是任意的，通常是未知的）。 因此，如果您删除一个结构体，它将重置所有不是映射类型的成员， 同时也会递归到这些成员，除非它们是映射。 然而，单个键和它们所映射的内容可以被删除。 如果 <code>a</code> 是一个映射，那么 <code>delete a[x]</code> 将删除存储在 <code>x</code> 的值。</p>
<p>值得注意的是， <code>delete a</code> 的行为实际上是对 <code>a</code> 的赋值， 也就是说，它在 <code>a</code> 中存储了一个新的对象。 当 <code>a</code> 是引用变量时，这种区别是明显的。 它只会重置 <code>a</code> 本身，而不是它之前引用的值。</p>
<p><a target="_blank" rel="noopener" href="https://remix.ethereum.org/?#language=solidity&amp;version=0.8.24&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjAgPDAuOS4wOwoKY29udHJhY3QgRGVsZXRlRXhhbXBsZSB7CiAgICB1aW50IGRhdGE7CiAgICB1aW50W10gZGF0YUFycmF5OwoKICAgIGZ1bmN0aW9uIGYoKSBwdWJsaWMgewogICAgICAgIHVpbnQgeCA9IGRhdGE7CiAgICAgICAgZGVsZXRlIHg7IC8vIOWwhiB4IOiuvuS4uiAw77yM5bm25LiN5b2x5ZONZGF0YeWPmOmHjwogICAgICAgIGRlbGV0ZSBkYXRhOyAvLyDlsIYgZGF0YSDorr7kuLogMO+8jOW5tuS4jeW9seWTjSB4CiAgICAgICAgdWludFtdIHN0b3JhZ2UgeSA9IGRhdGFBcnJheTsKICAgICAgICBkZWxldGUgZGF0YUFycmF5OyAvLyDlsIYgZGF0YUFycmF5Lmxlbmd0aCDorr7kuLogMO+8jOS9hueUseS6jiB1aW50W10g5piv5LiA5Liq5aSN5p2C55qE5a+56LGh77yMCiAgICAgICAgLy8geSDkuZ/lsIblj5fliLDlvbHlk43vvIzlroPmmK/kuIDkuKrlrZjlgqjkvY3nva7mmK8gc3RvcmFnZSDnmoTlr7nosaHnmoTliKvlkI3jgIIKICAgICAgICAvLyDlj6bkuIDmlrnpnaLvvJoiZGVsZXRlIHkiIOaYr+mdnuazleeahO+8jOW8leeUqOS6hiBzdG9yYWdlIOWvueixoeeahOWxgOmDqOWPmOmHj+WPquiDveeUseW3suacieeahCBzdG9yYWdlIOWvueixoei1i+WAvOOAggogICAgICAgIGFzc2VydCh5Lmxlbmd0aCA9PSAwKTsKICAgIH0KfQ==">open in Remix</a></p>
<figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs d"><span class="hljs-comment">// SPDX-License-Identifier: GPL-3.0</span><br><span class="hljs-keyword">pragma</span> solidity &gt;=<span class="hljs-number">0.4</span><span class="hljs-number">.0</span> &lt;<span class="hljs-number">0.9</span><span class="hljs-number">.0</span>;<br><br>contract DeleteExample &#123;<br>    <span class="hljs-built_in">uint</span> data;<br>    <span class="hljs-built_in">uint</span>[] dataArray;<br><br>    <span class="hljs-built_in">function</span> f() <span class="hljs-keyword">public</span> &#123;<br>        <span class="hljs-built_in">uint</span> x = data;<br>        <span class="hljs-keyword">delete</span> x; <span class="hljs-comment">// 将 x 设为 0，并不影响data变量</span><br>        <span class="hljs-keyword">delete</span> data; <span class="hljs-comment">// 将 data 设为 0，并不影响 x</span><br>        <span class="hljs-built_in">uint</span>[] storage y = dataArray;<br>        <span class="hljs-keyword">delete</span> dataArray; <span class="hljs-comment">// 将 dataArray.length 设为 0，但由于 uint[] 是一个复杂的对象，</span><br>        <span class="hljs-comment">// y 也将受到影响，它是一个存储位置是 storage 的对象的别名。</span><br>        <span class="hljs-comment">// 另一方面：&quot;delete y&quot; 是非法的，引用了 storage 对象的局部变量只能由已有的 storage 对象赋值。</span><br>        <span class="hljs-keyword">assert</span>(y.length == <span class="hljs-number">0</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="运算符的优先顺序"><a href="#运算符的优先顺序" class="headerlink" title="运算符的优先顺序"></a>运算符的优先顺序<a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#order"></a></h3><p>以下是按评估顺序列出的操作符优先级。</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>优先级</th>
<th>描述</th>
<th>操作符</th>
</tr>
</thead>
<tbody>
<tr>
<td><em>1</em></td>
<td>后置自增和自减</td>
<td><code>++</code>， <code>--</code></td>
</tr>
<tr>
<td></td>
<td>创建类型实例</td>
<td><code>new &lt;类型名&gt;</code></td>
</tr>
<tr>
<td></td>
<td>数组元素</td>
<td><code>&lt;数组&gt;[&lt;索引&gt;]</code></td>
</tr>
<tr>
<td></td>
<td>访问成员</td>
<td><code>&lt;对象&gt;.&lt;成员名&gt;</code></td>
</tr>
<tr>
<td></td>
<td>函数调用</td>
<td><code>&lt;函数&gt;(&lt;参数...&gt;)</code></td>
</tr>
<tr>
<td></td>
<td>小括号</td>
<td><code>(&lt;表达式&gt;)</code></td>
</tr>
<tr>
<td><em>2</em></td>
<td>前置自增和自减</td>
<td><code>++</code>， <code>--</code></td>
</tr>
<tr>
<td></td>
<td>一元运算减</td>
<td><code>-</code></td>
</tr>
<tr>
<td></td>
<td>一元操作符</td>
<td><code>delete</code></td>
</tr>
<tr>
<td></td>
<td>逻辑非</td>
<td><code>!</code></td>
</tr>
<tr>
<td></td>
<td>按位非</td>
<td><code>~</code></td>
</tr>
<tr>
<td><em>3</em></td>
<td>乘方</td>
<td><code>**</code></td>
</tr>
<tr>
<td><em>4</em></td>
<td>乘、除和模运算</td>
<td><code>*</code>， <code>/</code>， <code>%</code></td>
</tr>
<tr>
<td><em>5</em></td>
<td>算术加和减</td>
<td><code>+</code>， <code>-</code></td>
</tr>
<tr>
<td><em>6</em></td>
<td>移位操作符</td>
<td><code>&lt;&lt;</code>， <code>&gt;&gt;</code></td>
</tr>
<tr>
<td><em>7</em></td>
<td>按位与</td>
<td><code>&amp;</code></td>
</tr>
<tr>
<td><em>8</em></td>
<td>按位异或</td>
<td><code>^</code></td>
</tr>
<tr>
<td><em>9</em></td>
<td>按位或</td>
<td>`</td>
<td>`</td>
</tr>
<tr>
<td><em>10</em></td>
<td>非等操作符</td>
<td><code>&lt;</code>， <code>&gt;</code>， <code>&lt;=</code>， <code>&gt;=</code></td>
</tr>
<tr>
<td><em>11</em></td>
<td>等于操作符</td>
<td><code>==</code>， <code>!=</code></td>
</tr>
<tr>
<td><em>12</em></td>
<td>逻辑与</td>
<td><code>&amp;&amp;</code></td>
</tr>
<tr>
<td><em>13</em></td>
<td>逻辑或</td>
<td><code>==</code></td>
</tr>
<tr>
<td><em>14</em></td>
<td>三元操作符</td>
<td><code>&lt;判断条件&gt; ? &lt;如果为真时执行的表达式&gt; : &lt;如果为假时执行的表达式&gt;</code></td>
</tr>
<tr>
<td></td>
<td>赋值操作符</td>
<td><code>=</code>， `</td>
<td>=<code>，</code>^=<code>，</code>&amp;=<code>，</code>&lt;&lt;=<code>，</code>&gt;&gt;=<code>，</code>+=<code>，</code>-=<code>，</code>*=<code>，</code>/=<code>，</code>%=`</td>
</tr>
<tr>
<td><em>15</em></td>
<td>逗号</td>
<td><code>,</code></td>
</tr>
</tbody>
</table>
</div>
<h2 id="基本类型之间的转换"><a href="#基本类型之间的转换" class="headerlink" title="基本类型之间的转换"></a>基本类型之间的转换<a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#types-conversion-elementary-types"></a></h2><h3 id="隐式转换"><a href="#隐式转换" class="headerlink" title="隐式转换"></a>隐式转换<a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#id44"></a></h3><p>在某些情况下，在赋值过程中，在向函数传递参数和应用运算符时， 编译器会自动应用隐式类型转换。一般来说，如果在语义上有意义， 并且不会丢失信息，那么值-类型之间的隐式转换是可能的。</p>
<p>例如， <code>uint8</code> 可以转换为 <code>uint16</code>， <code>int128</code> 可以转换为 <code>int256</code>， 但是 <code>int8</code> 不能转换为 <code>uint256</code>，因为 <code>uint256</code> 不能容纳 <code>-1</code> 这样的值。</p>
<p>如果一个运算符被应用于不同的类型， 编译器会尝试将其中一个操作数隐含地转换为另一个的类型（对于赋值也是如此）。 这意味着操作总是以其中一个操作数的类型进行。</p>
<p>关于哪些隐式转换是可能的，请参考关于类型本身的章节。</p>
<p>在下面的例子中， <code>y</code> 和 <code>z</code>，即加法的操作数，没有相同的类型， 但是 <code>uint8</code> 可以隐式转换为 <code>uint16</code>，反之则不行。正因为如此， <code>y</code> 被转换为 <code>z</code> 的类型，然后在 <code>uint16</code> 类型中进行加法。 结果表达式 <code>y + z</code> 的类型是 <code>uint16</code>。 因为它被分配到一个 <code>uint32</code> 类型的变量中，所以在加法后又进行了一次隐式转换。</p>
<p><a target="_blank" rel="noopener" href="https://remix.ethereum.org/?#language=solidity&amp;version=0.8.24&amp;code=dWludDggeTsKdWludDE2IHo7CnVpbnQzMiB4ID0geSArIHo7">open in Remix</a></p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-built_in">uint8</span> y;<br><span class="hljs-built_in">uint16</span> z;<br><span class="hljs-built_in">uint32</span> x = y + z;<br></code></pre></td></tr></table></figure>
<h3 id="显式转换"><a href="#显式转换" class="headerlink" title="显式转换"></a>显式转换<a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#id45"></a></h3><p>如果编译器不允许隐式转换，但您确信转换会成功， 有时可以进行显式类型转换。 这可能会导致意想不到的行为，并使您绕过编译器的一些安全特性， 所以一定要测试结果是否是您想要的和期望的!</p>
<p>以下面的例子为例，将一个负的 <code>int</code> 转换为 <code>uint</code>：</p>
<p><a target="_blank" rel="noopener" href="https://remix.ethereum.org/?#language=solidity&amp;version=0.8.24&amp;code=aW50ICB5ID0gLTM7CnVpbnQgeCA9IHVpbnQoeSk7">open in Remix</a></p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf">int  y <span class="hljs-operator">=</span> -<span class="hljs-number">3</span><span class="hljs-comment">;</span><br>uint x <span class="hljs-operator">=</span> uint(y)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure>
<p>在这个代码片断的最后， <code>x</code> 变成 <code>0xfffff..fd</code> 的值（64个十六进制字符）， 这在256位的二进制补码中表示是-3。</p>
<p>如果一个整数被明确地转换为一个较小的类型，高阶位就会被切断：</p>
<p><a target="_blank" rel="noopener" href="https://remix.ethereum.org/?#language=solidity&amp;version=0.8.24&amp;code=dWludDMyIGEgPSAweDEyMzQ1Njc4Owp1aW50MTYgYiA9IHVpbnQxNihhKTsgLy8gYiDnjrDlnKjkvJrmmK8gMHg1Njc4">open in Remix</a></p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf">uint32 a <span class="hljs-operator">=</span> <span class="hljs-number">0</span>x12345678<span class="hljs-comment">;</span><br>uint16 b <span class="hljs-operator">=</span> uint16(a)<span class="hljs-comment">; // b 现在会是 0x5678</span><br></code></pre></td></tr></table></figure>
<p>如果一个整数被明确地转换为一个更大的类型，它将在左边被填充（即在高阶的一端）。 转换的结果将与原整数比较相等：</p>
<p><a target="_blank" rel="noopener" href="https://remix.ethereum.org/?#language=solidity&amp;version=0.8.24&amp;code=dWludDE2IGEgPSAweDEyMzQ7CnVpbnQzMiBiID0gdWludDMyKGEpOyAvLyBiIOeOsOWcqOS8muaYryAweDAwMDAxMjM0CmFzc2VydChhID09IGIpOw==">open in Remix</a></p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs abnf">uint16 a <span class="hljs-operator">=</span> <span class="hljs-number">0</span>x1234<span class="hljs-comment">;</span><br>uint32 b <span class="hljs-operator">=</span> uint32(a)<span class="hljs-comment">; // b 现在会是 0x00001234</span><br>assert(a <span class="hljs-operator">=</span><span class="hljs-operator">=</span> b)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure>
<p>固定大小的字节类型在转换过程中的行为是不同的。 它们可以被认为是单个字节的序列，转换到一个较小的类型将切断序列：</p>
<p><a target="_blank" rel="noopener" href="https://remix.ethereum.org/?#language=solidity&amp;version=0.8.24&amp;code=Ynl0ZXMyIGEgPSAweDEyMzQ7CmJ5dGVzMSBiID0gYnl0ZXMxKGEpOyAvLyBiIOeOsOWcqOS8muaYryAweDEy">open in Remix</a></p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf">bytes2 a <span class="hljs-operator">=</span> <span class="hljs-number">0</span>x1234<span class="hljs-comment">;</span><br>bytes1 b <span class="hljs-operator">=</span> bytes1(a)<span class="hljs-comment">; // b 现在会是 0x12</span><br></code></pre></td></tr></table></figure>
<p>如果一个固定大小的字节类型被明确地转换为一个更大的类型，它将在右边被填充。 访问固定索引的字节将导致转换前后的数值相同（如果索引仍在范围内）：</p>
<p><a target="_blank" rel="noopener" href="https://remix.ethereum.org/?#language=solidity&amp;version=0.8.24&amp;code=Ynl0ZXMyIGEgPSAweDEyMzQ7CmJ5dGVzNCBiID0gYnl0ZXM0KGEpOyAvLyBiIOeOsOWcqOS8muaYryAweDEyMzQwMDAwCmFzc2VydChhWzBdID09IGJbMF0pOwphc3NlcnQoYVsxXSA9PSBiWzFdKTs=">open in Remix</a></p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs abnf">bytes2 a <span class="hljs-operator">=</span> <span class="hljs-number">0</span>x1234<span class="hljs-comment">;</span><br>bytes4 b <span class="hljs-operator">=</span> bytes4(a)<span class="hljs-comment">; // b 现在会是 0x12340000</span><br>assert(a[<span class="hljs-number">0</span>] <span class="hljs-operator">=</span><span class="hljs-operator">=</span> b[<span class="hljs-number">0</span>])<span class="hljs-comment">;</span><br>assert(a[<span class="hljs-number">1</span>] <span class="hljs-operator">=</span><span class="hljs-operator">=</span> b[<span class="hljs-number">1</span>])<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure>
<p>于整数和固定大小的字节数组在截断或填充时表现不同， 只有在整数和固定大小的字节数组具有相同大小的情况下，才允许在两者之间进行显式转换。 如果您想在不同大小的整数和固定大小的字节数组之间进行转换，您必须使用中间转换， 使所需的截断和填充规则明确：</p>
<p><a target="_blank" rel="noopener" href="https://remix.ethereum.org/?#language=solidity&amp;version=0.8.24&amp;code=Ynl0ZXMyIGEgPSAweDEyMzQ7CnVpbnQzMiBiID0gdWludDE2KGEpOyAvLyBiIOWwhuS8muaYryAweDAwMDAxMjM0CnVpbnQzMiBjID0gdWludDMyKGJ5dGVzNChhKSk7IC8vIGMg5bCG5Lya5pivIDB4MTIzNDAwMDAKdWludDggZCA9IHVpbnQ4KHVpbnQxNihhKSk7IC8vIGQg5bCG5Lya5pivIDB4MzQKdWludDggZSA9IHVpbnQ4KGJ5dGVzMShhKSk7IC8vIGUg5bCG5Lya5pivIDB4MTI=">open in Remix</a></p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">bytes2 a = <span class="hljs-number">0x1234</span>;<br><span class="hljs-built_in">uint32</span> b = <span class="hljs-built_in">uint16</span>(a); <span class="hljs-comment">// b 将会是 0x00001234</span><br><span class="hljs-built_in">uint32</span> c = <span class="hljs-built_in">uint32</span>(bytes4(a)); <span class="hljs-comment">// c 将会是 0x12340000</span><br><span class="hljs-built_in">uint8</span> d = <span class="hljs-built_in">uint8</span>(<span class="hljs-built_in">uint16</span>(a)); <span class="hljs-comment">// d 将会是 0x34</span><br><span class="hljs-built_in">uint8</span> e = <span class="hljs-built_in">uint8</span>(bytes1(a)); <span class="hljs-comment">// e 将会是 0x12</span><br></code></pre></td></tr></table></figure>
<p><code>bytes</code> 数组和 <code>bytes</code> calldata 切片可以明确转换为固定字节类型（ <code>bytes1</code> /…/ <code>bytes32</code>）。 如果数组比目标的固定字节类型长，在末端会发生截断的情况。如果数组比目标类型短，它将在末尾被填充零。</p>
<p><a target="_blank" rel="noopener" href="https://remix.ethereum.org/?#language=solidity&amp;version=0.8.24&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5IF4wLjguNTsKCmNvbnRyYWN0IEMgewogICAgYnl0ZXMgcyA9ICJhYmNkZWZnaCI7CiAgICBmdW5jdGlvbiBmKGJ5dGVzIGNhbGxkYXRhIGMsIGJ5dGVzIG1lbW9yeSBtKSBwdWJsaWMgdmlldyByZXR1cm5zIChieXRlczE2LCBieXRlczMpIHsKICAgICAgICByZXF1aXJlKGMubGVuZ3RoID09IDE2LCAiIik7CiAgICAgICAgYnl0ZXMxNiBiID0gYnl0ZXMxNihtKTsgIC8vIOWmguaenG3nmoTplb/luqblpKfkuo4xNu+8jOWwhuWPkeeUn+aIquaWreOAggogICAgICAgIGIgPSBieXRlczE2KHMpOyAgLy8g5Y+z6L656L+b6KGM5aGr5YWF77yM5omA5Lul57uT5p6c5pivICJhYmNkZWZnaFwwXDBcMFwwXDBcMFwwXDAiCiAgICAgICAgYnl0ZXMzIGIxID0gYnl0ZXMzKHMpOyAvLyDlj5HnlJ/miKrmlq0sIGIxIOebuOW9k+S6jiAiYWJjIgogICAgICAgIGIgPSBieXRlczE2KGNbOjhdKTsgIC8vIOWQjOagt+eUqDDov5vooYzloavlhYUKICAgICAgICByZXR1cm4gKGIsIGIxKTsKICAgIH0KfQ==">open in Remix</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// SPDX-License-Identifier: GPL-3.0</span><br>pragma solidity ^<span class="hljs-number">0.8</span><span class="hljs-number">.5</span>;<br><br>contract C &#123;<br>    <span class="hljs-type">bytes</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;abcdefgh&quot;</span>;<br>    function <span class="hljs-title function_">f</span><span class="hljs-params">(bytes calldata c, bytes memory m)</span> <span class="hljs-keyword">public</span> view <span class="hljs-title function_">returns</span> <span class="hljs-params">(bytes16, bytes3)</span> &#123;<br>        require(c.length == <span class="hljs-number">16</span>, <span class="hljs-string">&quot;&quot;</span>);<br>        <span class="hljs-type">bytes16</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> bytes16(m);  <span class="hljs-comment">// 如果m的长度大于16，将发生截断。</span><br>        b = bytes16(s);  <span class="hljs-comment">// 右边进行填充，所以结果是 &quot;abcdefgh\0\0\0\0\0\0\0\0&quot;</span><br>        <span class="hljs-type">bytes3</span> <span class="hljs-variable">b1</span> <span class="hljs-operator">=</span> bytes3(s); <span class="hljs-comment">// 发生截断, b1 相当于 &quot;abc&quot;</span><br>        b = bytes16(c[:<span class="hljs-number">8</span>]);  <span class="hljs-comment">// 同样用0进行填充</span><br>        <span class="hljs-keyword">return</span> (b, b1);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="字面常数和基本类型之间的转换"><a href="#字面常数和基本类型之间的转换" class="headerlink" title="字面常数和基本类型之间的转换"></a>字面常数和基本类型之间的转换<a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#types-conversion-literals"></a></h2><h3 id="整数类型"><a href="#整数类型" class="headerlink" title="整数类型"></a>整数类型<a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#id47"></a></h3><p>十进制和十六进制的数字字面常数可以隐含地转换为任何足够大的整数类型去表示它而不被截断：</p>
<p><a target="_blank" rel="noopener" href="https://remix.ethereum.org/?#language=solidity&amp;version=0.8.24&amp;code=dWludDggYSA9IDEyOyAvLyDlj6/ooYwKdWludDMyIGIgPSAxMjM0OyAvLyDlj6/ooYwKdWludDE2IGMgPSAweDEyMzQ1NjsgLy8g5oql6ZSZLCDlm6DkuLrov5nlsIbkvJrmiKrmlq3miJAgMHgzNDU2">open in Remix</a></p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs abnf">uint8 a <span class="hljs-operator">=</span> <span class="hljs-number">12</span><span class="hljs-comment">; // 可行</span><br>uint32 b <span class="hljs-operator">=</span> <span class="hljs-number">1234</span><span class="hljs-comment">; // 可行</span><br>uint16 c <span class="hljs-operator">=</span> <span class="hljs-number">0</span>x123456<span class="hljs-comment">; // 报错, 因为这将会截断成 0x3456</span><br></code></pre></td></tr></table></figure>
<p>备注</p>
<p>在0.8.0版本之前，任何十进制或十六进制的数字字面常数都可以显式转换为整数类型。 从0.8.0开始，这种显式转换和隐式转换一样严格，也就是说，只有当字面意义符合所产生的范围时，才允许转换。</p>
<h3 id="固定大小的字节数组"><a href="#固定大小的字节数组" class="headerlink" title="固定大小的字节数组"></a>固定大小的字节数组<a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#index-34"></a></h3><p>十进制数字字面常数不能被隐含地转换为固定大小的字节数组。 十六进制数字字面常数是可以的，但只有当十六进制数字的数量正好符合字节类型的大小时才可以。 但是有一个例外，数值为0的十进制和十六进制数字字面常数都可以被转换为任何固定大小的字节类型：</p>
<p><a target="_blank" rel="noopener" href="https://remix.ethereum.org/?#language=solidity&amp;version=0.8.24&amp;code=Ynl0ZXMyIGEgPSA1NDMyMTsgLy8g5LiN5YWB6K64CmJ5dGVzMiBiID0gMHgxMjsgLy8g5LiN5YWB6K64CmJ5dGVzMiBjID0gMHgxMjM7IC8vIOS4jeWFgeiuuApieXRlczIgZCA9IDB4MTIzNDsgLy8g5Y+v6KGMCmJ5dGVzMiBlID0gMHgwMDEyOyAvLyDlj6/ooYwKYnl0ZXM0IGYgPSAwOyAvLyDlj6/ooYwKYnl0ZXM0IGcgPSAweDA7IC8vIOWPr+ihjA==">open in Remix</a></p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-keyword">bytes2 </span>a = <span class="hljs-number">54321</span><span class="hljs-comment">; // 不允许</span><br><span class="hljs-keyword">bytes2 </span><span class="hljs-keyword">b </span>= <span class="hljs-number">0x12</span><span class="hljs-comment">; // 不允许</span><br><span class="hljs-keyword">bytes2 </span>c = <span class="hljs-number">0x123</span><span class="hljs-comment">; // 不允许</span><br><span class="hljs-keyword">bytes2 </span>d = <span class="hljs-number">0x1234</span><span class="hljs-comment">; // 可行</span><br><span class="hljs-keyword">bytes2 </span>e = <span class="hljs-number">0x0012</span><span class="hljs-comment">; // 可行</span><br><span class="hljs-keyword">bytes4 </span>f = <span class="hljs-number">0</span><span class="hljs-comment">; // 可行</span><br><span class="hljs-keyword">bytes4 </span>g = <span class="hljs-number">0x0</span><span class="hljs-comment">; // 可行</span><br></code></pre></td></tr></table></figure>
<p>字符串和十六进制字符串字面常数可以被隐含地转换为固定大小的字节数组， 如果它们的字符数与字节类型的大小相匹配：</p>
<p><a target="_blank" rel="noopener" href="https://remix.ethereum.org/?#language=solidity&amp;version=0.8.24&amp;code=Ynl0ZXMyIGEgPSBoZXgiMTIzNCI7IC8vIOWPr+ihjApieXRlczIgYiA9ICJ4eSI7IC8vIOWPr+ihjApieXRlczIgYyA9IGhleCIxMiI7IC8vIOS4jeWFgeiuuApieXRlczIgZCA9IGhleCIxMjMiOyAvLyDkuI3lhYHorrgKYnl0ZXMyIGUgPSAieCI7IC8vIOS4jeWFgeiuuApieXRlczIgZiA9ICJ4eXoiOyAvLyDkuI3lhYHorrg=">open in Remix</a></p>
<figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs d">bytes2 a = he<span class="hljs-string">x&quot;1234&quot;</span>; <span class="hljs-comment">// 可行</span><br>bytes2 b = <span class="hljs-string">&quot;xy&quot;</span>; <span class="hljs-comment">// 可行</span><br>bytes2 c = he<span class="hljs-string">x&quot;12&quot;</span>; <span class="hljs-comment">// 不允许</span><br>bytes2 d = he<span class="hljs-string">x&quot;123&quot;</span>; <span class="hljs-comment">// 不允许</span><br>bytes2 e = <span class="hljs-string">&quot;x&quot;</span>; <span class="hljs-comment">// 不允许</span><br>bytes2 f = <span class="hljs-string">&quot;xyz&quot;</span>; <span class="hljs-comment">// 不允许</span><br></code></pre></td></tr></table></figure>
<h3 id="地址类型-1"><a href="#地址类型-1" class="headerlink" title="地址类型"></a>地址类型<a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#index-35"></a></h3><p>正如在 <a target="_blank" rel="noopener" href="https://docs.soliditylang.org/zh-cn/latest/types.html#address-literals">地址字面量（Address Literals）</a> 中所描述的那样，正确大小并通过校验测试的十六进制字是 <code>address</code> 类型。 其他字面常数不能隐含地转换为 <code>address</code> 类型。</p>
<p>只允许从 <code>bytes20</code> 和 <code>uint160</code> 显式转换到 <code>address</code>。</p>
<p><code>address a</code> 可以通过 <code>payable(a)</code> 显式转换为 <code>address payable</code>。</p>
<p>备注</p>
<p>在 0.8.0 版本之前，可以显式地从任何整数类型（任何大小，有符号或无符号）转换为 <code>address</code> 或 <code>address payable</code> 类型。 从 0.8.0 开始，只允许从 <code>uint160</code> 转换。<a target="_blank" rel="noopener" href="https://server.ethicalads.io/proxy/click/8916/0197f493-8e40-7791-933b-f2fb8297bac6/">https://server.ethicalads.io/proxy/click/8916/0197f493-8e40-7791-933b-f2fb8297bac6/</a>)</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/" class="category-chain-item">区块链</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E5%8C%BA%E5%9D%97%E9%93%BE%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E8%AF%AD%E6%B3%95/" class="print-no-link">#区块链智能合约语法</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>类型</div>
      <div>https://www.zhengcookie.site/2025/07/06/类型/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>zhengcookie</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2025年7月6日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/07/06/%E5%8D%95%E4%BD%8D%E4%B8%8E%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F/" title="单位与全局变量">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">单位与全局变量</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/07/05/%E5%90%88%E7%BA%A6%E7%BB%93%E6%9E%84%E8%AF%AD%E6%B3%95/" title="合约结构语法">
                        <span class="hidden-mobile">合约结构语法</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.5.1/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"sTZBx4mwQ0t3yfqJB5XmuIhz-gzGzoHsz","appKey":"KJPXk2hOqDfll4hbw93yYmUc","path":"window.location.pathname","placeholder":"请在这里写下你的评论","avatar":"/img/avatar.png","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":false,"enable":true,"bg":null,"visitor":false,"option":null},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
      <div class="col-lg-7 mx-auto nopadding-x-md">
        <div class="container custom mx-auto">
          
<!--aplayer--> <link rel="stylesheet" href="https://www.zhengcookie.site/js/APlayer/dist/APlayer.min.css"> <div id="aplayer"></div> <script src="https://www.zhengcookie.site/js/APlayer/dist/APlayer.min.js"></script> <script src="https://www.zhengcookie.site/js/useaplayer.js"></script>

        </div>
      </div>
    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        总访问量 
        <span id="busuanzi_value_site_pv"></span>
         次
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        总访客数 
        <span id="busuanzi_value_site_uv"></span>
         人
      </span>
    
    

  

</div>

  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
